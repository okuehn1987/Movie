import{d as T,C as E,D as f,S as c,r as L,a as P,o as V,c as y,b as a,V as I,e as l,al as N,J,f as M,m as S,h as A,k,t as K,am as G,E as C,F as Q,G as F,an as $,W as R,z as Y,l as Z,ao as x,ap as W,i as U,p as w,q as i,K as m,u as r,x as v,s as b,Y as O,B as X,aq as ee}from"./app-CHnKiVNW.js";import{c as re,g as se}from"./utils-BaK5Eyz9.js";import{_ as D}from"./PermissionSelector.vue_vue_type_script_setup_true_lang-D_0OXpve.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=T({__name:"UserForm",props:{user:{},supervisors:{},operating_sites:{},groups:{},mode:{},countries:{},permissions:{}},emits:["success"],setup(h,{emit:j}){var H;const t=h,B=j,e=E({first_name:"",last_name:"",email:"",date_of_birth:null,city:"",zip:"",street:"",house_number:"",address_suffix:"",country:"",federal_state:"",phone_number:"",staff_number:null,password:"",group_id:null,operating_site_id:null,supervisor_id:null,is_supervisor:!1,home_office:!1,home_office_hours_per_week:null,userWorkingHours:0,userWorkingHoursSince:new Date,userWorkingWeek:[],userWorkingWeekSince:new Date,userLeaveDays:0,userLeaveDaysSince:f.now().toFormat("yyyy-MM"),overtime_calculations_start:f.now().toFormat("yyyy-MM-dd"),organizationUser:{absence_permission:null,absenceType_permission:null,group_permission:null,operatingSite_permission:null,organization_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,specialWorkingHoursFactor_permission:null,workLogPatch_permission:null},groupUser:{absence_permission:null,group_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null},operatingSiteUser:{absence_permission:null,operatingSite_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null}});if(t.user){e.first_name=t.user.first_name,e.last_name=t.user.last_name,e.email=t.user.email,e.date_of_birth=t.user.date_of_birth,e.city=t.user.city??"",e.zip=t.user.zip??"",e.street=t.user.street??"",e.house_number=t.user.house_number??"",e.address_suffix=t.user.address_suffix??"",e.country=t.user.country,e.federal_state=t.user.federal_state,e.phone_number=t.user.phone_number??"",e.staff_number=t.user.staff_number,e.password=t.user.password,e.group_id=t.user.group_id,e.operating_site_id=t.user.operating_site_id,e.supervisor_id=t.user.supervisor_id,e.home_office=t.user.home_office,e.home_office_hours_per_week=t.user.home_office_hours_per_week,e.userWorkingHours=((H=t.user.currentWorkingHours)==null?void 0:H.weekly_working_hours)??0,e.userWorkingHoursSince=new Date(t.user.currentWorkingHours.active_since),e.overtime_calculations_start=f.fromSQL(t.user.overtime_calculations_start).toFormat("yyyy-MM-dd");for(const s of c.weekdays("long",{locale:"en"}).map(p=>p.toLowerCase()))t.user.userWorkingWeek[s]&&e.userWorkingWeek.push(s);e.userWorkingWeekSince=new Date(t.user.userWorkingWeek.active_since);const d=t.user.user_leave_days[t.user.user_leave_days.length-1];d&&(e.userLeaveDays=d.leave_days,e.userLeaveDaysSince=f.fromSQL(d.active_since).toFormat("yyyy-MM")),e.organizationUser=t.user.organization_user,e.groupUser=t.user.group_user??e.groupUser,e.operatingSiteUser=t.user.operating_site_user}function z(){const d=e.transform(s=>({...s,userWorkingHoursSince:f.fromJSDate(e.userWorkingHoursSince).toFormat("yyyy-MM-dd"),userWorkingWeekSince:f.fromJSDate(e.userWorkingWeekSince).toFormat("yyyy-MM-dd"),date_of_birth:s.date_of_birth?new Date(s.date_of_birth).toISOString():null,organizationUser:Object.fromEntries(Object.entries(s.organizationUser).filter(([p])=>t.permissions.find(o=>o.name==p))),groupUser:Object.fromEntries(Object.entries(s.groupUser).filter(([p])=>t.permissions.find(o=>o.name==p))),operatingSiteUser:Object.fromEntries(Object.entries(s.operatingSiteUser).filter(([p])=>t.permissions.find(o=>o.name==p)))}));t.mode=="edit"&&t.user?d.patch(route("user.update",{user:t.user.id}),{onError:s=>console.log(s)}):d.post(route("user.store"),{onSuccess:()=>{e.reset(),B("success")},onError:s=>console.log(s)})}const g=L(1),n=L([{isValidated:!1,name:"Allgemeine Angaben",fields:{first_name:[()=>!!e.first_name],last_name:[()=>!!e.last_name],email:[()=>!!e.email],date_of_birth:[()=>!0],password:[()=>t.mode!=="create"||!!e.password],userWorkingHours:[()=>!!e.userWorkingHours],userWorkingHoursSince:[()=>!!e.userWorkingHoursSince],userWorkingWeek:[()=>!!e.userWorkingWeek],userWorkingWeekSince:[()=>!!e.userWorkingWeekSince],userLeaveDays:[()=>!!e.userLeaveDays],userLeaveDaysSince:[()=>!!e.userLeaveDaysSince]}},{isValidated:!1,name:"Adresse",fields:{street:[()=>!0],house_number:[()=>!0],zip:[()=>!0],city:[()=>!0],federal_state:[()=>!!e.federal_state],country:[()=>!!e.country]}},{isValidated:!1,name:"Berechtigungen",fields:{operating_site_id:[()=>!!e.operating_site_id]}}]);return(d,s)=>{const p=P("v-date-input");return V(),y(I,null,{default:a(()=>[l(ee,{modelValue:g.value,"onUpdate:modelValue":s[29]||(s[29]=o=>g.value=o)},{actions:a(({next:o,prev:u})=>[l(N,{disabled:!1,class:J(`justify-${g.value!==1?"space-between":"end"}`)},{prev:a(()=>[g.value!==1?(V(),y(M,{key:0,color:"primary",variant:"elevated",onClick:S(u,["stop"])},{default:a(()=>s[35]||(s[35]=[A("Zurück")])),_:2},1032,["onClick"])):k("",!0)]),next:a(()=>[l(M,{color:"secondary",variant:"elevated",class:"text-end",onClick:S(()=>{const _=n.value[g.value-1];_&&Object.values(_.fields).flat().some(q=>!q())||(_&&(_.isValidated=!0),g.value==3?z():o())},["stop"])},{default:a(()=>[A(K(g.value==3?"Speichern":"Weiter"),1)]),_:2},1032,["onClick"])]),_:2},1032,["class"])]),default:a(()=>[l(G,null,{default:a(()=>[(V(!0),C(F,null,Q(n.value,(o,u)=>(V(),C(F,{key:u},[l($,R({ref_for:!0},{editable:d.mode=="edit"||o.isValidated,rules:o.isValidated?Object.values(o.fields).flat():[],step:u,title:o.name,value:u+1}),null,16),u<n.value.length?(V(),y(Y,{key:u})):k("",!0)],64))),128))]),_:1}),l(Z,{onSubmit:S(z,["prevent"])},{default:a(()=>[l(x,null,{default:a(()=>[l(W,{value:1},{default:a(()=>[l(U,null,{default:a(()=>[l(w,null,{default:a(()=>[l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).first_name,"onUpdate:modelValue":s[0]||(s[0]=o=>r(e).first_name=o),label:"Vorname",required:"","error-messages":r(e).errors.first_name,rules:n.value[0].fields.first_name},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).last_name,"onUpdate:modelValue":s[1]||(s[1]=o=>r(e).last_name=o),label:"Nachname",required:"","error-messages":r(e).errors.last_name,rules:n.value[0].fields.last_name},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).email,"onUpdate:modelValue":s[2]||(s[2]=o=>r(e).email=o),label:"Email",required:"","error-messages":r(e).errors.email,rules:n.value[0].fields.email},null,8,["modelValue","error-messages","rules"])]),_:1}),d.mode=="create"?(V(),y(i,{key:0,cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).password,"onUpdate:modelValue":s[3]||(s[3]=o=>r(e).password=o),label:"Passwort",required:"","error-messages":r(e).errors.password,rules:n.value[0].fields.password},null,8,["modelValue","error-messages","rules"])]),_:1})):k("",!0),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"date",modelValue:r(e).date_of_birth,"onUpdate:modelValue":s[4]||(s[4]=o=>r(e).date_of_birth=o),label:"Geburtsdatum (optional)","error-messages":r(e).errors.date_of_birth,rules:n.value[0].fields.date_of_birth},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).staff_number,"onUpdate:modelValue":s[5]||(s[5]=o=>r(e).staff_number=o),label:"Personalnummer (optional)","error-messages":r(e).errors.staff_number},null,8,["modelValue","error-messages"])]),_:1}),l(i,{cols:"12"},{default:a(()=>s[30]||(s[30]=[v("h4",null,"Arbeitszeiten",-1)])),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"number",modelValue:r(e).userWorkingHours,"onUpdate:modelValue":s[6]||(s[6]=o=>r(e).userWorkingHours=o),label:"Trage die wöchentliche Arbeitszeit des Mitarbeitenden ein",required:"","error-messages":r(e).errors.userWorkingHours,rules:n.value[0].fields.userWorkingHours},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(p,{"prepend-icon":"",modelValue:r(e).userWorkingHoursSince,"onUpdate:modelValue":s[7]||(s[7]=o=>r(e).userWorkingHoursSince=o),label:"seit",required:"","error-messages":r(e).errors.userWorkingHoursSince,rules:n.value[0].fields.userWorkingHoursSince},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{chips:"",modelValue:r(e).userWorkingWeek,"onUpdate:modelValue":s[8]||(s[8]=o=>r(e).userWorkingWeek=o),multiple:"",items:r(c).weekdays().map((o,u)=>{var _;return{title:o,value:(_=r(c).weekdays("long",{locale:"en"})[u])==null?void 0:_.toLowerCase()}}),label:"Wähle die Arbeitstage des Mitarbeitenden aus","error-messages":r(e).errors.userWorkingWeek,rules:n.value[0].fields.userWorkingWeek},null,8,["modelValue","items","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(p,{"prepend-icon":"",modelValue:r(e).userWorkingWeekSince,"onUpdate:modelValue":s[9]||(s[9]=o=>r(e).userWorkingWeekSince=o),label:"seit","error-messages":r(e).errors.userWorkingWeekSince,rules:n.value[0].fields.userWorkingWeekSince},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"number",modelValue:r(e).userLeaveDays,"onUpdate:modelValue":s[10]||(s[10]=o=>r(e).userLeaveDays=o),label:"Trage die Jährlichen Urlaubstage des Mitarbeitenden ein","error-messages":r(e).errors.userLeaveDays,rules:n.value[0].fields.userLeaveDays},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"month","prepend-icon":"",modelValue:r(e).userLeaveDaysSince,"onUpdate:modelValue":s[11]||(s[11]=o=>r(e).userLeaveDaysSince=o),label:"seit","error-messages":r(e).errors.userLeaveDaysSince,rules:n.value[0].fields.userLeaveDaysSince},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(O,{modelValue:r(e).home_office,"onUpdate:modelValue":[s[12]||(s[12]=o=>r(e).home_office=o),s[13]||(s[13]=o=>{o||(r(e).home_office_hours_per_week=null)})],label:"Homeoffice","error-messages":r(e).errors.home_office},null,8,["modelValue","error-messages"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"number",modelValue:r(e).home_office_hours_per_week,"onUpdate:modelValue":s[14]||(s[14]=o=>r(e).home_office_hours_per_week=o),label:"Homeoffice Stunden pro Woche (optional)",disabled:!r(e).home_office,"error-messages":r(e).errors.home_office_hours_per_week},null,8,["modelValue","disabled","error-messages"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{type:"date",min:r(f).now().plus({day:1}).toFormat("yyyy-MM-dd"),modelValue:r(e).overtime_calculations_start,"onUpdate:modelValue":s[15]||(s[15]=o=>r(e).overtime_calculations_start=o),label:"Überstundenberechnung ab","error-messages":r(e).errors.overtime_calculations_start,disabled:r(f).fromSQL(r(e).overtime_calculations_start).diff(r(f).now()).toMillis()<0},null,8,["min","modelValue","error-messages","disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(W,{value:2},{default:a(()=>[l(U,null,{default:a(()=>[l(w,null,{default:a(()=>[l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).street,"onUpdate:modelValue":s[16]||(s[16]=o=>r(e).street=o),label:"Straße (optional)","error-messages":r(e).errors.street,rules:n.value[1].fields.street},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).house_number,"onUpdate:modelValue":s[17]||(s[17]=o=>r(e).house_number=o),label:"Hausnummer (optional)","error-messages":r(e).errors.house_number,rules:n.value[1].fields.house_number},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).zip,"onUpdate:modelValue":s[18]||(s[18]=o=>r(e).zip=o),label:"Postleitzahl (optional)","error-messages":r(e).errors.zip,rules:n.value[1].fields.zip},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(m,{modelValue:r(e).city,"onUpdate:modelValue":s[19]||(s[19]=o=>r(e).city=o),label:"Ort (optional)","error-messages":r(e).errors.city,rules:n.value[1].fields.city},null,8,["modelValue","error-messages","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{"data-testid":"land",label:"Land",required:"",items:d.countries,"error-messages":r(e).errors.country,modelValue:r(e).country,"onUpdate:modelValue":s[20]||(s[20]=o=>r(e).country=o),rules:n.value[1].fields.country},null,8,["items","error-messages","modelValue","rules"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{"data-testid":"federal_state",label:"Bundesland",items:r(re)(r(e).country,d.countries),disabled:!r(e).country,required:"","error-messages":r(e).errors.federal_state,modelValue:r(e).federal_state,"onUpdate:modelValue":s[21]||(s[21]=o=>r(e).federal_state=o),rules:n.value[1].fields.federal_state},null,8,["items","disabled","error-messages","modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),l(W,{value:3},{default:a(()=>[l(U,{style:X(d.mode=="create"?{maxHeight:r(se)(72+24*2+52)}:{}),class:"overflow-auto"},{default:a(()=>[l(w,null,{default:a(()=>{var o;return[l(i,{cols:"12"},{default:a(()=>s[31]||(s[31]=[v("h4",null,"Organisation",-1)])),_:1}),l(D,{modelValue:r(e).organizationUser,"onUpdate:modelValue":s[22]||(s[22]=u=>r(e).organizationUser=u),objKey:"organizationUser",permissions:d.permissions,errors:r(e).errors,label:"Organisationsrechte"},null,8,["modelValue","permissions","errors"]),l(i,{cols:"12"},{default:a(()=>s[32]||(s[32]=[v("h4",null,"Betriebsstätte",-1)])),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{modelValue:r(e).operating_site_id,"onUpdate:modelValue":s[23]||(s[23]=u=>r(e).operating_site_id=u),items:d.operating_sites.map(u=>({title:u.name,value:u.id})),label:"Wähle die Betriebsstätte des Mitarbeiters aus.","error-messages":r(e).errors.operating_site_id,rules:n.value[2].fields.operating_site_id,"data-testid":"userOperatingSiteSelection"},null,8,["modelValue","items","error-messages","rules"])]),_:1}),l(D,{modelValue:r(e).operatingSiteUser,"onUpdate:modelValue":s[24]||(s[24]=u=>r(e).operatingSiteUser=u),objKey:"operatingSiteUser",permissions:d.permissions,errors:r(e).errors,label:"Betriebstättenrechte","data-testid":"userOperatingSitePermissions"},null,8,["modelValue","permissions","errors"]),l(i,{cols:"12"},{default:a(()=>s[33]||(s[33]=[v("h4",null,"Abteilung",-1)])),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{modelValue:r(e).group_id,"onUpdate:modelValue":s[25]||(s[25]=u=>r(e).group_id=u),items:d.groups.map(u=>({title:u.name,value:u.id})),label:"Wähle eine Abteilung aus, zu die der Mitarbeiter gehören soll. (optional)","error-messages":r(e).errors.group_id,"data-testid":"userGroupSelection"},null,8,["modelValue","items","error-messages"])]),_:1}),(o=d.user)!=null&&o.group_id?(V(),y(D,{key:0,modelValue:r(e).groupUser,"onUpdate:modelValue":s[26]||(s[26]=u=>r(e).groupUser=u),objKey:"groupUser",permissions:d.permissions,errors:r(e).errors,label:"Abteilungsrechte"},null,8,["modelValue","permissions","errors"])):k("",!0),l(i,{cols:"12"},{default:a(()=>s[34]||(s[34]=[v("h4",null,"Vorgesetzter",-1)])),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(b,{modelValue:r(e).supervisor_id,"onUpdate:modelValue":s[27]||(s[27]=u=>r(e).supervisor_id=u),items:d.supervisors.map(u=>({title:u.first_name+" "+u.last_name,value:u.id})),label:"Wähle einen Vorgesetzten, falls vorhanden (optional)","error-messages":r(e).errors.supervisor_id,"data-testid":"userSupervisorSelection"},null,8,["modelValue","items","error-messages"])]),_:1}),l(i,{cols:"12",md:"6"},{default:a(()=>[l(O,{modelValue:r(e).is_supervisor,"onUpdate:modelValue":s[28]||(s[28]=u=>r(e).is_supervisor=u),label:"Ist ein Vorgesetzter"},null,8,["modelValue"])]),_:1})]}),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),ne=le(oe,[["__scopeId","data-v-ec7ea091"]]);export{ne as default};
