import{d as B,r as w,c as T,a as p,o as n,b as l,f as t,x as E,$ as M,j as V,e as f,i as a,l as m,m as c,E as C,h as _,N as g,O as i,P as N,p as k,s as v,a0 as O,a1 as $,F as K,t as b,K as P,V as z,g as R,I as j,J as A}from"./app-DJJEESTk.js";import{_ as J}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-9pBYe4jG.js";import{a as q}from"./utils-BnXOmM-H.js";const G={key:0},H={key:1},L={key:2},Q={key:0,class:"d-flex ga-2"},Z=B({__name:"CustomerNotes",props:{customerNotes:{},customer:{}},setup(F){const I=F,y=w("show"),x=w(!1),U=T(()=>{const d=new Map;I.customerNotes.forEach(o=>{d.set(o.id,{...o,children:[]})});const e=[];return d.forEach(o=>{if(o.parent_id){const r=d.get(o.parent_id);r&&r.children.push(o)}else e.push(o)}),q(e,"children",()=>!0)}),s=useForm({noteId:null,key:null,value:"",file:null}),u=useForm({type:null,key:null,value:"",parent_id:null,file:null});function D(d){s.noteId=d.id,s.key=d.key,s.value=d.value,s.file=d.file}return(d,e)=>(n(),p(z,{title:"Kundennotizen"},{append:l(()=>[t(P,{"max-width":"1000",modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o)},{activator:l(({props:o})=>[y.value=="edit"&&d.can("customer","update")?(n(),p(m,A({key:0},o,{"append-icon":"mdi-plus",color:"primary",variant:"flat",class:"mr-2"}),{default:l(()=>[...e[15]||(e[15]=[v(" Notiz anlegen ",-1)])]),_:1},16)):f("",!0)]),default:l(({isActive:o})=>[t(C,{onSubmit:c(r=>{a(u).post(d.route("customer.customerNote.store",{customer:d.customer.id}),{onSuccess:()=>{o.value=!1,a(u).reset("parent_id")}})},["prevent"])},{default:l(()=>[t(z,{title:"Notiz anlegen"},{append:l(()=>[t(m,{icon:"",variant:"text",onClick:c(()=>{o.value=!1,a(u).reset("parent_id")},["stop"])},{default:l(()=>[t(k,null,{default:l(()=>[...e[16]||(e[16]=[v("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:l(()=>[t(R,null,{default:l(()=>[t(g,null,{default:l(()=>[t(i,{cols:"12"},{default:l(()=>[t(j,{label:"Anlegungstyp","model-value":a(u).type,"onUpdate:modelValue":e[0]||(e[0]=r=>{a(u).type=r,a(u).value="",a(u).file=null}),items:[{title:"Einzelnotiz",value:"primitive"},{title:"Ordnerstruktur",value:"complex"},{title:"Datei",value:"file"}],clearable:""},null,8,["model-value"])]),_:1}),a(u).type!=="file"?(n(),p(i,{key:0,cols:"12"},{default:l(()=>[t(N,{label:"Bezeichnung",modelValue:a(u).key,"onUpdate:modelValue":e[1]||(e[1]=r=>a(u).key=r),"error-messages":a(u).errors.key},null,8,["modelValue","error-messages"])]),_:1})):f("",!0),a(u).type=="primitive"?(n(),p(i,{key:1,cols:"12"},{default:l(()=>[t(N,{label:"Inhalt",modelValue:a(u).value,"onUpdate:modelValue":e[2]||(e[2]=r=>a(u).value=r),"error-messages":a(u).errors.value},null,8,["modelValue","error-messages"])]),_:1})):f("",!0),a(u).type=="file"?(n(),p(i,{key:2,cols:"12"},{default:l(()=>[t($,{label:"Dateiupload",modelValue:a(u).file,"onUpdate:modelValue":e[3]||(e[3]=r=>a(u).file=r),"error-messages":a(u).errors.file},null,8,["modelValue","error-messages"])]),_:1})):f("",!0),t(i,{cols:"12",class:"text-end"},{default:l(()=>[t(m,{color:"primary",variant:"flat",type:"submit"},{default:l(()=>[...e[17]||(e[17]=[v("Speichern",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:1},8,["modelValue"]),t(m,{"append-icon":"mdi-swap-horizontal",color:"primary",variant:"flat",onClick:e[5]||(e[5]=c(()=>{y.value=="show"?(y.value="edit",a(s).reset()):(y.value="show",a(s).reset())},["stop"])),disabled:!d.can("customer","update")},{default:l(()=>[v(b(y.value=="show"?"Ansichtsmodus":"Bearbeitungsmodus"),1)]),_:1},8,["disabled"])]),default:l(()=>[t(E),t(M,{items:U.value,"item-value":"id",activatable:"","open-on-click":"",separateRoots:"","indent-lines":!0},{prepend:l(({item:o,isOpen:r})=>[o.type=="complex"?(n(),p(k,{key:0,icon:r?"mdi-folder-open":"mdi-folder",color:"primary"},null,8,["icon"])):f("",!0),o.type=="primitive"?(n(),p(k,{key:1,icon:"mdi-comment-text-outline",color:"primary"})):f("",!0),o.type=="file"?(n(),p(k,{key:2,icon:"mdi-file-document",color:"primary"})):f("",!0)]),title:l(({item:o})=>[a(s).noteId==o.id&&y.value=="edit"?(n(),p(C,{key:0,onSubmit:e[14]||(e[14]=c(r=>{a(s).transform(S=>({...S,_method:"patch"})).post(d.route("customerNote.update",{customerNote:a(s).noteId}),{onSuccess:()=>{a(s).reset(),y.value="show"}})},["prevent"]))},{default:l(()=>[_("div",{class:"d-flex ga-2 align-center",onClick:c(()=>{},["stop"])},[o.type=="complex"?(n(),p(g,{key:0},{default:l(()=>[t(i,{cols:"12"},{default:l(()=>[t(N,{variant:"outlined","hide-details":"",modelValue:a(s).key,"onUpdate:modelValue":e[6]||(e[6]=r=>a(s).key=r)},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",class:"text-end"},{default:l(()=>[t(m,{onClick:e[7]||(e[7]=r=>y.value="show"),color:"primary",class:"me-2"},{default:l(()=>[t(k,null,{default:l(()=>[...e[18]||(e[18]=[v("mdi-close",-1)])]),_:1})]),_:1}),t(m,{type:"submit",color:"primary"},{default:l(()=>[t(k,null,{default:l(()=>[...e[19]||(e[19]=[v("mdi-content-save",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):o.type=="primitive"?(n(),p(g,{key:1},{default:l(()=>[t(i,{cols:"12",md:"2"},{default:l(()=>[t(N,{variant:"outlined","hide-details":"",modelValue:a(s).key,"onUpdate:modelValue":e[8]||(e[8]=r=>a(s).key=r)},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"10"},{default:l(()=>[t(O,{rows:"1",variant:"outlined","hide-details":"",modelValue:a(s).value,"onUpdate:modelValue":e[9]||(e[9]=r=>a(s).value=r),"auto-grow":""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",class:"text-end"},{default:l(()=>[t(m,{onClick:e[10]||(e[10]=r=>y.value="show"),color:"primary",class:"me-2"},{default:l(()=>[t(k,null,{default:l(()=>[...e[20]||(e[20]=[v("mdi-close",-1)])]),_:1})]),_:1}),t(m,{type:"submit",color:"primary"},{default:l(()=>[t(k,null,{default:l(()=>[...e[21]||(e[21]=[v("mdi-content-save",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):o.type=="file"?(n(),p(g,{key:2},{default:l(()=>[t(i,{cols:"12",md:"2"},{default:l(()=>[t(N,{variant:"outlined","hide-details":"",modelValue:a(s).key,"onUpdate:modelValue":e[11]||(e[11]=r=>a(s).key=r)},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"10"},{default:l(()=>[t($,{label:"Datei ersetzen",modelValue:a(s).file,"onUpdate:modelValue":e[12]||(e[12]=r=>a(s).file=r),"error-messages":a(u).errors.file},null,8,["modelValue","error-messages"])]),_:1}),t(i,{cols:"12",class:"text-end"},{default:l(()=>[t(m,{onClick:e[13]||(e[13]=r=>y.value="show"),color:"primary",class:"me-2"},{default:l(()=>[t(k,null,{default:l(()=>[...e[22]||(e[22]=[v("mdi-close",-1)])]),_:1})]),_:1}),t(m,{type:"submit",color:"primary"},{default:l(()=>[t(k,null,{default:l(()=>[...e[23]||(e[23]=[v("mdi-content-save",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)])]),_:2},1024)):(n(),V(K,{key:1},[o.type=="complex"?(n(),V("span",G,b(o.key),1)):o.type=="primitive"?(n(),V("span",H,[t(g,null,{default:l(()=>[t(i,{cols:"12",md:"2"},{default:l(()=>[v(b(o.key)+":",1)]),_:2},1024),t(i,{cols:"12",md:"10"},{default:l(()=>[_("pre",null,b(o.value),1)]),_:2},1024)]),_:2},1024)])):o.type=="file"?(n(),V("span",L,b(o.key),1)):f("",!0)],64))]),append:l(({item:o})=>[y.value=="edit"&&!a(s).noteId?(n(),V("div",Q,[o.type=="file"?(n(),p(m,{key:0,color:"primary",href:d.route("customerNote.getFile",{customerNote:o.id,file:o.value}),target:"_blank",icon:"mdi-eye",variant:"text"},null,8,["href"])):f("",!0),o.type=="complex"?(n(),p(m,{key:1,onClick:c(r=>{x.value=!0,a(u).parent_id=o.id},["stop"]),icon:"mdi-plus",color:"primary",variant:"text"},null,8,["onClick"])):f("",!0),t(m,{icon:"mdi-pencil",onClick:c(r=>D(o),["stop"]),variant:"text",color:"primary"},null,8,["onClick"]),t(J,{title:"Notiz löschen",route:d.route("customerNote.destroy",{customerNote:o.id}),content:"Möchtest du "+(o.type=="primitive"?`die Notiz '${o.key}'`:o.type=="complex"?`den Ordner '${o.key}' mit all seinen Inhalten`:`deine hochgeladene Datei '${o.key}'`)+" wirklich löschen?"},null,8,["route","content"])])):f("",!0)]),_:1},8,["items"])]),_:1}))}});export{Z as _};
