import{d as A,D as c,c as F,w as M,r as _,a as f,b as g,S as E,e as s,g as a,y as I,i as O,K as L,p as B,L as N,M as u,P as w,h as r,N as q,a3 as y,a4 as j,m,t as V,v as Q,q as x,V as z,f as D,R as C}from"./app-CrU0wnO9.js";import{D as K}from"./types-BVvW7sCV.js";import{g as R,f as P}from"./utils-DYLd7X5p.js";const J=A({__name:"RecordCreateDialog",props:{users:{},ticket:{},record:{},operatingSites:{}},setup(T){var v,S,b,k;const l=T,e=useForm({start:l.record?c.fromSQL(l.record.start).toISO():null,operatingSite:(v=l.operatingSites.find(i=>i.value.type==="App\\Models\\OperatingSite"))==null?void 0:v.value,duration:R(((S=l.record)==null?void 0:S.duration)??0),description:((b=l.record)==null?void 0:b.description)??"",resources:((k=l.record)==null?void 0:k.resources)??"",files:[]}),p=F(()=>l.record?"edit":"create");M(()=>l.record,()=>{var i,o,d;e.defaults({start:l.record?c.fromSQL(l.record.start).toISO():null,duration:R(((i=l.record)==null?void 0:i.duration)??0),description:((o=l.record)==null?void 0:o.description)??"",resources:((d=l.record)==null?void 0:d.resources)??"",files:[]}).reset()});const n=_(!1);function U(){l.record?e.transform(i=>({...i,_method:"patch"})).post(route("ticketRecord.update",{ticketRecord:l.record.id}),{onSuccess:()=>{e.reset(),n.value=!1}}):e.post(route("ticket.ticketRecord.store",{ticket:l.ticket.id}),{onSuccess:()=>{e.reset(),n.value=!1}})}return(i,o)=>(g(),f(E,{"max-width":"600px",modelValue:n.value,"onUpdate:modelValue":o[6]||(o[6]=d=>n.value=d)},{activator:s(({props:d})=>[p.value==="create"?(g(),f(m,C({key:0,title:"Eintrag hinzufügen"},d,{variant:"text",icon:"mdi-plus"}),null,16)):D("",!0),i.record&&i.can("ticketRecord","update",i.record)?(g(),f(m,C({key:1,title:"Eintrag bearbeiten"},d,{variant:"text"}),{default:s(()=>[a(x,null,{default:s(()=>[...o[7]||(o[7]=[V("mdi-pencil",-1)])]),_:1})]),_:1},16)):D("",!0)]),default:s(({isActive:d})=>[a(z,{title:p.value==="create"?"Eintrag erstellen":"Eintrag bearbeiten"},{append:s(()=>[a(m,{icon:"",variant:"text",onClick:t=>d.value=!1},{default:s(()=>[a(x,null,{default:s(()=>[...o[8]||(o[8]=[V("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:s(()=>[a(I),a(O,{style:{"max-height":"600px","overflow-y":"auto"}},{default:s(()=>[a(L,{onSubmit:B(U,["prevent"])},{default:s(()=>[a(N,null,{default:s(()=>[a(u,{cols:"12",md:"6"},{default:s(()=>[a(w,{label:"Start",type:"datetime-local","model-value":r(c).fromISO(r(e).start??"").toFormat(r(K)),"onUpdate:modelValue":o[0]||(o[0]=t=>{r(e).start=t}),"error-messages":r(e).errors.start,required:""},null,8,["model-value","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:s(()=>[a(w,{label:"Dauer (in Stunden)",type:"time",modelValue:r(e).duration,"onUpdate:modelValue":o[1]||(o[1]=t=>r(e).duration=t),"error-messages":r(e).errors.duration,required:""},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12"},{default:s(()=>[a(q,{label:"Standort",modelValue:r(e).operatingSite,"onUpdate:modelValue":o[2]||(o[2]=t=>r(e).operatingSite=t),items:i.operatingSites.filter(t=>!("customer_id"in t)||t.customer_id===i.ticket.customer_id).map(t=>({title:t.value.type!=="App\\Models\\User"?r(P)(t.address):t.title,value:t.value,props:{subtitle:t.value.type!=="App\\Models\\User"?t.title:""}})),"error-messages":r(e).errors.operatingSite},null,8,["modelValue","items","error-messages"])]),_:1}),a(u,{cols:"12"},{default:s(()=>[a(y,{label:"Beschreibung","max-rows":"10",rows:"2",modelValue:r(e).description,"onUpdate:modelValue":o[3]||(o[3]=t=>r(e).description=t),"error-messages":r(e).errors.description,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12"},{default:s(()=>[a(y,{label:"Ressourcen","max-rows":"10",rows:"2",modelValue:r(e).resources,"onUpdate:modelValue":o[4]||(o[4]=t=>r(e).resources=t),"error-messages":r(e).errors.resources,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12"},{default:s(()=>[a(j,{label:"Dateien anhängen",multiple:"",modelValue:r(e).files,"onUpdate:modelValue":o[5]||(o[5]=t=>r(e).files=t),"error-messages":r(e).errors["files.0"],accept:"image/jpg, image/png, image/jpeg, image/avif, image/tiff, image/svg+xml, application/pdf"},null,8,["modelValue","error-messages"])]),_:1}),a(u,{class:"text-end"},{default:s(()=>[a(m,{color:"primary",type:"submit",loading:r(e).processing,disabled:!r(e).isDirty},{default:s(()=>[V(Q(p.value==="create"?"Speichern":"Änderungen speichern"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]),_:1},8,["modelValue"]))}});export{J as _};
