import{d as Q,r as y,D as v,c as D,w as q,u as G,a as m,o as n,b as c,e as x,f as o,V as J,g as K,h as k,n as X,i as l,j as u,k as Y,F as f,l as b,m as M,p as A,q as N,s as B,t as V,v as Z,x as ee,y as se,z as te,A as ae}from"./app-DJJEESTk.js";import{A as ne}from"./AdminLayout-B8pjDcKt.js";import{t as le,u as oe}from"./utils-BnXOmM-H.js";import{_ as re}from"./AbsenceFilter.vue_vue_type_script_setup_true_lang-C0tzQWFS.js";import{_ as ue,g as de}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-C04ABXp8.js";import{_ as ie}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-huV6bypk.js";import{_ as ce}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-B1NDtdyY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"d-flex flex-wrap align-center"},me={class:"d-flex"},pe={class:"d-flex"},ve={key:1,style:{width:"64px"}},fe={key:0,style:{"max-width":"calc(100vw - 28px * 7)","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:"px-sm-4 px-1"},be={key:0},_e={key:1},Ue=Q({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},date:{},user_absence_filters:{}},setup(L){const g=L,O=route().params.date,a=y(O?v.fromFormat(O,"yyyy-MM"):v.now()),r=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]}),R=D(()=>[].concat(g.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(g.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd")))),P=D(()=>R.value.filter(t=>(r.selected_users.length==0||r.selected_users.includes(t.user_id))&&(r.selected_absence_types.length==0||!t.absence_type_id||r.selected_absence_types.includes(t.absence_type_id))&&(r.selected_statuses.length==0||r.selected_statuses.includes(t.status)))),w=y(!1),U=y(!1),_=y(null),F=y(null),I=y(null),T=D(()=>g.users.find(t=>{var e;return t.id===((e=_.value)==null?void 0:e.user_id)})),C=(()=>{var t,e;return route().params.openAbsence?((t=g.absences)==null?void 0:t.find(s=>s.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=g.absencePatches)==null?void 0:e.find(s=>s.id==Number(route().params.openAbsencePatch)))??null:null})();C&&(_.value=C,F.value=C.user_id,w.value=!0);function E(t,e){F.value=t;const s=P.value.filter(i=>i.user_id===t).find(i=>e&&v.fromSQL(i.start)<=e&&e<=v.fromSQL(i.end));I.value=e??null,_.value=s??null,s&&["hasOpenPatch","created"].includes(de(s))?U.value=!0:w.value=!0}function j(){const t=[];for(let e=1;e<=a.value.daysInMonth;e++)t.push(a.value.startOf("month").plus({day:e-1}));return t}function z(){const t=[];for(let e=1;e<=7;e++)t.push(a.value.startOf("week").plus({day:e-1}));return t}const h=y([a.value.toFormat("yyyy-MM")]),S=y(!1),H=le(()=>{h.value.includes(a.value.toFormat("yyyy-MM"))||ae.reload({only:["absences","absencePatches","holidays"],data:{date:a.value.toFormat("yyyy-MM"),openAbsence:null,openAbsencePatch:null},onStart:()=>{h.value.push(a.value.toFormat("yyyy-MM")),S.value=!0},onError:()=>h.value=h.value.filter(t=>t!=a.value.toFormat("yyyy-MM")),onFinish:()=>S.value=!1})},500);q(a,H);const W=oe(81),d=G();return(t,e)=>(n(),m(ne,{title:"Abwesenheiten"},{default:c(()=>[w.value&&F.value?(n(),m(ie,{key:0,absence_types:t.absence_types,users:t.users,selectedAbsence:_.value,selectedDate:I.value,selectedUser:F.value,"onUpdate:selectedUser":e[0]||(e[0]=s=>F.value=s),modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),onAbsenceReload:e[2]||(e[2]=s=>h.value=[a.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):x("",!0),U.value&&_.value&&T.value?(n(),m(ce,{key:1,absence_types:t.absence_types,users:t.users,selectedAbsence:_.value,absenceUser:T.value,modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=s=>U.value=s),onAbsenceReload:e[4]||(e[4]=s=>h.value=[a.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):x("",!0),o(J,null,{default:c(()=>[o(K,{class:"px-sm-4 px-0"},{default:c(()=>[k("div",{class:X(["d-flex align-center w-100",l(d).mdAndUp.value?"justify-space-between":"justify-center"])},[l(d).mdAndUp.value?(n(),m(re,{key:0,absence_types:t.absence_types,users:t.users,user_absence_filters:t.user_absence_filters,filterForm:l(r),"onUpdate:filterForm":e[5]||(e[5]=s=>Y(r)?r.value=s:null)},null,8,["absence_types","users","user_absence_filters","filterForm"])):x("",!0),k("div",ye,[k("div",me,[l(d).mdAndUp.value?(n(),u(f,{key:0},[o(b,{onClick:e[6]||(e[6]=M(s=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-double-left"})]),_:1}),o(b,{onClick:e[7]||(e[7]=M(s=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-left"})]),_:1})],64)):(n(),m(b,{key:1,onClick:e[8]||(e[8]=M(s=>a.value=a.value.minus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-left"})]),_:1}))]),k("h2",{class:"mx-md-4 text-center",style:N({minWidth:l(d).mdAndUp.value?"170px":"110px"})},[l(d).mdAndUp.value?(n(),u(f,{key:0},[B(V(a.value.toFormat("MMMM yyyy")),1)],64)):(n(),u(f,{key:1},[B(V(a.value.startOf("week").toFormat("dd.MM.yy"))+" - "+V(a.value.endOf("week").toFormat("dd.MM.yy")),1)],64)),S.value?(n(),m(Z,{key:2,indeterminate:""})):x("",!0)],4),k("div",pe,[l(d).mdAndUp.value?(n(),u(f,{key:0},[o(b,{onClick:e[9]||(e[9]=M(s=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-right"})]),_:1}),o(b,{onClick:e[10]||(e[10]=M(s=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-double-right"})]),_:1})],64)):(n(),m(b,{key:1,onClick:e[11]||(e[11]=M(s=>a.value=a.value.plus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:c(()=>[o(A,{icon:"mdi-chevron-right"})]),_:1}))])]),l(d).mdAndUp.value?(n(),u("div",ve)):x("",!0)],2)]),_:1}),o(ee),o(se,{"fixed-header":"",style:N([{"white-space":"pre"},{maxHeight:l(W)}]),id:"absence-table",items:t.users.filter(s=>l(r).selected_users.length==0||l(r).selected_users.includes(s.id)).map(s=>({...s,name:l(d).mdAndUp.value?s.last_name+", "+s.first_name:s.first_name.substring(0,1)+"."+s.last_name})).toSorted((s,i)=>i.id==t.$page.props.auth.user.id?1:s.last_name.localeCompare(i.last_name)),headers:[{title:"Name",key:"name",headerProps:{class:"px-sm-4 px-1"}},...l(d).mdAndUp.value?[{title:"",key:"action",width:"48px",sortable:!1}]:[],...(l(d).mdAndUp.value?j():z()).map((s,i,p)=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.toString(),sortable:!1,align:"center",width:1/p.length*100+"%",headerProps:{class:{"bg-blue-darken-2":s.toISODate()===l(v).local().toISODate()}}}))]},{item:c(({item:s,columns:i})=>[k("tr",null,[(n(!0),u(f,null,te(i,p=>(n(),u(f,{key:p.key},[p.key==="name"?(n(),u("td",fe,V(s.name),1)):p.key==="action"?(n(),u(f,{key:1},[t.can("absence","create",s)?(n(),u("td",be,[o(b,{icon:"mdi-plus",variant:"text",onClick:$=>t.can("absence","create",s)&&E(s.id)},null,8,["onClick"])])):(n(),u("td",_e))],64)):(n(),m(ue,{key:2,onClick:$=>t.can("absence","create",s)&&E(s.id,l(v).fromISO(p.key)),holidays:t.holidays,absenceTypes:t.absence_types,user:s,date:l(v).fromISO(p.key),entries:P.value.filter($=>$.user_id===s.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{Ue as default};
