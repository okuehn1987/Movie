import{d as z,r as m,D as p,c as T,w as Q,u as R,a as y,o as n,b as d,e as w,f as r,V as q,g as G,h as b,i,j as l,k as J,F as x,l as v,m as _,n as h,p as N,q as K,t as E,s as X,v as Y,x as Z,y as ee,z as se}from"./app-2O2uVAYA.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CUHPFcXJ.js";import{t as ae,u as ne}from"./utils-HziHziOu.js";import{_ as le,g as re}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-DLE4C27C.js";import{_ as oe}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-BAbqRFuJ.js";import{_ as ue}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-BaI1I0K1.js";import{_ as de}from"./AbsenceFilter.vue_vue_type_script_setup_true_lang-DbBhItwF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"d-flex justify-space-between align-center w-100"},ce={class:"d-flex justify-center align-center w-100"},me={class:"d-flex"},ye={class:"d-flex"},pe={key:1,style:{width:"64px"}},ve={key:0,style:{"max-width":"calc(100vw - 28px * 7)","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:"px-sm-4 px-1"},fe={key:0},be={key:1},Ue=z({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},user_absence_filters:{}},setup(B){const k=B,D=route().params.date,a=m(D?p.fromFormat(D,"yyyy-MM"):p.now()),o=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]}),$=T(()=>[].concat(k.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(k.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(o.selected_users.length==0||o.selected_users.includes(e.user_id))&&(o.selected_absence_types.length==0||!e.absence_type_id||o.selected_absence_types.includes(e.absence_type_id))&&(o.selected_statuses.length==0||o.selected_statuses.includes(e.status)))),M=m(!1),U=m(!1),f=m(null),g=m(null),I=m(null),O=T(()=>k.users.find(t=>{var e;return t.id===((e=f.value)==null?void 0:e.user_id)})),V=(()=>{var t,e;return route().params.openAbsence?((t=k.absences)==null?void 0:t.find(s=>s.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=k.absencePatches)==null?void 0:e.find(s=>s.id==Number(route().params.openAbsencePatch)))??null:null})();V&&(f.value=V,g.value=V.user_id,M.value=!0);function P(t,e){g.value=t;const s=$.value.filter(c=>c.user_id===t).find(c=>e&&p.fromSQL(c.start)<=e&&e<=p.fromSQL(c.end));I.value=e??null,f.value=s??null,s&&["hasOpenPatch","created"].includes(re(s))?U.value=!0:M.value=!0}function L(){const t=[];for(let e=1;e<=a.value.daysInMonth;e++)t.push(a.value.startOf("month").plus({day:e-1}));return t}function j(){const t=[];for(let e=1;e<=7;e++)t.push(a.value.startOf("week").plus({day:e-1}));return t}const F=m([a.value.toFormat("yyyy-MM")]),C=m(!1),H=ae(()=>{F.value.includes(a.value.toFormat("yyyy-MM"))||se.reload({only:["absences","holidays"],data:{date:a.value.toFormat("yyyy-MM")},onStart:()=>{F.value.push(a.value.toFormat("yyyy-MM")),C.value=!0},onError:()=>F.value=F.value.filter(t=>t!=a.value.toFormat("yyyy-MM")),onFinish:()=>C.value=!1})},500);Q(a,H);const W=ne(81),u=R();return(t,e)=>(n(),y(te,{title:"Abwesenheiten"},{default:d(()=>[M.value&&g.value?(n(),y(oe,{key:0,absence_types:t.absence_types,users:t.users,selectedAbsence:f.value,selectedDate:I.value,selectedUser:g.value,"onUpdate:selectedUser":e[0]||(e[0]=s=>g.value=s),modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=s=>M.value=s)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):w("",!0),U.value&&f.value&&O.value?(n(),y(ue,{key:1,absence_types:t.absence_types,users:t.users,selectedAbsence:f.value,absenceUser:O.value,modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=s=>U.value=s)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):w("",!0),r(q,null,{default:d(()=>[r(G,null,{default:d(()=>[b("div",ie,[l(u).mdAndUp.value?(n(),y(de,{key:0,absence_types:t.absence_types,users:t.users,user_absence_filters:t.user_absence_filters,filterForm:l(o),"onUpdate:filterForm":e[3]||(e[3]=s=>J(o)?o.value=s:null)},null,8,["absence_types","users","user_absence_filters","filterForm"])):w("",!0),b("div",ce,[b("div",me,[l(u).mdAndUp.value?(n(),i(x,{key:0},[r(v,{onClick:e[4]||(e[4]=_(s=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-double-left"})]),_:1}),r(v,{onClick:e[5]||(e[5]=_(s=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-left"})]),_:1})],64)):(n(),y(v,{key:1,onClick:e[6]||(e[6]=_(s=>a.value=a.value.minus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-left"})]),_:1}))]),b("h2",{class:"mx-md-4 text-center",style:N({minWidth:l(u).mdAndUp.value?"170px":"110px"})},[K(E(a.value.toFormat("MMM"+(l(u).smAndUp.value?"M":"")+" yyyy"))+" ",1),C.value?(n(),y(X,{key:0,indeterminate:""})):w("",!0)],4),b("div",ye,[l(u).mdAndUp.value?(n(),i(x,{key:0},[r(v,{onClick:e[7]||(e[7]=_(s=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-right"})]),_:1}),r(v,{onClick:e[8]||(e[8]=_(s=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-double-right"})]),_:1})],64)):(n(),y(v,{key:1,onClick:e[9]||(e[9]=_(s=>a.value=a.value.plus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:d(()=>[r(h,{icon:"mdi-chevron-right"})]),_:1}))])]),l(u).mdAndUp.value?(n(),i("div",pe)):w("",!0)])]),_:1}),r(Y),r(Z,{"fixed-header":"",style:N([{"white-space":"pre"},{maxHeight:l(W)}]),id:"absence-table",items:t.users.filter(s=>l(o).selected_users.length==0||l(o).selected_users.includes(s.id)).map(s=>({...s,name:l(u).mdAndUp.value?s.last_name+", "+s.first_name:s.first_name.substring(0,1)+"."+s.last_name})).toSorted((s,c)=>s.last_name.localeCompare(c.last_name)),headers:[{title:"Name",key:"name",headerProps:{class:"px-sm-4 px-1"}},...l(u).mdAndUp.value?[{title:"",key:"action",width:"48px",sortable:!1}]:[],...(l(u).mdAndUp.value?L():j()).map(s=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.toString(),sortable:!1,align:"center",width:l(u).mdAndUp.value?"44px":"14%",headerProps:{class:{"bg-blue-darken-2":s.toISODate()===l(p).local().toISODate()}}}))]},{item:d(({item:s,columns:c})=>[b("tr",null,[(n(!0),i(x,null,ee(c,A=>(n(),i(x,{key:A.key},[A.key==="name"?(n(),i("td",ve,E(s.name),1)):A.key==="action"?(n(),i(x,{key:1},[t.can("absence","create",s)?(n(),i("td",fe,[r(v,{icon:"mdi-plus",variant:"text",onClick:S=>t.can("absence","create",s)&&P(s.id)},null,8,["onClick"])])):(n(),i("td",be))],64)):(n(),y(le,{key:2,onClick:S=>t.can("absence","create",s)&&P(s.id,l(p).fromISO(A.key)),holidays:t.holidays,absenceTypes:t.absence_types,user:s,date:l(p).fromISO(A.key),entries:$.value.filter(S=>S.user_id===s.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{Ue as default};
