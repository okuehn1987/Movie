import{d as T,as as B,r as C,w as m,at as E,af as R,aa as D,k as h,b as r,j as g,g as v,e as l,f as n,a as u,F as I,A as L,h as i,U as k,v as b,m as N,p as d,B as $,t as w,al as F,q as x,au as A,a3 as K,D as O}from"./app-C5f7Ynnz.js";import V from"./ChatMessage-BpUjwEcR.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"chat-details"},q={id:"messages",class:"messages"},U=["id"],z={key:1,class:"bg-white"},G={class:"d-flex justify-space-between"},H=T({__name:"ChatDetails",props:{chat:{},reachedMonthlyTokenLimit:{type:Boolean},showChat:{type:Boolean}},setup(M){const f=M,{chat:_}=B(f),s=C(_.value);m(_,e=>s.value=e),m(()=>f.showChat,()=>{f.showChat&&setTimeout(y,200)});const t=E({msg:""});function c(){var e;t.clearErrors(),t.post(route("isa.message"),{preserveScroll:!0}),(e=s.value)==null||e.chat_messages.push({id:-1,created_at:O.local().toISO(),msg:t.msg.replaceAll(`
`,"<br>"),role:"user"}),t.reset()}const p=C("");m(s,()=>{p.value="",R(y)},{immediate:!0,deep:!0}),m(p,y,{immediate:!0});function y(){const e=document.getElementById("messages");e&&e.scrollTo({top:e.scrollHeight,behavior:"instant"})}return s.value&&s.value.id>=0&&D("chat."+s.value.id,"ChatMessageDelta",e=>{p.value+=e.msg}),(e,a)=>(r(),h("div",j,[g("div",q,[v(F,{style:{"max-width":"100%"},class:"m-0 px-0 pb-0 pt-2"},{default:l(()=>[s.value&&s.value.chat_messages.length>0?(r(!0),h(I,{key:0},L(s.value.chat_messages.filter(o=>o.role!="annotation"),(o,S)=>(r(),h("div",{key:S.toString(),id:"ChatMessage-"+o.id.toString()},[v(V,{chatMessage:o},null,8,["chatMessage"])],8,U))),128)):n("",!0),i(t).processing?n("",!0):(r(),h("div",z,[e.$page.props.errors.openai?(r(),u(k,{key:0,variant:"tonal",color:"error"},{default:l(()=>[g("div",G,[g("span",null,b(e.$page.props.errors.openai),1),e.$page.props.errors.error_code=="OPENAI_SERVER_ERROR"?(r(),u(N,{key:0,color:"primary",onClick:a[0]||(a[0]=d(o=>i($).post(e.route("chat.retryLastRun",{chat:s.value.id})),["stop"]))},{default:l(()=>[...a[3]||(a[3]=[w(" Erneut senden ",-1)])]),_:1})):n("",!0)])]),_:1})):n("",!0),e.$page.props.errors.msg?(r(),u(k,{key:1,variant:"tonal",color:"error"},{default:l(()=>[w(b(e.$page.props.errors.msg),1)]),_:1})):n("",!0),e.reachedMonthlyTokenLimit?(r(),u(k,{key:2,variant:"tonal",color:"error"},{default:l(()=>[...a[4]||(a[4]=[w(" Dieser Service ist derzeit leider nicht verfÃ¼gbar, bitte wenden Sie sich an den technischen Support ",-1)])]),_:1})):n("",!0)])),i(t).processing||p.value?(r(),u(V,{key:2,chatMessage:{msg:p.value,role:"assistant",id:-1},isLoading:!0,reached_token_limit:null},null,8,["chatMessage"])):n("",!0)]),_:1})]),g("form",{class:"composer mt-2 w-100",onSubmit:d(c,["prevent"])},[v(K,{label:"Geben Sie hier Ihre Frage ein...",modelValue:i(t).msg,"onUpdate:modelValue":a[2]||(a[2]=o=>i(t).msg=o),required:"","auto-grow":"",maxlength:"2000",rows:"1","hide-details":"",autocomplete:"none",disabled:i(t).processing||e.reachedMonthlyTokenLimit,"error-messages":i(t).errors.msg,onKeydown:A(d(c,["ctrl","exact","prevent"]),["enter"]),style:{"user-select":"unset"},title:"Nachricht senden (Strg + Enter)"},{"append-inner":l(()=>[v(x,{style:{opacity:"1"},color:"primary",icon:"mdi-send-variant",class:"pa-6 ps-13 ms-n6",onTouchstart:d(c,["stop","prevent"]),onMousedown:d(c,["stop"]),onClick:a[1]||(a[1]=d(()=>{},["stop"]))})]),_:1},8,["modelValue","disabled","error-messages","onKeydown"])],32)]))}}),X=P(H,[["__scopeId","data-v-4390f4f1"]]);export{X as default};
