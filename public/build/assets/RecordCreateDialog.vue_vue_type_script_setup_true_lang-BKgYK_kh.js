import{d as U,D as c,c as _,w as E,r as I,a as g,b as f,S as O,e as a,g as r,y as L,i as M,K as A,p as B,L as N,M as n,P as w,h as t,N as q,a3 as x,a4 as j,m,t as V,v as Q,q as D,V as z,f as y,R as C}from"./app-VJNhXN4_.js";import{D as K}from"./types-BVvW7sCV.js";import{g as R}from"./utils-CVEOyi26.js";const H=U({__name:"RecordCreateDialog",props:{users:{},ticket:{},record:{},operatingSites:{}},setup(T){var S,v,b,k;const s=T,e=useForm({start:s.record?c.fromSQL(s.record.start).toISO():null,operatingSite:(S=s.operatingSites.find(i=>i.value.type==="App\\Models\\OperatingSite"))==null?void 0:S.value,duration:R(((v=s.record)==null?void 0:v.duration)??0),description:((b=s.record)==null?void 0:b.description)??"",resources:((k=s.record)==null?void 0:k.resources)??"",files:[]}),p=_(()=>s.record?"edit":"create");E(()=>s.record,()=>{var i,o,d;e.defaults({start:s.record?c.fromSQL(s.record.start).toISO():null,duration:R(((i=s.record)==null?void 0:i.duration)??0),description:((o=s.record)==null?void 0:o.description)??"",resources:((d=s.record)==null?void 0:d.resources)??"",files:[]}).reset()});const u=I(!1);function F(){s.record?e.transform(i=>({...i,_method:"patch"})).post(route("ticketRecord.update",{ticketRecord:s.record.id}),{onSuccess:()=>{e.reset(),u.value=!1}}):e.post(route("ticket.ticketRecord.store",{ticket:s.ticket.id}),{onSuccess:()=>{e.reset(),u.value=!1}})}return(i,o)=>(f(),g(O,{"max-width":"600px",modelValue:u.value,"onUpdate:modelValue":o[6]||(o[6]=d=>u.value=d)},{activator:a(({props:d})=>[p.value==="create"?(f(),g(m,C({key:0,title:"Eintrag hinzufügen"},d,{variant:"text",icon:"mdi-plus"}),null,16)):y("",!0),i.record&&i.can("ticketRecord","update",i.record)?(f(),g(m,C({key:1,title:"Eintrag bearbeiten"},d,{variant:"text"}),{default:a(()=>[r(D,null,{default:a(()=>[...o[7]||(o[7]=[V("mdi-pencil",-1)])]),_:1})]),_:1},16)):y("",!0)]),default:a(({isActive:d})=>[r(z,{title:p.value==="create"?"Eintrag erstellen":"Eintrag bearbeiten"},{append:a(()=>[r(m,{icon:"",variant:"text",onClick:l=>d.value=!1},{default:a(()=>[r(D,null,{default:a(()=>[...o[8]||(o[8]=[V("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[r(L),r(M,{style:{"max-height":"600px","overflow-y":"auto"}},{default:a(()=>[r(A,{onSubmit:B(F,["prevent"])},{default:a(()=>[r(N,null,{default:a(()=>[r(n,{cols:"12",md:"6"},{default:a(()=>[r(w,{label:"Start",type:"datetime-local","model-value":t(c).fromISO(t(e).start??"").toFormat(t(K)),"onUpdate:modelValue":o[0]||(o[0]=l=>{t(e).start=l}),"error-messages":t(e).errors.start,required:""},null,8,["model-value","error-messages"])]),_:1}),r(n,{cols:"12",md:"6"},{default:a(()=>[r(w,{label:"Dauer (in Stunden)",type:"time",modelValue:t(e).duration,"onUpdate:modelValue":o[1]||(o[1]=l=>t(e).duration=l),"error-messages":t(e).errors.duration,required:""},null,8,["modelValue","error-messages"])]),_:1}),r(n,{cols:"12"},{default:a(()=>[r(q,{label:"Standort",modelValue:t(e).operatingSite,"onUpdate:modelValue":o[2]||(o[2]=l=>t(e).operatingSite=l),items:i.operatingSites.filter(l=>!("customer_id"in l)||l.customer_id===i.ticket.customer_id),"error-messages":t(e).errors.operatingSite},null,8,["modelValue","items","error-messages"])]),_:1}),r(n,{cols:"12"},{default:a(()=>[r(x,{label:"Beschreibung","max-rows":"10",rows:"2",modelValue:t(e).description,"onUpdate:modelValue":o[3]||(o[3]=l=>t(e).description=l),"error-messages":t(e).errors.description,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),r(n,{cols:"12"},{default:a(()=>[r(x,{label:"Ressourcen","max-rows":"10",rows:"2",modelValue:t(e).resources,"onUpdate:modelValue":o[4]||(o[4]=l=>t(e).resources=l),"error-messages":t(e).errors.resources,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),r(n,{cols:"12"},{default:a(()=>[r(j,{label:"Dateien anhängen",multiple:"",modelValue:t(e).files,"onUpdate:modelValue":o[5]||(o[5]=l=>t(e).files=l),"error-messages":t(e).errors["files.0"],accept:"image/jpg, image/png, image/jpeg, image/avif, image/tiff, image/svg+xml, application/pdf"},null,8,["modelValue","error-messages"])]),_:1}),r(n,{class:"text-end"},{default:a(()=>[r(m,{color:"primary",type:"submit",loading:t(e).processing,disabled:!t(e).isDirty},{default:a(()=>[V(Q(p.value==="create"?"Speichern":"Änderungen speichern"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]),_:1},8,["modelValue"]))}});export{H as _};
