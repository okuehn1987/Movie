import{d as Q,r as d,D as h,c as T,a as q,w as R,o as u,b as k,e as o,f as C,g as l,V as E,h as i,i as J,j as c,m as K,k as y,l as F,n as I,p as W,q as B,s as g,t as S,u as X,v as Y,x as Z,y as ee,z,A as p,B as te,F as U,G as se}from"./app-Bx6eb61E.js";import{_ as ae}from"./AdminLayout.vue_vue_type_script_setup_true_lang-D0w4f-MY.js";import{u as le,t as ne}from"./utils-7g6vxbLM.js";import{_ as oe,g as re}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-BJgL3S5n.js";import{_ as ue}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-BXgkyrSk.js";import{_ as de}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-DIbeZjaR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"d-flex flex-wrap justify-space-between align-center"},ce={class:"d-flex flex-wrap align-center"},me={class:"d-flex"},ye={class:"mx-4 text-center",style:{"min-width":"170px"}},pe={class:"d-flex"},ve={key:0},fe={key:0},be={key:1},we=Q({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{}},setup(L){const v=L,D=route().params.date,a=d(D?h.fromFormat(D,"yyyy-MM"):h.now()),$=T(()=>[].concat(v.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(v.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(r.selected_users.length==0||r.selected_users.includes(e.user_id))&&(r.selected_absence_types.length==0||!e.absence_type_id||r.selected_absence_types.includes(e.absence_type_id))&&(r.selected_statuses.length==0||r.selected_statuses.includes(e.status)))),f=d(!1),M=d(!1),m=d(null),b=d(null),O=d(null),P=T(()=>v.users.find(s=>{var e;return s.id===((e=m.value)==null?void 0:e.user_id)})),A=(()=>{var s,e;return route().params.openAbsence?((s=v.absences)==null?void 0:s.find(t=>t.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=v.absencePatches)==null?void 0:e.find(t=>t.id==Number(route().params.openAbsencePatch)))??null:null})();A&&(m.value=A,b.value=A.user_id,f.value=!0);const r=q({selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]});function N(s,e){b.value=s;const t=$.value.filter(n=>n.user_id===s).find(n=>e&&h.fromSQL(n.start)<=e&&e<=h.fromSQL(n.end));O.value=e??null,m.value=t??null,t&&["hasOpenPatch","created"].includes(re(t))?M.value=!0:f.value=!0}function H(){const s=[];for(let e=1;e<=a.value.daysInMonth;e++)s.push(a.value.startOf("month").plus({day:e-1}));return s}const V=d([a.value.toFormat("yyyy-MM")]),w=d(!1),j=ne(()=>{V.value.includes(a.value.toFormat("yyyy-MM"))||se.reload({only:["absences","holidays"],data:{date:a.value.toFormat("yyyy-MM")},onStart:()=>{V.value.push(a.value.toFormat("yyyy-MM")),w.value=!0},onError:()=>V.value=V.value.filter(s=>s!=a.value.toFormat("yyyy-MM")),onFinish:()=>w.value=!1})},500);R(a,j);const G=le(81);return(s,e)=>(u(),k(ae,{title:"Abwesenheiten"},{default:o(()=>[f.value&&b.value?(u(),k(ue,{key:0,absence_types:s.absence_types,users:s.users,selectedAbsence:m.value,selectedDate:O.value,selectedUser:b.value,"onUpdate:selectedUser":e[0]||(e[0]=t=>b.value=t),modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):C("",!0),M.value&&m.value&&P.value?(u(),k(de,{key:1,absence_types:s.absence_types,users:s.users,selectedAbsence:m.value,absenceUser:P.value,modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=t=>M.value=t)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):C("",!0),l(I,null,{default:o(()=>[l(E,null,{default:o(()=>[i("div",ie,[l(J,{"max-width":"1000"},{activator:o(({props:t})=>[l(c,K(t,{variant:"flat",color:"primary"}),{default:o(()=>[l(y,null,{default:o(()=>e[10]||(e[10]=[F("mdi-filter")])),_:1})]),_:2},1040)]),default:o(({isActive:t})=>[l(I,{title:"Abwesenheiten filtern"},{append:o(()=>[l(c,{icon:"",variant:"text",onClick:n=>t.value=!1},{default:o(()=>[l(y,null,{default:o(()=>e[11]||(e[11]=[F("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:o(()=>[l(E,null,{default:o(()=>[l(W,{label:"Nutzer",items:s.users.map(n=>({title:n.first_name+" "+n.last_name,value:n.id})),modelValue:r.selected_users,"onUpdate:modelValue":e[3]||(e[3]=n=>r.selected_users=n),clearable:"",chips:"",multiple:"",variant:"underlined"},null,8,["items","modelValue"]),l(B,{label:"Abwesenheitsgrund",items:s.absence_types.map(n=>({title:n.name,value:n.id})),modelValue:r.selected_absence_types,"onUpdate:modelValue":e[4]||(e[4]=n=>r.selected_absence_types=n),clearable:"",chips:"",multiple:""},null,8,["items","modelValue"]),l(B,{label:"Abwesenheitsstatus",items:[{title:"Erstellt",value:"created"},{title:"Akzeptiert",value:"accepted"},{title:"Abgelehnt",value:"declined"}],modelValue:r.selected_statuses,"onUpdate:modelValue":e[5]||(e[5]=n=>r.selected_statuses=n),clearable:"",chips:"",multiple:""},null,8,["modelValue"])]),_:1})]),_:2},1024)]),_:1}),i("div",ce,[i("div",me,[l(c,{onClick:e[6]||(e[6]=g(t=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[l(y,{icon:"mdi-chevron-double-left"})]),_:1}),l(c,{onClick:e[7]||(e[7]=g(t=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[l(y,{icon:"mdi-chevron-left"})]),_:1})]),i("h2",ye,[F(S(a.value.toFormat("MMMM yyyy"))+" ",1),w.value?(u(),k(X,{key:0,indeterminate:""})):C("",!0)]),i("div",pe,[l(c,{onClick:e[8]||(e[8]=g(t=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[l(y,{icon:"mdi-chevron-right"})]),_:1}),l(c,{onClick:e[9]||(e[9]=g(t=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[l(y,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[12]||(e[12]=i("div",{style:{width:"64px"}},null,-1))])]),_:1}),l(Y),l(Z,{"fixed-header":"",style:ee([{"white-space":"pre"},{maxHeight:z(G)}]),id:"absence-table",items:s.users.filter(t=>r.selected_users.length==0||r.selected_users.includes(t.id)).map(t=>({...t,name:t.last_name+", "+t.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px",sortable:!1},...H().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":t.toISODate()===z(h).local().toISODate()}}}))]},{item:o(({item:t,columns:n})=>[i("tr",null,[(u(!0),p(U,null,te(n,_=>(u(),p(U,{key:_.key},[_.key==="name"?(u(),p("td",ve,S(t.first_name)+" "+S(t.last_name),1)):_.key==="action"?(u(),p(U,{key:1},[s.can("absence","create",t)?(u(),p("td",fe,[l(c,{icon:"mdi-plus",variant:"text",onClick:x=>s.can("absence","create",t)&&N(t.id)},null,8,["onClick"])])):(u(),p("td",be))],64)):(u(),k(oe,{key:2,onClick:x=>s.can("absence","create",t)&&N(t.id,a.value.startOf("month").plus({day:+(_.key??0)-1})),holidays:s.holidays,absenceTypes:s.absence_types,user:t,date:a.value.startOf("month").plus({day:+(_.key??0)-1}),entries:$.value.filter(x=>x.user_id===t.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{we as default};
