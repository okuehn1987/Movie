import{d as O,B as T,C as $,c as L,R as Q,a as c,o,b as l,f as d,V as z,i as a,e as _,x as G,g as Y,S as j,s as b,t as m,J as H,m as g,K as E,L as u,M as W,O as P,D as I,h as A,j as X,F as Z,l as f,p as x,Q as h}from"./app-BcgYGGYZ.js";const ee={class:"d-flex ga-2 justify-end"},ae=O({__name:"EditCreateAbsence",props:T({users:{},absence_types:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:T(["absenceReload"],["update:modelValue","update:selectedUser"]),setup(y,{emit:J}){var M,U,w,B,S,R,q;const v=J,n=y,i=$(y,"modelValue"),D=$(y,"selectedUser"),p=L(()=>n.users.find(r=>r.id===D.value)),e=useForm({user_id:((M=n.selectedAbsence)==null?void 0:M.user_id)??D.value,start:((U=n.selectedAbsence)==null?void 0:U.start)??((w=n.selectedDate)==null?void 0:w.toFormat("yyyy-MM-dd"))??null,end:((B=n.selectedAbsence)==null?void 0:B.end)??((S=n.selectedDate)==null?void 0:S.toFormat("yyyy-MM-dd"))??null,absence_type_id:((R=n.selectedAbsence)==null?void 0:R.absence_type_id)??null,absence_id:n.selectedAbsence&&"absence_id"in n.selectedAbsence?n.selectedAbsence.absence_id:((q=n.selectedAbsence)==null?void 0:q.id)??null});function K(){e.absence_id?e.post(route("absence.absencePatch.store",{absence:e.absence_id}),{onSuccess:()=>{e.reset(),i.value=!1,v("absenceReload")}}):e.post(route("absence.store"),{onSuccess:()=>{e.reset(),i.value=!1,v("absenceReload")}})}const F=useForm({});function k(){n.selectedAbsence&&F.delete(route("absence.destroy",{absence:"absence_id"in n.selectedAbsence?n.selectedAbsence.absence_id:n.selectedAbsence.id}),{onSuccess:()=>{i.value=!1,v("absenceReload")}})}const C=L(()=>{const r=n.absence_types.find(t=>t.id===e.absence_type_id);return!n.selectedAbsence||(r==null?void 0:r.requires_approval)&&Q().props.auth.user.supervisor_id});return(r,t)=>(o(),c(h,{"max-width":"1000",modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=V=>i.value=V)},{default:l(({isActive:V})=>{var N;return[d(z,{title:"Abwesenheit"+(a(e).user_id!=r.$page.props.auth.user.id?" von "+((N=r.users.map(s=>({...s,name:s.first_name+" "+s.last_name})).find(s=>s.id===a(e).user_id))==null?void 0:N.name):"")+(r.can("absence","update",r.users.find(s=>s.id==a(e).user_id))||!C.value?" bearbeiten":" beantragen")},{append:l(()=>[d(f,{icon:"",variant:"text",onClick:s=>{V.value=!1,a(e).reset()}},{default:l(()=>[d(x,null,{default:l(()=>[...t[6]||(t[6]=[b("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:l(()=>[d(G),a(e).errors.user_id?(o(),c(Y,{key:0},{default:l(()=>[d(j,{color:"error",closable:""},{default:l(()=>[b(m(a(e).errors.user_id),1)]),_:1})]),_:1})):_("",!0),d(Y,null,{default:l(()=>[d(H,{onSubmit:g(K,["prevent"])},{default:l(()=>[d(E,null,{default:l(()=>[d(u,{cols:"12"},{default:l(()=>[d(W,{label:"Abwesenheitsgrund angeben",items:r.absence_types.map(s=>({title:s.name,value:s.id})),modelValue:a(e).absence_type_id,"onUpdate:modelValue":t[0]||(t[0]=s=>a(e).absence_type_id=s),"error-messages":a(e).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),d(u,{cols:"12",md:"6"},{default:l(()=>[d(P,{type:"date",label:"Von",modelValue:a(e).start,"onUpdate:modelValue":t[1]||(t[1]=s=>a(e).start=s),"error-messages":a(e).errors.start},null,8,["modelValue","error-messages"])]),_:1}),d(u,{cols:"12",md:"6"},{default:l(()=>[d(P,{type:"date",label:"Bis",modelValue:a(e).end,"onUpdate:modelValue":t[2]||(t[2]=s=>a(e).end=s),"error-messages":a(e).errors.end},null,8,["modelValue","error-messages"])]),_:1}),p.value&&p.value.leaveDaysForYear&&(!r.selectedDate||r.selectedDate.year==a(I).now().year)?(o(),c(j,{key:0,type:"info",class:"w-100"},{default:l(()=>[d(E,null,{default:l(()=>[d(u,{cols:"12",md:"6"},{default:l(()=>[A("div",null,"Bereits verwendete Urlaubstage für "+m(a(I).now().year),1)]),_:1}),d(u,{cols:"12",md:"6"},{default:l(()=>[A("div",null,m(p.value.usedLeaveDaysForYear)+" von "+m(p.value.leaveDaysForYear),1)]),_:1})]),_:1})]),_:1})):_("",!0),d(u,{cols:"12"},{default:l(()=>[A("div",ee,[r.selectedAbsence?(o(),X(Z,{key:0},[r.can("absence","update",r.users.find(s=>s.id==a(e).user_id))?(o(),c(f,{key:0,onClick:t[3]||(t[3]=g(s=>k(),["stop"])),color:"error",loading:a(F).processing},{default:l(()=>[...t[7]||(t[7]=[b(" löschen ",-1)])]),_:1},8,["loading"])):(o(),c(f,{key:1,onClick:t[4]||(t[4]=g(s=>k(),["stop"])),color:"error"},{default:l(()=>[...t[8]||(t[8]=[b("Löschung beantragen",-1)])]),_:1}))],64)):_("",!0),d(f,{loading:a(e).processing,type:"submit",color:"primary",disabled:!a(e).isDirty},{default:l(()=>[b(m(r.can("absence","update",r.users.find(s=>s.id==a(e).user_id))||!C.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{ae as _};
