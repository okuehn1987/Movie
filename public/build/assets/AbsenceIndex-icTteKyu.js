import{d as P,n as j,r as x,D as g,C as z,w as E,a as G,o as d,c as V,b as s,e as t,V as I,u as r,f as y,g as f,h as w,i as C,j as J,t as k,k as L,l as Q,m as v,p as q,q as h,s as R,v as K,x as u,y as W,z as X,A as Y,B as Z,E as p,F as ee,G as S,H as te}from"./app-D-F7VYJF.js";import{_ as ae}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BXi7xKaC.js";import{u as se,g as ne,t as le}from"./utils-Dy6YOIcV.js";import{_ as oe}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-Sq5Fr-Dw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"d-flex flex-wrap justify-space-between align-center"},ie={style:{width:"30px"}},de={class:"d-flex flex-wrap align-center"},ue={class:"d-flex"},me={class:"mx-4 text-center",style:{"min-width":"170px"}},ye={class:"d-flex"},ce={key:0},pe={key:0},fe={key:1},ke=P({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{},holidays:{}},setup(N){const T=N,D=j(),F=route().params.date,o=x(F?g.fromFormat(F,"yyyy-MM"):g.now());function U(){const i=[];for(let e=1;e<=o.value.daysInMonth;e++)i.push(o.value.startOf("month").plus({day:e-1}));return i}const M=x(!1),l=z({user_id:D.props.auth.user.id,start:null,end:null,absence_type_id:null});function $(i,e){l.reset();const c=T.absences.filter(a=>a.user_id===i).find(a=>e&&g.fromSQL(a.start)<=e&&e<=g.fromSQL(a.end));l.user_id=i,l.end=(e==null?void 0:e.toJSDate())??null,l.start=(e==null?void 0:e.toJSDate())??null,l.absence_type_id=(c==null?void 0:c.absence_type_id)??null,M.value=!0}const _=x([o.value.toFormat("yyyy-MM")]),H=le(()=>{_.value.includes(o.value.toFormat("yyyy-MM"))||te.reload({only:["absences","holidays"],data:{date:o.value.toFormat("yyyy-MM")},onStart:()=>_.value.push(o.value.toFormat("yyyy-MM")),onError:()=>_.value=_.value.filter(i=>i!=o.value.toFormat("yyyy-MM"))})},500);E(o,H);const O=se();return(i,e)=>{const c=G("v-date-input");return d(),V(ae,{title:"Abwesenheiten"},{default:s(()=>[t(K,{"max-width":"1000",modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=a=>M.value=a)},{default:s(({isActive:a})=>{var b;return[t(I,{title:"Abwesenheit"+(r(l).user_id!=r(D).props.auth.user.id?" von "+((b=i.users.map(n=>({...n,name:n.first_name+" "+n.last_name})).find(n=>n.id===r(l).user_id))==null?void 0:b.name):"")+" beantragen"},{append:s(()=>[t(y,{icon:"",variant:"text",onClick:n=>a.value=!1},{default:s(()=>[t(f,null,{default:s(()=>e[8]||(e[8]=[w("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[r(l).errors.user_id?(d(),V(C,{key:0},{default:s(()=>[t(J,{color:"error",closable:""},{default:s(()=>[w(k(r(l).errors.user_id),1)]),_:1})]),_:1})):L("",!0),t(C,null,{default:s(()=>[t(Q,{onSubmit:v(n=>{r(l).transform(m=>{var B,A;return{...m,start:(B=m.start)==null?void 0:B.toLocaleDateString(),end:(A=m.end)==null?void 0:A.toLocaleDateString()}}).post(i.route("absence.store"),{onSuccess:()=>{r(l).reset(),a.value=!1}})},["prevent"])},{default:s(()=>[t(q,null,{default:s(()=>[t(h,{cols:"12"},{default:s(()=>[t(R,{label:"Abwesenheitsgrund angeben",items:i.absence_types.map(n=>({title:n.name,value:n.id})),modelValue:r(l).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=n=>r(l).absence_type_id=n),"error-messages":r(l).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),t(h,{cols:"12",md:"6"},{default:s(()=>[t(c,{label:"Von",modelValue:r(l).start,"onUpdate:modelValue":e[1]||(e[1]=n=>r(l).start=n),"error-messages":r(l).errors.start},null,8,["modelValue","error-messages"])]),_:1}),t(h,{cols:"12",md:"6"},{default:s(()=>[t(c,{label:"Bis",modelValue:r(l).end,"onUpdate:modelValue":e[2]||(e[2]=n=>r(l).end=n),"error-messages":r(l).errors.end},null,8,["modelValue","error-messages"])]),_:1}),t(h,{cols:"12",class:"text-end"},{default:s(()=>[t(y,{loading:r(l).processing,type:"submit",color:"primary"},{default:s(()=>e[9]||(e[9]=[w("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),t(I,null,{default:s(()=>[t(C,null,{default:s(()=>[u("div",re,[u("div",ie,[r(O)?(d(),V(W,{key:0,indeterminate:""})):L("",!0)]),u("div",de,[u("div",ue,[t(y,{onClick:e[4]||(e[4]=v(a=>o.value=o.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-left"})]),_:1}),t(y,{onClick:e[5]||(e[5]=v(a=>o.value=o.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",me,k(o.value.toFormat("MMMM yyyy")),1),u("div",ye,[t(y,{onClick:e[6]||(e[6]=v(a=>o.value=o.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-right"})]),_:1}),t(y,{onClick:e[7]||(e[7]=v(a=>o.value=o.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[10]||(e[10]=u("div",{style:{width:"30px"}},null,-1))])]),_:1}),t(X),t(Y,{"fixed-header":"",style:Z([{"white-space":"pre"},{maxHeight:r(ne)(81)}]),id:"absence-table",items:i.users,headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...U().map(a=>({title:a.weekdayShort+`
`+a.day.toString(),key:a.day.toString(),sortable:!1,align:"center"}))]},{item:s(({item:a,columns:b})=>[u("tr",null,[(d(!0),p(S,null,ee(b,n=>(d(),p(S,{key:n.key},[n.key==="name"?(d(),p("td",ce,k(a.first_name)+" "+k(a.last_name),1)):n.key==="action"?(d(),p(S,{key:1},[i.can("absence","create",a)?(d(),p("td",pe,[t(y,{icon:"mdi-plus",variant:"text",onClick:m=>i.can("absence","create",a)&&$(a.id)},null,8,["onClick"])])):(d(),p("td",fe))],64)):(d(),V(oe,{key:2,onClick:m=>i.can("absence","create",a)&&$(a.id,o.value.startOf("month").plus({day:+(n.key??0)-1})),holidays:i.holidays,absenceTypes:i.absence_types,user:a,date:o.value.startOf("month").plus({day:+(n.key??0)-1}),absences:i.absences.filter(m=>m.user_id===a.id)},null,8,["onClick","holidays","absenceTypes","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1})}}});export{ke as default};
