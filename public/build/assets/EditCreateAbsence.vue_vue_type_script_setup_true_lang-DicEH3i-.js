import{d as I,B as q,C as N,c as O,R as J,a as u,o,b as l,f as n,V as K,i as t,e as c,x as Q,g as L,S as Y,s as b,t as m,J as z,m as g,K as j,L as i,M as G,O as E,D as P,h as A,j as W,F as X,l as y,p as Z,Q as x}from"./app-pKUTtkyq.js";const ee={class:"d-flex ga-2 justify-end"},ae=I({__name:"EditCreateAbsence",props:q({users:{},absenceTypes:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:q(["absenceReload"],["update:modelValue","update:selectedUser"]),setup(v,{emit:h}){var M,U,w,B,S,T,R;const _=h,r=v,p=N(v,"modelValue"),D=N(v,"selectedUser"),f=O(()=>r.users.find(s=>s.id===D.value)),e=useForm({user_id:((M=r.selectedAbsence)==null?void 0:M.user_id)??D.value,start:((U=r.selectedAbsence)==null?void 0:U.start)??((w=r.selectedDate)==null?void 0:w.toFormat("yyyy-MM-dd"))??null,end:((B=r.selectedAbsence)==null?void 0:B.end)??((S=r.selectedDate)==null?void 0:S.toFormat("yyyy-MM-dd"))??null,absence_type_id:((T=r.selectedAbsence)==null?void 0:T.absence_type_id)??null,absence_id:r.selectedAbsence&&"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:((R=r.selectedAbsence)==null?void 0:R.id)??null});function H(){const s={onSuccess:()=>{e.reset(),p.value=!1,_("absenceReload")}};e.absence_type_id=="homeOffice"?e.post(route("homeOfficeDay.store"),s):e.absence_id?e.post(route("absence.absencePatch.store",{absence:e.absence_id}),s):e.post(route("absence.store"),s)}const k=useForm({});function F(){r.selectedAbsence&&k.delete(route("absence.destroy",{absence:"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:r.selectedAbsence.id}),{onSuccess:()=>{p.value=!1,_("absenceReload")}})}const C=O(()=>{const s=r.absenceTypes.find(d=>d.id===e.absence_type_id);return!r.selectedAbsence||(s==null?void 0:s.requires_approval)&&J().props.auth.user.supervisor_id});return(s,d)=>(o(),u(x,{"max-width":"1000",modelValue:p.value,"onUpdate:modelValue":d[5]||(d[5]=V=>p.value=V)},{default:l(({isActive:V})=>{var $;return[n(K,{title:"Abwesenheit"+(t(e).user_id!=s.$page.props.auth.user.id?" von "+(($=s.users.map(a=>({...a,name:a.first_name+" "+a.last_name})).find(a=>a.id===t(e).user_id))==null?void 0:$.name):"")+(s.can("absence","update",s.users.find(a=>a.id==t(e).user_id))||!C.value?" bearbeiten":" beantragen")},{append:l(()=>[n(y,{icon:"",variant:"text",onClick:a=>{V.value=!1,t(e).reset()}},{default:l(()=>[n(Z,null,{default:l(()=>[...d[6]||(d[6]=[b("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:l(()=>[n(Q),t(e).errors.user_id?(o(),u(L,{key:0},{default:l(()=>[n(Y,{color:"error",closable:""},{default:l(()=>[b(m(t(e).errors.user_id),1)]),_:1})]),_:1})):c("",!0),n(L,null,{default:l(()=>[n(z,{onSubmit:g(H,["prevent"])},{default:l(()=>[n(j,null,{default:l(()=>[n(i,{cols:"12"},{default:l(()=>[n(G,{label:"Abwesenheitsgrund angeben",items:[...s.absenceTypes.map(a=>({title:a.name,value:a.id})),s.$page.props.auth.user.home_office&&{title:"Homeoffice",value:"homeOffice"}].filter(Boolean),modelValue:t(e).absence_type_id,"onUpdate:modelValue":d[0]||(d[0]=a=>t(e).absence_type_id=a),"error-messages":t(e).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),n(i,{cols:"12",md:"6"},{default:l(()=>[n(E,{type:"date",label:"Von",modelValue:t(e).start,"onUpdate:modelValue":d[1]||(d[1]=a=>t(e).start=a),"error-messages":t(e).errors.start},null,8,["modelValue","error-messages"])]),_:1}),n(i,{cols:"12",md:"6"},{default:l(()=>[n(E,{type:"date",label:"Bis",modelValue:t(e).end,"onUpdate:modelValue":d[2]||(d[2]=a=>t(e).end=a),"error-messages":t(e).errors.end},null,8,["modelValue","error-messages"])]),_:1}),f.value&&f.value.leaveDaysForYear&&(!s.selectedDate||s.selectedDate.year==t(P).now().year)?(o(),u(Y,{key:0,type:"info",class:"w-100"},{default:l(()=>[n(j,null,{default:l(()=>[n(i,{cols:"12",md:"6"},{default:l(()=>[A("div",null,"Bereits verwendete Urlaubstage für "+m(t(P).now().year),1)]),_:1}),n(i,{cols:"12",md:"6"},{default:l(()=>[A("div",null,m(f.value.usedLeaveDaysForYear)+" von "+m(f.value.leaveDaysForYear),1)]),_:1})]),_:1})]),_:1})):c("",!0),n(i,{cols:"12"},{default:l(()=>[A("div",ee,[s.selectedAbsence?(o(),W(X,{key:0},[s.can("absence","update",s.users.find(a=>a.id==t(e).user_id))?(o(),u(y,{key:0,onClick:d[3]||(d[3]=g(a=>F(),["stop"])),color:"error",loading:t(k).processing},{default:l(()=>[...d[7]||(d[7]=[b(" löschen ",-1)])]),_:1},8,["loading"])):s.selectedAbsence.status!=="declined"?(o(),u(y,{key:1,onClick:d[4]||(d[4]=g(a=>F(),["stop"])),color:"error"},{default:l(()=>[...d[8]||(d[8]=[b(" Löschung beantragen ",-1)])]),_:1})):c("",!0)],64)):c("",!0),!s.selectedAbsence||s.selectedAbsence.status!=="declined"?(o(),u(y,{key:1,loading:t(e).processing,type:"submit",color:"primary",disabled:!t(e).isDirty},{default:l(()=>[b(m(s.can("absence","update",s.users.find(a=>a.id==t(e).user_id))||!C.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])):c("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{ae as _};
