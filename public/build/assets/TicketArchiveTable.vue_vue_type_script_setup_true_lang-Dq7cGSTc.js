import{P as u}from"./types-BVvW7sCV.js";import{e as S}from"./utils-CFbo0MUH.js";import{d as b,a6 as N,a as _,o as y,b as s,f as c,y as w,i as a,k as h,e as M,a4 as $,s as p,t as d,p as C,D as f,V as D}from"./app-ButPoTbx.js";import{_ as I}from"./TicketArchiveFilter.vue_vue_type_script_setup_true_lang-QDBzcLh3.js";import{_ as R}from"./TicketShowDialog.vue_vue_type_script_setup_true_lang-DTey6HUA.js";import{_ as x}from"./TicketFinishDialog.vue_vue_type_script_setup_true_lang-aJAZDfu-.js";const O=b({__name:"TicketArchiveTable",props:{archiveTickets:{},customers:{},users:{},operatingSites:{}},setup(k){const V=k,{currentPage:m,lastPage:g,data:v,itemsPerPage:T}=S(N(V),"archiveTickets",{tab:"archive"});function P(r){const n=r.sort((o,i)=>o.accounted_at?i.accounted_at?i.accounted_at.localeCompare(o.accounted_at):-1:1);if(!n[0])return"-";const e=f.fromSQL(n[0].accounted_at??"");return e.isValid?e.toFormat("dd.MM.yyyy HH:mm"):"-"}return(r,n)=>(y(),_(D,null,{default:s(()=>[c(w,{"fixed-header":"",page:a(m),"onUpdate:page":n[1]||(n[1]=e=>h(m)?m.value=e:null),itemsPerPage:a(T),headers:[{title:"Ticket",key:"reference_number",width:"1px"},{title:"Datum",key:"created_at",width:"1px"},{title:"Titel",key:"title"},{title:"Kunde",key:"customer.name"},{title:"Termin",key:"appointment_at"},{title:"Zugewiesen an",key:"assigneeName"},{title:"Abgerechnet am",key:"accounted_at"},{title:"",key:"actions",align:"end",width:"250px",sortable:!1}],items:a(v).map(e=>{var i,l;const o=(()=>{if(e.assignees.length==0)return null;const t=e.assignees[0];return e.assignees.length==1?t.first_name+" "+t.last_name:`${t.first_name} ${t.last_name} (+${e.assignees.length-1} weitere)`})();return{...e,user:{...e.user,name:e.user.first_name+" "+e.user.last_name},assigneeName:o,priorityText:(i=a(u).find(t=>t.value===e.priority))==null?void 0:i.title,priorityValue:(l=a(u).find(t=>t.value===e.priority))==null?void 0:l.priorityValue,assigneesNames:e.assignees.map(t=>t.first_name+t.last_name).join("")}}),hover:""},{"header.actions":s(()=>[c(I,{customers:r.customers,users:r.users,"operating-sites":r.operatingSites},null,8,["customers","users","operating-sites"])]),"item.created_at":s(({item:e})=>[p(d(a(f).fromISO(e.created_at).toFormat("dd.MM.yyyy")),1)]),"item.appointment_at":s(({item:e})=>[p(d(e.appointment_at?a(f).fromSQL(e.appointment_at).toFormat("dd.MM. 'um' HH:mm 'Uhr'"):"-"),1)]),"item.priorityText":s(({item:e})=>{var o,i,l;return[c(C,{title:(o=a(u).find(t=>t.value===e.priority))==null?void 0:o.title,icon:(i=a(u).find(t=>t.value===e.priority))==null?void 0:i.icon,color:(l=a(u).find(t=>t.value===e.priority))==null?void 0:l.color},null,8,["title","icon","color"])]}),"item.assigneeName":s(({item:e})=>[p(d(e.assigneeName),1)]),"item.accounted_at":s(({item:e})=>[p(d(P(e.records)),1)]),"item.actions":s(({item:e})=>[c(x,{tab:"archive",item:e},null,8,["item"]),c(R,{ticket:e,customers:r.customers,users:r.users,tab:"archive",operatingSites:r.operatingSites},null,8,["ticket","customers","users","operatingSites"])]),bottom:s(()=>[a(g)>1?(y(),_($,{key:0,modelValue:a(m),"onUpdate:modelValue":n[0]||(n[0]=e=>h(m)?m.value=e:null),length:a(g)},null,8,["modelValue","length"])):M("",!0)]),_:1},8,["page","itemsPerPage","items"])]),_:1}))}});export{O as _};
