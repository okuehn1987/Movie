import{d as Q,r as y,D as p,c as N,w as R,u as q,a as m,o as n,b as i,e as x,f as r,V as G,g as J,h as _,i as u,j as l,k as K,F as v,l as f,m as h,n as k,p as E,q as B,t as V,s as X,v as Y,x as Z,y as ee,z as se}from"./app-BMeyp9cU.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-B8LQrgKu.js";import{t as ae,u as ne}from"./utils-Q01cmoc-.js";import{_ as le,g as re}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-B6KgWyhG.js";import{_ as oe}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-cZv4Q67A.js";import{_ as ue}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-CJGRsYvc.js";import{_ as de}from"./AbsenceFilter.vue_vue_type_script_setup_true_lang-CQfPw6Bm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"d-flex justify-space-between align-center w-100"},ce={class:"d-flex justify-center align-center w-100"},ye={class:"d-flex"},me={class:"d-flex"},pe={key:1,style:{width:"64px"}},ve={key:0,style:{"max-width":"calc(100vw - 28px * 7)","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:"px-sm-4 px-1"},fe={key:0},be={key:1},Fe=Q({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},user_absence_filters:{}},setup(L){const M=L,O=route().params.date,a=y(O?p.fromFormat(O,"yyyy-MM"):p.now()),o=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]}),$=N(()=>[].concat(M.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(M.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(o.selected_users.length==0||o.selected_users.includes(e.user_id))&&(o.selected_absence_types.length==0||!e.absence_type_id||o.selected_absence_types.includes(e.absence_type_id))&&(o.selected_statuses.length==0||o.selected_statuses.includes(e.status)))),g=y(!1),F=y(!1),b=y(null),w=y(null),I=y(null),P=N(()=>M.users.find(t=>{var e;return t.id===((e=b.value)==null?void 0:e.user_id)})),C=(()=>{var t,e;return route().params.openAbsence?((t=M.absences)==null?void 0:t.find(s=>s.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=M.absencePatches)==null?void 0:e.find(s=>s.id==Number(route().params.openAbsencePatch)))??null:null})();C&&(b.value=C,w.value=C.user_id,g.value=!0);function T(t,e){w.value=t;const s=$.value.filter(c=>c.user_id===t).find(c=>e&&p.fromSQL(c.start)<=e&&e<=p.fromSQL(c.end));I.value=e??null,b.value=s??null,s&&["hasOpenPatch","created"].includes(re(s))?F.value=!0:g.value=!0}function j(){const t=[];for(let e=1;e<=a.value.daysInMonth;e++)t.push(a.value.startOf("month").plus({day:e-1}));return t}function H(){const t=[];for(let e=1;e<=7;e++)t.push(a.value.startOf("week").plus({day:e-1}));return t}const U=y([a.value.toFormat("yyyy-MM")]),S=y(!1),W=ae(()=>{U.value.includes(a.value.toFormat("yyyy-MM"))||se.reload({only:["absences","holidays"],data:{date:a.value.toFormat("yyyy-MM")},onStart:()=>{U.value.push(a.value.toFormat("yyyy-MM")),S.value=!0},onError:()=>U.value=U.value.filter(t=>t!=a.value.toFormat("yyyy-MM")),onFinish:()=>S.value=!1})},500);R(a,W);const z=ne(81),d=q();return(t,e)=>(n(),m(te,{title:"Abwesenheiten"},{default:i(()=>[g.value&&w.value?(n(),m(oe,{key:0,absence_types:t.absence_types,users:t.users,selectedAbsence:b.value,selectedDate:I.value,selectedUser:w.value,"onUpdate:selectedUser":e[0]||(e[0]=s=>w.value=s),modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):x("",!0),F.value&&b.value&&P.value?(n(),m(ue,{key:1,absence_types:t.absence_types,users:t.users,selectedAbsence:b.value,absenceUser:P.value,modelValue:F.value,"onUpdate:modelValue":e[2]||(e[2]=s=>F.value=s)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):x("",!0),r(G,null,{default:i(()=>[r(J,null,{default:i(()=>[_("div",ie,[l(d).mdAndUp.value?(n(),m(de,{key:0,absence_types:t.absence_types,users:t.users,user_absence_filters:t.user_absence_filters,filterForm:l(o),"onUpdate:filterForm":e[3]||(e[3]=s=>K(o)?o.value=s:null)},null,8,["absence_types","users","user_absence_filters","filterForm"])):x("",!0),_("div",ce,[_("div",ye,[l(d).mdAndUp.value?(n(),u(v,{key:0},[r(f,{onClick:e[4]||(e[4]=h(s=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-double-left"})]),_:1}),r(f,{onClick:e[5]||(e[5]=h(s=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-left"})]),_:1})],64)):(n(),m(f,{key:1,onClick:e[6]||(e[6]=h(s=>a.value=a.value.minus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-left"})]),_:1}))]),_("h2",{class:"mx-md-4 text-center",style:E({minWidth:l(d).mdAndUp.value?"170px":"110px"})},[l(d).smAndUp.value?(n(),u(v,{key:0},[B(V(a.value.toFormat("MMMM yyyy")),1)],64)):(n(),u(v,{key:1},[B(V(a.value.startOf("week").toFormat("dd.MM.yyyy"))+" - "+V(a.value.endOf("week").toFormat("dd.MM.yyyy")),1)],64)),S.value?(n(),m(X,{key:2,indeterminate:""})):x("",!0)],4),_("div",me,[l(d).mdAndUp.value?(n(),u(v,{key:0},[r(f,{onClick:e[7]||(e[7]=h(s=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-right"})]),_:1}),r(f,{onClick:e[8]||(e[8]=h(s=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-double-right"})]),_:1})],64)):(n(),m(f,{key:1,onClick:e[9]||(e[9]=h(s=>a.value=a.value.plus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[r(k,{icon:"mdi-chevron-right"})]),_:1}))])]),l(d).mdAndUp.value?(n(),u("div",pe)):x("",!0)])]),_:1}),r(Y),r(Z,{"fixed-header":"",style:E([{"white-space":"pre"},{maxHeight:l(z)}]),id:"absence-table",items:t.users.filter(s=>l(o).selected_users.length==0||l(o).selected_users.includes(s.id)).map(s=>({...s,name:l(d).mdAndUp.value?s.last_name+", "+s.first_name:s.first_name.substring(0,1)+"."+s.last_name})).toSorted((s,c)=>s.last_name.localeCompare(c.last_name)),headers:[{title:"Name",key:"name",headerProps:{class:"px-sm-4 px-1"}},...l(d).mdAndUp.value?[{title:"",key:"action",width:"48px",sortable:!1}]:[],...(l(d).mdAndUp.value?j():H()).map(s=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.toString(),sortable:!1,align:"center",width:l(d).mdAndUp.value?"44px":"14%",headerProps:{class:{"bg-blue-darken-2":s.toISODate()===l(p).local().toISODate()}}}))]},{item:i(({item:s,columns:c})=>[_("tr",null,[(n(!0),u(v,null,ee(c,A=>(n(),u(v,{key:A.key},[A.key==="name"?(n(),u("td",ve,V(s.name),1)):A.key==="action"?(n(),u(v,{key:1},[t.can("absence","create",s)?(n(),u("td",fe,[r(f,{icon:"mdi-plus",variant:"text",onClick:D=>t.can("absence","create",s)&&T(s.id)},null,8,["onClick"])])):(n(),u("td",be))],64)):(n(),m(le,{key:2,onClick:D=>t.can("absence","create",s)&&T(s.id,l(p).fromISO(A.key)),holidays:t.holidays,absenceTypes:t.absence_types,user:s,date:l(p).fromISO(A.key),entries:$.value.filter(D=>D.user_id===s.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{Fe as default};
