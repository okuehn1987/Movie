import{d as A,aq as B,r as P,c as k,a as V,o as b,Q as F,b as t,f as s,V as R,x as U,g as $,K as h,e as _,L as d,O as y,M as x,i as o,a6 as z,a8 as E,a9 as I,p as f,s as u,t as m,N as M,y as q,a7 as L,j,F as H,h as n,ar as K,l as g,D as O,m as Q,J as G,P as J}from"./app-Des6fyTD.js";import{P as Z}from"./types-BVvW7sCV.js";import{b as v}from"./utils-CHWXwqL9.js";import{_ as W}from"./RecordCreateDialog.vue_vue_type_script_setup_true_lang-BnSVbjGX.js";const X=["colspan"],Y={class:"bg-surface-light"},ee={class:"py-2"},te={class:"bg-surface-medium"},se={class:"py-2"},de=A({__name:"TicketShowDialog",props:{ticket:{},customers:{},users:{},tab:{}},setup(T){const i=T,l=useForm({priority:i.ticket.priority,assignees:[],title:i.ticket.title,description:i.ticket.description,selected:i.ticket.records.filter(a=>a.accounted_at).map(a=>a.id)});B(()=>{l.defaults({priority:i.ticket.priority,assignees:i.ticket.assignees.map(a=>a.id)??[],title:i.ticket.title,description:i.ticket.description,selected:i.ticket.records.filter(a=>a.accounted_at).map(a=>a.id)}),l.reset()});const w=P(Number(route().params.openTicket)==i.ticket.id),S=k(()=>i.ticket.records.length>0),C=k(()=>i.ticket.records.reduce((a,r)=>a+r.duration,0)),D=k(()=>i.ticket.records.filter(a=>l.selected.find(r=>r===a.id)).reduce((a,r)=>a+r.duration,0));return(a,r)=>(b(),V(F,{"max-width":"1000px",height:"800px",modelValue:w.value,"onUpdate:modelValue":r[5]||(r[5]=p=>w.value=p)},{activator:t(({props:p})=>[s(g,J({title:"Auftrag anzeigen"},p,{icon:"",variant:"text"}),{default:t(()=>[s(f,{icon:"mdi-eye"})]),_:1},16)]),default:t(({isActive:p})=>[s(G,{onSubmit:Q(e=>{o(l).patch(a.route("ticket.update",{ticket:a.ticket.id}),{onSuccess:()=>{o(l).reset(),p.value=!1}})},["prevent"])},{default:t(()=>[s(R,{title:"Auftrag anzeigen"},{append:t(()=>[s(g,{icon:"",variant:"text",onClick:e=>p.value=!1},{default:t(()=>[s(f,null,{default:t(()=>[...r[6]||(r[6]=[u("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:t(()=>[s(U),s($,null,{default:t(()=>[s(h,null,{default:t(()=>[s(d,{cols:"12",md:"8"},{default:t(()=>[s(y,{label:"Kunde","model-value":a.ticket.customer.name,disabled:""},null,8,["model-value"])]),_:1}),s(d,{cols:"12",md:"4"},{default:t(()=>[s(x,{items:o(Z),label:"Priorität",required:"","error-messages":o(l).errors.priority,modelValue:o(l).priority,"onUpdate:modelValue":r[0]||(r[0]=e=>o(l).priority=e),disabled:a.tab!=="newTickets"},{selection:t(({item:e})=>[u(m(e.raw.title)+" ",1),s(f,{class:"ms-2",icon:e.raw.icon,color:e.raw.color},null,8,["icon","color"])]),item:t(({props:e,item:c})=>[s(z,E(I(e)),{append:t(()=>[s(f,{icon:c.raw.icon,color:c.raw.color},null,8,["icon","color"])]),_:2},1040)]),_:1},8,["items","error-messages","modelValue","disabled"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(M,{label:"Zuweisung",disabled:a.tab!=="newTickets",required:"",multiple:"",chips:"",items:a.users.map(e=>({value:e.id,title:`${e.first_name} ${e.last_name}`,props:{subtitle:e.job_role??""}})),"error-messages":o(l).errors.assignees,modelValue:o(l).assignees,"onUpdate:modelValue":r[1]||(r[1]=e=>o(l).assignees=e)},null,8,["disabled","items","error-messages","modelValue"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(y,{label:"Betreff",modelValue:o(l).title,"onUpdate:modelValue":r[2]||(r[2]=e=>o(l).title=e),disabled:a.tab!=="newTickets","error-messages":o(l).errors.title},null,8,["modelValue","disabled","error-messages"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(y,{label:"Beschreibung",modelValue:o(l).description,"onUpdate:modelValue":r[3]||(r[3]=e=>o(l).description=e),disabled:a.tab!=="newTickets","error-messages":o(l).errors.description},null,8,["modelValue","disabled","error-messages"])]),_:1}),S.value?(b(),V(q,{key:0,modelValue:o(l).selected,"onUpdate:modelValue":r[4]||(r[4]=e=>o(l).selected=e),headers:[{title:"Start",key:"start"},{title:"Auftragsdauer",key:"duration"},{title:"Erstellt von",key:"userName"},{title:"",key:"actions",width:"1px",sortable:!1}],items:a.ticket.records.map(e=>({...e,userName:e.user.first_name+" "+e.user.last_name})),"show-expand":"","show-select":a.tab!=="archive"},L({"item.start":t(({item:e})=>[u(m(o(O).fromSQL(e.start).toFormat("dd.MM.yyyy HH:mm")),1)]),"item.duration":t(({item:e})=>[u(m(o(v)(e.duration,"minutes","duration")),1)]),"item.actions":t(({item:e})=>[s(W,{ticket:a.ticket,users:a.users,record:e,mode:"update"},null,8,["ticket","users","record"])]),"item.data-table-expand":t(({internalItem:e,isExpanded:c,toggleExpand:N})=>[s(g,{size:"small",variant:"text",border:"",onClick:ae=>N(e)},{default:t(()=>[s(f,{icon:c(e)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:2},1032,["onClick"])]),"expanded-row":t(({columns:e,item:c})=>[n("tr",null,[n("td",{colspan:e.length,class:"py-2"},[s(K,{density:"compact"},{default:t(()=>[n("thead",Y,[n("tr",null,[r[7]||(r[7]=n("th",null,"Ressourcen",-1)),n("td",ee,m(c.resources),1)])]),n("tbody",te,[n("tr",null,[r[8]||(r[8]=n("th",null,"Beschreibung",-1)),n("td",se,m(c.description),1)])])]),_:2},1024)],8,X)])]),_:2},[a.tab!=="archive"?{name:"bottom",fn:t(()=>[s(h,{class:"text-end","no-gutters":""},{default:t(()=>[(b(),j(H,{key:0},[s(d,{cols:"12",md:"11"},{default:t(()=>[...r[9]||(r[9]=[u("Ausgewählte Auftragsdauer",-1)])]),_:1}),s(d,{cols:"12",md:"1"},{default:t(()=>[u(m(o(v)(D.value,"minutes","duration")),1)]),_:1})],64)),s(d,{cols:"12",md:"11"},{default:t(()=>[...r[10]||(r[10]=[u("Gesamte Auftragsdauer",-1)])]),_:1}),s(d,{cols:"12",md:"1"},{default:t(()=>[u(m(o(v)(C.value,"minutes","duration")),1)]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","items","show-select"])):_("",!0),a.tab!=="archive"?(b(),V(d,{key:1,cols:"12",class:"text-end"},{default:t(()=>[s(g,{color:"primary",type:"submit",loading:o(l).processing,disabled:!o(l).isDirty},{default:t(()=>[u(m(a.tab==="newTickets"?"Änderungen und Abrechnungen speichern":"Abrechnungen speichern"),1)]),_:1},8,["loading","disabled"])]),_:1})):_("",!0)]),_:1})]),_:1})]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:1},8,["modelValue"]))}});export{de as _};
