import{d as T,r as _,a as o,o as l,b as r,f as p,y as b,i as a,e as c,l as V,m as w,s as k,t as f,p as S,D as y,h as v,O as N,V as $}from"./app-B0tzRfiS.js";import{_ as C}from"./TicketCreateDialog.vue_vue_type_script_setup_true_lang-jOFCuc1l.js";import{_ as M}from"./TicketShowDialog.vue_vue_type_script_setup_true_lang-CRrr36J1.js";import{_ as F}from"./RecordCreateDialog.vue_vue_type_script_setup_true_lang-dVMDyh95.js";import{_ as I}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-Deo37UsF.js";import{P as m}from"./types-BVvW7sCV.js";import{_ as B}from"./TicketFinishDialog.vue_vue_type_script_setup_true_lang-BzecxlDu.js";const D={class:"d-flex ga-2 align-center"},j=T({__name:"TicketTable",props:{tickets:{},customers:{},users:{},tab:{},operatingSites:{}},setup(L){const d=_(""),h=useForm({});return(t,g)=>(l(),o($,null,{default:r(()=>[p(b,{"fixed-header":"",headers:[{title:"Prio",key:"priorityText",width:"1px"},{title:"Ticket",key:"reference_number",width:"1px"},{title:"Erstellt",key:"created_at",width:"1px"},{title:"Ersteller",key:"user.name"},{title:"Titel",key:"title"},{title:"Kunde",key:"customer.name"},{title:"Termin",key:"appointment_at"},{title:"Zugewiesen an",key:"assigneeName"},{title:"",key:"actions",align:"end",sortable:!1,width:"280px"}],items:t.tickets.map(e=>{var n,u;const i=(()=>{if(e.assignees.length==0)return null;const s=e.assignees[0];return e.assignees.length==1?s.first_name+" "+s.last_name:`${s.first_name} ${s.last_name} (+${e.assignees.length-1} weitere)`})();return{...e,user:{...e.user,name:e.user.first_name+" "+e.user.last_name},assigneeName:i,priorityText:(n=a(m).find(s=>s.value===e.priority))==null?void 0:n.title,priorityValue:(u=a(m).find(s=>s.value===e.priority))==null?void 0:u.priorityValue,assigneesNames:e.assignees.map(s=>s.first_name+s.last_name).join("")}}).filter(e=>{const i=d.value.replace(/\W/gi,"").toLowerCase();return(e.title+e.customer.name+e.user.name+e.assigneesNames+e.priorityText+e.reference_number).toLowerCase().replace(/\W/gi,"").includes(i)}),hover:""},{"header.actions":r(()=>[v("div",D,[p(N,{modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=e=>d.value=e),placeholder:"Suche",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"]),t.tab==="newTickets"?(l(),o(C,{key:0,customers:t.customers,users:t.users,operatingSites:t.operatingSites},null,8,["customers","users","operatingSites"])):c("",!0)])]),"item.created_at":r(({item:e})=>[k(f(a(y).fromISO(e.created_at).toFormat("dd.MM.yyyy")),1)]),"item.appointment_at":r(({item:e})=>[k(f(e.appointment_at?a(y).fromSQL(e.appointment_at).toFormat("dd.MM. 'um' HH:mm 'Uhr'"):"-"),1)]),"item.priorityText":r(({item:e})=>{var i,n,u;return[p(S,{title:(i=a(m).find(s=>s.value===e.priority))==null?void 0:i.title,icon:(n=a(m).find(s=>s.value===e.priority))==null?void 0:n.icon,color:(u=a(m).find(s=>s.value===e.priority))==null?void 0:u.color},null,8,["title","icon","color"])]}),"item.assigneeName":r(({item:e})=>[k(f(e.assigneeName),1)]),"item.actions":r(({item:e})=>[["newTickets","workingTickets"].includes(t.tab)&&!e.assignees.find(i=>i.pivot.status==="accepted"&&i.pivot.user_id===t.$page.props.auth.user.id)?(l(),o(V,{key:0,icon:"mdi-handshake",variant:"text",color:"primary",title:"Ticket übernehmen",onClick:w(i=>a(h).patch(t.route("ticket.accept",{ticket:e.id})),["stop"])},null,8,["onClick"])):c("",!0),["workingTickets","finishedTickets"].includes(t.tab)?(l(),o(B,{key:1,tab:t.tab,item:e},null,8,["tab","item"])):c("",!0),t.tab==="workingTickets"?(l(),o(F,{key:2,ticket:e,users:t.users,operatingSites:t.operatingSites},null,8,["ticket","users","operatingSites"])):c("",!0),p(M,{ticket:e,customers:t.customers,users:t.users,tab:t.tab,operatingSites:t.operatingSites},null,8,["ticket","customers","users","tab","operatingSites"]),t.tab==="newTickets"&&t.can("ticket","delete",e)?(l(),o(I,{key:3,content:"Möchtest du dieses Ticket löschen?",title:"Löschen",route:t.route("ticket.destroy",{ticket:e.id})},null,8,["route"])):c("",!0)]),_:1},8,["items"])]),_:1}))}});export{j as _};
