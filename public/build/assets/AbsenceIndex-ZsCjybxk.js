import{d as O,Q,r as B,D as h,T as j,w as z,a as H,o as d,c as b,b as s,e as t,V as F,u as o,f as c,g as y,h as x,i as w,j as J,t as g,k as A,l as P,m as _,n as q,p as V,q as E,s as R,v as u,x as G,y as K,z as W,A as X,B as f,C as Y,F as C,E as Z}from"./app-CNgMjHNx.js";import{_ as ee}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BCDAaojM.js";import{u as te,g as ae,t as se}from"./utils-CcUMKscw.js";import{_ as ne}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-COP9EyrC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"d-flex flex-wrap justify-space-between align-center"},oe={style:{width:"30px"}},re={class:"d-flex flex-wrap align-center"},ie={class:"d-flex"},de={class:"mx-4 text-center",style:{"min-width":"170px"}},ue={class:"d-flex"},me={key:0},ce={key:0},pe={key:1},ge=O({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{}},setup(I){const L=I,S=Q(),r=B(h.now());function T(){const i=[];for(let e=1;e<=r.value.daysInMonth;e++)i.push(r.value.startOf("month").plus({day:e-1}));return i}const k=B(!1),l=j({user_id:S.props.auth.user.id,start:null,end:null,absence_type_id:null});function M(i,e){l.reset();const p=L.absences.filter(a=>a.user_id===i).find(a=>e&&h.fromSQL(a.start)<=e&&e<=h.fromSQL(a.end));l.user_id=i,l.end=(e==null?void 0:e.toJSDate())??null,l.start=(e==null?void 0:e.toJSDate())??null,l.absence_type_id=(p==null?void 0:p.absence_type_id)??null,k.value=!0}const N=se(()=>Z.reload({only:["absences"],data:{date:r.value.toFormat("yyyy-MM")}}),500);z(r,N);const U=te();return(i,e)=>{const p=H("v-date-input");return d(),b(ee,{title:"Abwesenheiten"},{default:s(()=>[t(R,{"max-width":"1000",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a)},{default:s(({isActive:a})=>{var v;return[t(F,{title:"Abwesenheit"+(o(l).user_id!=o(S).props.auth.user.id?" von "+((v=i.users.map(n=>({...n,name:n.first_name+" "+n.last_name})).find(n=>n.id===o(l).user_id))==null?void 0:v.name):"")+" beantragen"},{append:s(()=>[t(c,{icon:"",variant:"text",onClick:n=>a.value=!1},{default:s(()=>[t(y,null,{default:s(()=>e[8]||(e[8]=[x("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[o(l).errors.user_id?(d(),b(w,{key:0},{default:s(()=>[t(J,{color:"error",closable:""},{default:s(()=>[x(g(o(l).errors.user_id),1)]),_:1})]),_:1})):A("",!0),t(w,null,{default:s(()=>[t(P,{onSubmit:_(n=>{o(l).transform(m=>{var D,$;return{...m,start:(D=m.start)==null?void 0:D.toLocaleDateString(),end:($=m.end)==null?void 0:$.toLocaleDateString()}}).post(i.route("absence.store"),{onSuccess:()=>{o(l).reset(),a.value=!1}})},["prevent"])},{default:s(()=>[t(q,null,{default:s(()=>[t(V,{cols:"12"},{default:s(()=>[t(E,{label:"Abwesenheitsgrund angeben",items:i.absence_types.map(n=>({title:n.name,value:n.id})),modelValue:o(l).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=n=>o(l).absence_type_id=n),"error-messages":o(l).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),t(V,{cols:"12",md:"6"},{default:s(()=>[t(p,{label:"Von",modelValue:o(l).start,"onUpdate:modelValue":e[1]||(e[1]=n=>o(l).start=n),"error-messages":o(l).errors.start},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"12",md:"6"},{default:s(()=>[t(p,{label:"Bis",modelValue:o(l).end,"onUpdate:modelValue":e[2]||(e[2]=n=>o(l).end=n),"error-messages":o(l).errors.end},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"12",class:"text-end"},{default:s(()=>[t(c,{loading:o(l).processing,type:"submit",color:"primary"},{default:s(()=>e[9]||(e[9]=[x("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),t(F,null,{default:s(()=>[t(w,null,{default:s(()=>[u("div",le,[u("div",oe,[o(U)?(d(),b(G,{key:0,indeterminate:""})):A("",!0)]),u("div",re,[u("div",ie,[t(c,{onClick:e[4]||(e[4]=_(a=>r.value=r.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(y,{icon:"mdi-chevron-double-left"})]),_:1}),t(c,{onClick:e[5]||(e[5]=_(a=>r.value=r.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(y,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",de,g(r.value.toFormat("MMMM yyyy")),1),u("div",ue,[t(c,{onClick:e[6]||(e[6]=_(a=>r.value=r.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(y,{icon:"mdi-chevron-right"})]),_:1}),t(c,{onClick:e[7]||(e[7]=_(a=>r.value=r.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(y,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[10]||(e[10]=u("div",{style:{width:"30px"}},null,-1))])]),_:1}),t(K),t(W,{"fixed-header":"",style:X([{"white-space":"pre"},{maxHeight:o(ae)(80)}]),id:"absence-table",items:i.users,headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...T().map(a=>({title:a.weekdayShort+`
`+a.day.toString(),key:a.day.toString(),sortable:!1,align:"center"}))]},{item:s(({item:a,columns:v})=>[u("tr",null,[(d(!0),f(C,null,Y(v,n=>(d(),f(C,{key:n.key},[n.key==="name"?(d(),f("td",me,g(a.first_name)+" "+g(a.last_name),1)):n.key==="action"?(d(),f(C,{key:1},[i.can("absence","create",a)?(d(),f("td",ce,[t(c,{icon:"mdi-plus",variant:"text",onClick:m=>i.can("absence","create",a)&&M(a.id)},null,8,["onClick"])])):(d(),f("td",pe))],64)):(d(),b(ne,{key:2,onClick:m=>i.can("absence","create",a)&&M(a.id,r.value.startOf("month").plus({day:+(n.key??0)-1})),absenceTypes:i.absence_types,user:a,date:r.value.startOf("month").plus({day:+(n.key??0)-1}),absences:i.absences.filter(m=>m.user_id===a.id)},null,8,["onClick","absenceTypes","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1})}}});export{ge as default};
