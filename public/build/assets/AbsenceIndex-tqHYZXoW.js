import{d as U,Q as x,r as A,T as B,a as M,o as f,c as V,w as r,b as o,V as I,u as n,e as k,f as N,g as y,h as w,i as T,t as v,j as F,k as O,l as $,m as z,n as c,p as E,q as Q,s as j,v as S,x as J,F as q,y as R,D as u,z as G,A as H}from"./app-tWClGIV1.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DB0UcCSz.js";const P=["role","onClick"],Y=U({__name:"AbsenceIndex",props:{users:{},absence_types:{}},setup(C){const D=C,m=x();function g(){const l=[];for(let e=1;e<=u.now().daysInMonth;e++)l.push(u.now().startOf("month").plus({day:e-1}));return l}function h(l,e){var t;const i=l.absences.find(d=>u.fromSQL(d.start)<=e&&e<=u.fromSQL(d.end));return i&&i.status==="accepted"?((t=i.absence_type)==null?void 0:t.abbreviation)||"❌":l.user_working_weeks.find(d=>{var s;return d[(s=e.setLocale("en-US").weekdayLong)==null?void 0:s.toLowerCase()]})?"✔️":""}function b(l,e){return e.supervisor_id===l||e.id==l}const _=A(!1),a=B({absence_type_id:null,start:new Date,end:new Date,user_id:m.props.auth.user.id});function L(l,e){const i=D.users.find(t=>t.id===e);!i||!b(m.props.auth.user.id,i)||(a.user_id=e,a.start=u.now().startOf("month").plus({day:+l-1}).toJSDate(),a.end=u.now().startOf("month").plus({day:+l}).toJSDate(),_.value=!0)}return(l,e)=>{const i=M("v-date-input");return f(),V(K,{title:"Abwesenheiten"},{default:r(()=>[o(Q,{"max-width":"1000",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t)},{default:r(({isActive:t})=>{var d;return[o(I,{title:"Abwesenheit"+(n(a).user_id!=n(m).props.auth.user.id?" von "+((d=l.users.map(s=>({...s,name:s.first_name+" "+s.last_name})).find(s=>s.id===n(a).user_id))==null?void 0:d.name):"")+" beantragen"},{append:r(()=>[o(k,{icon:"",variant:"text",onClick:s=>t.value=!1},{default:r(()=>[o(N,null,{default:r(()=>e[4]||(e[4]=[y("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:r(()=>[n(a).errors.user_id?(f(),V(w,{key:0},{default:r(()=>[o(T,{color:"error",closable:""},{default:r(()=>[y(v(n(a).errors.user_id),1)]),_:1})]),_:1})):F("",!0),o(w,null,{default:r(()=>[o(O,{onSubmit:$(s=>{n(a).transform(p=>({...p,start:p.start.toLocaleDateString(),end:p.end.toLocaleDateString()})).post(l.route("absence.store"),{onSuccess:()=>{n(a).reset(),t.value=!1}})},["prevent"])},{default:r(()=>[o(z,null,{default:r(()=>[o(c,{cols:"12"},{default:r(()=>[o(E,{label:"Abwesenheitsgrund angeben",items:l.absence_types.map(s=>({title:s.name,value:s.id})),modelValue:n(a).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=s=>n(a).absence_type_id=s),"error-messages":n(a).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),o(c,{cols:"12",md:"6"},{default:r(()=>[o(i,{label:"Von",modelValue:n(a).start,"onUpdate:modelValue":e[1]||(e[1]=s=>n(a).start=s),"error-messages":n(a).errors.start},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12",md:"6"},{default:r(()=>[o(i,{label:"Bis",modelValue:n(a).end,"onUpdate:modelValue":e[2]||(e[2]=s=>n(a).end=s),"error-messages":n(a).errors.end},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12",class:"text-end"},{default:r(()=>[o(k,{loading:n(a).processing,type:"submit",color:"primary"},{default:r(()=>e[5]||(e[5]=[y("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),o(R,{style:{"white-space":"pre"},id:"absence-table",items:l.users.map(t=>({...t,name:t.first_name+`
`+t.last_name,...Object.fromEntries(g().map(d=>[d.day,h(t,d)]))})),headers:[{title:"Name",key:"name"},...g().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center"}))]},{item:r(({item:t,columns:d})=>[j("tr",null,[(f(!0),S(q,null,J(d,s=>(f(),S("td",{key:s.key+"",style:G({backgroundColor:t[s.key]?"":"lightgray"}),class:H({"editable-cell":b(n(m).props.auth.user.id,t)}),role:b(n(m).props.auth.user.id,t)?"button":"cell",onClick:p=>L(s.key+"",t.id)},v(t[s.key]),15,P))),128))])]),_:1},8,["items","headers"])]),_:1})}}});export{Y as default};
