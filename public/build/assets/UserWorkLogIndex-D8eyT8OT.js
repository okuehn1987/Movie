import{d as N,S as O,r as y,I as H,ag as Q,C as q,D as f,ai as A,o as _,c as k,a as l,b as i,Q as E,u as s,e as h,l as w,j as P,O as W,U as B,v as $,V as D,f as z,g as S,h as R,k as K,m as j,p,s as T,W as G,H as J}from"./app-Bcnebe7g.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BnLqlW9w.js";import{b as X}from"./utils-C_pjOZmg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=N({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(U){const V=U,{currentPage:b,lastPage:L,data:x}=X(O(V),"workLogs"),g=y(!1),c=y(null),u=y(null),v=H(()=>u.value?"plain":"underlined"),F=H(()=>V.workLogs.data.filter((a,e)=>e<10**10));Q(()=>{const a=route().params.workLog;if(a)return C(Number(a))});const t=q({id:-1,start:new Date,end:new Date,start_time:"",end_time:"",is_home_office:!1});function I(){t.transform(a=>{const e=f.fromFormat(a.start_time,"HH:mm"),d=f.fromFormat(a.end_time,"HH:mm");return{...a,start:f.fromISO(a.start.toISOString()).set({hour:e.hour,minute:e.minute}),end:f.fromISO(a.end.toISOString()).set({hour:d.hour,minute:d.minute}),workLog:t.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{g.value=!1}})}function C(a){const e=V.workLogs.data.find(m=>m.id===a);if(!e)return;const d=e.work_log_patches.at(-1);e.end?d?d&&d.status==="created"&&(u.value=d,c.value="show"):(u.value=null,c.value="edit"):(c.value="fix",u.value=e);let o=e.start,r=e.end,n=e.is_home_office;u.value&&(o=u.value.start,r=u.value.end,n=u.value.is_home_office),t.id=a,t.start=new Date(o),t.end=r?new Date(r):new Date,t.start_time=f.fromSQL(o).toFormat("HH:mm"),t.end_time=f.fromSQL(r||f.now().toSQL()).toFormat("HH:mm"),t.is_home_office=n,g.value=!0}function M(){const a=V.workLogs.data.find(d=>d.id===t.id);if(!a)return;const e=a.work_log_patches.at(-1);e&&J.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{g.value=!1}})}return(a,e)=>{const d=A("v-date-input");return _(),k(Z,{title:a.user.first_name+" "+a.user.last_name,backurl:a.route().params.fromUserWorkLogs?a.route("workLog.index"):a.route("dashboard")},{default:l(()=>[i(D,null,{default:l(()=>[i(E,{headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"action",sortable:!1,align:"end"}],items:s(x).map(o=>({...o.work_log_patches.filter(n=>n.status==="accepted").toSorted((n,m)=>n.updated_at<m.updated_at?1:-1)[0]??o,id:o.id})).toSorted((o,r)=>o.start<r.start?1:-1).map(o=>{var r,n;return{start:s(f).fromSQL(o.start).toFormat("dd.MM.yyyy HH:mm"),end:o.end?s(f).fromSQL(o.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",is_home_office:o.is_home_office?"Ja":"Nein",id:o.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((n=(r=a.workLogs.data.find(m=>m.id===o.id))==null?void 0:r.work_log_patches.at(-1))==null?void 0:n.status)||"none"]}})},{"item.action":l(({item:o})=>{var r,n;return[F.value.find(m=>m.id===o.id)&&a.can("workLogPatch","create")?(_(),k(h,{key:0,color:"primary",onClick:w(m=>C(o.id),["stop"]),icon:((n=(r=a.workLogs.data.find(m=>m.id===o.id))==null?void 0:r.work_log_patches.at(-1))==null?void 0:n.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text"},null,8,["onClick","icon"])):P("",!0)]}),bottom:l(()=>[s(L)>1?(_(),k(W,{key:0,modelValue:s(b),"onUpdate:modelValue":e[0]||(e[0]=o=>B(b)?b.value=o:null),length:s(L)},null,8,["modelValue","length"])):P("",!0)]),_:1},8,["items"]),i($,{"max-width":"1000",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o)},{default:l(({isActive:o})=>[i(D,{title:"Zeitkorrektur"},{append:l(()=>[i(h,{icon:"",variant:"text",onClick:r=>o.value=!1},{default:l(()=>[i(z,null,{default:l(()=>e[7]||(e[7]=[S("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:l(()=>[i(R,null,{default:l(()=>[i(K,{onSubmit:w(I,["prevent"])},{default:l(()=>[i(j,null,{default:l(()=>[i(p,{cols:"12",md:"3"},{default:l(()=>[i(d,{disabled:c.value=="fix",label:"Start","data-testid":"userTimeCorrectionStartDay",required:"","error-messages":s(t).errors.start,modelValue:s(t).start,"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).start=r),variant:v.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(T,{disabled:c.value=="fix",type:"time",label:"Start","data-testid":"userTimeCorrectionStartTime",required:"","error-messages":s(t).errors.start_time,modelValue:s(t).start_time,"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).start_time=r),variant:v.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(d,{disabled:c.value=="fix",label:"Ende","data-testid":"userTimeCorrectionEndDay",required:"","error-messages":s(t).errors.end,modelValue:s(t).end,"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).end=r),variant:v.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(T,{disabled:!!u.value,type:"time",label:"Ende","data-testid":"userTimeCorrectionEndTime",required:"","error-messages":s(t).errors.end_time,modelValue:s(t).end_time,"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).end_time=r),variant:v.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(G,{disabled:!!u.value,label:"Homeoffice",required:"","error-messages":s(t).errors.is_home_office,modelValue:s(t).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).is_home_office=r),variant:v.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",class:"text-end"},{default:l(()=>[u.value&&a.$page.props.auth.user.id==a.user.id?(_(),k(h,{key:0,loading:s(t).processing,onClick:w(M,["stop"]),color:"primary"},{default:l(()=>e[8]||(e[8]=[S("Antrag zurÃ¼ckziehen")])),_:1},8,["loading"])):(_(),k(h,{key:1,loading:s(t).processing,type:"submit",color:"primary"},{default:l(()=>e[9]||(e[9]=[S("Korrektur beantragen")])),_:1},8,["loading"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{oe as default};
