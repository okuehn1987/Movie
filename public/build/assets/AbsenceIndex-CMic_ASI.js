import{d as N,r as o,D as m,c as $,w as L,o as l,a as v,b as r,e as C,f as n,V as H,g as u,h as f,i as _,j as k,k as j,t as F,l as G,m as Q,n as q,p as z,u as T,q as d,s as J,F as w,v as K,G as R}from"./app-DrMW2YkR.js";import{_ as W}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C6ViNLt9.js";import{u as X,t as Y}from"./utils-BKNOzcb8.js";import{_ as Z,g as ee}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-DKXpPGPL.js";import{_ as te}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-CIQfFH63.js";import{_ as ae}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-B5T8L9W-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"d-flex flex-wrap justify-center align-center"},ne={class:"d-flex flex-wrap align-center"},le={class:"d-flex"},oe={class:"mx-4 text-center",style:{"min-width":"170px"}},re={class:"d-flex"},ie={key:0},ue={key:0},de={key:1},he=N({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{}},setup(I){const g=I,S=route().params.date,a=o(S?m.fromFormat(S,"yyyy-MM"):m.now()),A=$(()=>[].concat(g.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(g.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd")))),p=o(!1),b=o(!1),c=o(null),h=o(null),D=o(null),O=$(()=>g.users.find(s=>{var e;return s.id===((e=c.value)==null?void 0:e.user_id)}));function U(s,e){h.value=s;const t=A.value.filter(i=>i.user_id===s).find(i=>e&&m.fromSQL(i.start)<=e&&e<=m.fromSQL(i.end));D.value=e??null,c.value=t??null,t&&["hasOpenPatch","created"].includes(ee(t))?b.value=!0:p.value=!0}function E(){const s=[];for(let e=1;e<=a.value.daysInMonth;e++)s.push(a.value.startOf("month").plus({day:e-1}));return s}const M=o([a.value.toFormat("yyyy-MM")]),V=o(!1),P=Y(()=>{M.value.includes(a.value.toFormat("yyyy-MM"))||R.reload({only:["absences","holidays"],data:{date:a.value.toFormat("yyyy-MM")},onStart:()=>{M.value.push(a.value.toFormat("yyyy-MM")),V.value=!0},onError:()=>M.value=M.value.filter(s=>s!=a.value.toFormat("yyyy-MM")),onFinish:()=>V.value=!1})},500);L(a,P);const B=X(81);return(s,e)=>(l(),v(W,{title:"Abwesenheiten"},{default:r(()=>[p.value&&h.value?(l(),v(te,{key:0,absence_types:s.absence_types,users:s.users,selectedAbsence:c.value,selectedDate:D.value,selectedUser:h.value,"onUpdate:selectedUser":e[0]||(e[0]=t=>h.value=t),modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):C("",!0),b.value&&c.value&&O.value?(l(),v(ae,{key:1,absence_types:s.absence_types,users:s.users,selectedAbsence:c.value,absenceUser:O.value,modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):C("",!0),n(K,null,{default:r(()=>[n(H,null,{default:r(()=>[u("div",se,[u("div",ne,[u("div",le,[n(f,{onClick:e[3]||(e[3]=_(t=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-double-left"})]),_:1}),n(f,{onClick:e[4]||(e[4]=_(t=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",oe,[j(F(a.value.toFormat("MMMM yyyy"))+" ",1),V.value?(l(),v(G,{key:0,indeterminate:""})):C("",!0)]),u("div",re,[n(f,{onClick:e[5]||(e[5]=_(t=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-right"})]),_:1}),n(f,{onClick:e[6]||(e[6]=_(t=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-double-right"})]),_:1})])])])]),_:1}),n(Q),n(q,{"fixed-header":"",style:z([{"white-space":"pre"},{maxHeight:T(B)}]),id:"absence-table",items:s.users.map(t=>({...t,name:t.last_name+", "+t.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px",sortable:!1},...E().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":t.toISODate()===T(m).local().toISODate()}}}))]},{item:r(({item:t,columns:i})=>[u("tr",null,[(l(!0),d(w,null,J(i,y=>(l(),d(w,{key:y.key},[y.key==="name"?(l(),d("td",ie,F(t.first_name)+" "+F(t.last_name),1)):y.key==="action"?(l(),d(w,{key:1},[s.can("absence","create",t)?(l(),d("td",ue,[n(f,{icon:"mdi-plus",variant:"text",onClick:x=>s.can("absence","create",t)&&U(t.id)},null,8,["onClick"])])):(l(),d("td",de))],64)):(l(),v(Z,{key:2,onClick:x=>s.can("absence","create",t)&&U(t.id,a.value.startOf("month").plus({day:+(y.key??0)-1})),holidays:s.holidays,absenceTypes:s.absence_types,user:t,date:a.value.startOf("month").plus({day:+(y.key??0)-1}),entries:A.value.filter(x=>x.user_id===t.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{he as default};
