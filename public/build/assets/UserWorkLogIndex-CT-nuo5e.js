import{d as E,r as y,c as H,ah as I,D as f,ak as N,o as h,a as k,b as n,f as l,n as B,p as Q,u as s,g as W,h as _,i as w,e as b,B as q,v as C,j as A,k as L,V as O,E as z,H as $,I as c,K as D,W as K,_ as G,G as j}from"./app-DrMW2YkR.js";import{_ as J}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-BBeiPNWd.js";import{_ as R}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C6ViNLt9.js";import{u as Z}from"./utils-BKNOzcb8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"d-flex ga-2"},re=E({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(T){const V=T,g=y(!1),p=y(null),d=y(null),v=H(()=>d.value?"plain":"underlined"),F=H(()=>V.workLogs.filter((a,e)=>e<10**10));I(()=>{const a=route().params.workLog;if(a)return S(Number(a))});const t=useForm({id:-1,start:new Date,end:new Date,comment:null,start_time:"",end_time:"",is_home_office:!1});function P(){t.transform(a=>{const e=f.fromFormat(a.start_time,"HH:mm:ss"),i=f.fromFormat(a.end_time,"HH:mm:ss");return{...a,start:f.fromISO(a.start.toISOString()).set({hour:e.hour,minute:e.minute,second:e.second}),end:f.fromISO(a.end.toISOString()).set({hour:i.hour,minute:i.minute,second:i.second}),workLog:t.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{g.value=!1}})}function S(a){var m;const e=V.workLogs.find(x=>x.id===a);if(!e)return;const i=e.patches.at(-1);i?i.status==="created"?(d.value=i,p.value="show"):i.status=="accepted"&&(d.value=i,p.value="edit"):(d.value=null,p.value="edit");let o=e.start,r=e.end,u=e.is_home_office;d.value&&(o=d.value.start,r=d.value.end,u=d.value.is_home_office,t.comment="comment"in d.value?(m=d.value)==null?void 0:m.comment:null),t.id=a,t.start=new Date(o),t.end=r?new Date(r):new Date,t.start_time=f.fromSQL(o).toFormat("HH:mm:ss"),t.end_time=f.fromSQL(r||f.now().toSQL()).toFormat("HH:mm:ss"),t.is_home_office=u,g.value=!0}function M(){const a=V.workLogs.find(i=>i.id===t.id);if(!a)return;const e=a.patches.at(-1);e&&j.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{g.value=!1}})}const U=Z(0);return(a,e)=>{const i=N("v-date-input");return h(),k(R,{title:a.user.first_name+" "+a.user.last_name,backurl:a.route().params.fromUserWorkLogs?a.route("workLog.index"):a.route("dashboard")},{default:n(()=>[l(C,null,{default:n(()=>[l(B,{"fixed-header":"",style:Q({maxHeight:s(U)}),headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Dauer",key:"duration"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"actions",sortable:!1,width:"1px"}],items:a.workLogs.map(o=>({...o.patches.filter(u=>u.status==="accepted").toSorted((u,m)=>u.updated_at<m.updated_at?1:-1)[0]??o,id:o.id})).toSorted((o,r)=>o.start<r.start?1:-1).map(o=>{var r,u;return{start:s(f).fromSQL(o.start).toFormat("dd.MM.yyyy HH:mm"),end:o.end?s(f).fromSQL(o.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",duration:o.end?s(f).fromSQL(o.end).diff(s(f).fromSQL(o.start)).toFormat("hh:mm"):"",is_home_office:o.is_home_office?"Ja":"Nein",id:o.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((u=(r=a.workLogs.find(m=>m.id===o.id))==null?void 0:r.patches.at(-1))==null?void 0:u.status)||"none"]}})},{"item.actions":n(({item:o})=>{var r,u;return[W("div",X,[F.value.find(m=>m.id===o.id)&&a.can("workLogPatch","create")?(h(),k(_,{key:0,color:"primary",onClick:w(m=>S(o.id),["stop"]),icon:((u=(r=a.workLogs.find(m=>m.id===o.id))==null?void 0:r.patches.at(-1))==null?void 0:u.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text","data-testid":"entryToWorkLog"},null,8,["onClick","icon"])):b("",!0),a.can("workLog","delete")?(h(),k(J,{key:1,title:"Eintrag löschen",content:"Möchten Sie diesen Eintrag wirklich löschen? Dies kann nicht rückgängig gemacht werden.",route:a.route("workLog.destroy",{workLog:o.id})},null,8,["route"])):b("",!0)])]}),_:1},8,["style","items"]),l(q,{"max-width":"1000",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=o=>g.value=o)},{default:n(({isActive:o})=>[l(C,{title:"Zeitkorrektur"},{append:n(()=>[l(_,{icon:"",variant:"text",onClick:r=>o.value=!1},{default:n(()=>[l(A,null,{default:n(()=>e[7]||(e[7]=[L("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:n(()=>[l(O,null,{default:n(()=>[l(z,{onSubmit:w(P,["prevent"])},{default:n(()=>[l($,null,{default:n(()=>[l(c,{cols:"12",md:"3"},{default:n(()=>[l(i,{label:"Start","data-testid":"userTimeCorrectionStartDay",required:"","error-messages":s(t).errors.start,modelValue:s(t).start,"onUpdate:modelValue":e[0]||(e[0]=r=>s(t).start=r),variant:v.value,style:{height:"73px"}},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(D,{type:"time",label:"Start",step:"1","data-testid":"userTimeCorrectionStartTime",required:"","error-messages":s(t).errors.start_time,modelValue:s(t).start_time,"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).start_time=r),variant:v.value},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(i,{label:"Ende","data-testid":"userTimeCorrectionEndDay",required:"","error-messages":s(t).errors.end,modelValue:s(t).end,"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).end=r),variant:v.value,style:{height:"73px"}},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(D,{disabled:p.value=="show",type:"time",label:"Ende",step:"1","data-testid":"userTimeCorrectionEndTime",required:"","error-messages":s(t).errors.end_time,modelValue:s(t).end_time,"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).end_time=r),variant:v.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12"},{default:n(()=>[l(K,{label:"Bemerkung (optional)",modelValue:s(t).comment,"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).comment=r),"error-messages":s(t).errors.comment,variant:"filled",rows:"3"},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(G,{disabled:!!d.value,label:"Homeoffice",required:"","error-messages":s(t).errors.is_home_office,modelValue:s(t).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).is_home_office=r),variant:v.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",class:"text-end"},{default:n(()=>[d.value&&a.can("workLogPatch","delete")&&p.value==="show"?(h(),k(_,{key:0,loading:s(t).processing,onClick:w(M,["stop"]),color:"primary"},{default:n(()=>e[8]||(e[8]=[L(" Antrag zurückziehen ")])),_:1},8,["loading"])):a.can("workLogPatch","create")&&p.value==="edit"?(h(),k(_,{key:1,loading:s(t).processing,type:"submit",color:"primary"},{default:n(()=>e[9]||(e[9]=[L(" Korrektur beantragen ")])),_:1},8,["loading"])):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{re as default};
