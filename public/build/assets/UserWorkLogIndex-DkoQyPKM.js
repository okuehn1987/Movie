import{d as x,T as O,r as w,I as P,af as q,C as A,D as f,ah as B,o as v,c as _,a as n,b as l,Q as E,u as o,e as h,l as b,j as S,O as W,W as z,v as R,V as D,f as $,g as L,h as K,k as j,m as G,p as c,s as T,S as J,X,H as Z}from"./app-BHvplgrW.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-09n6SuuB.js";import{a as ee}from"./utils-ByE2Rxnn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se=x({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(F){const k=F,{currentPage:y,lastPage:C,data:U}=ee(O(k),"workLogs"),p=w(!1),V=w(null),i=w(null),g=P(()=>i.value?"plain":"underlined"),I=P(()=>k.workLogs.data.filter((r,e)=>e<10**10));q(()=>{const r=route().params.workLog;if(r)return H(Number(r))});const t=A({id:-1,start:new Date,end:new Date,comment:null,start_time:"",end_time:"",is_home_office:!1});function Q(){t.transform(r=>{const e=f.fromFormat(r.start_time,"HH:mm"),d=f.fromFormat(r.end_time,"HH:mm");return{...r,start:f.fromISO(r.start.toISOString()).set({hour:e.hour,minute:e.minute}),end:f.fromISO(r.end.toISOString()).set({hour:d.hour,minute:d.minute}),workLog:t.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{p.value=!1}})}function H(r){var u;const e=k.workLogs.data.find(N=>N.id===r);if(!e)return;const d=e.work_log_patches.at(-1);d?d&&d.status==="created"&&(i.value=d,V.value="show"):(i.value=null,V.value="edit");let a=e.start,s=e.end,m=e.is_home_office;i.value&&(a=i.value.start,s=i.value.end,m=i.value.is_home_office,t.comment="comment"in i.value?(u=i.value)==null?void 0:u.comment:null),t.id=r,t.start=new Date(a),t.end=s?new Date(s):new Date,t.start_time=f.fromSQL(a).toFormat("HH:mm"),t.end_time=f.fromSQL(s||f.now().toSQL()).toFormat("HH:mm"),t.is_home_office=m,p.value=!0}function M(){const r=k.workLogs.data.find(d=>d.id===t.id);if(!r)return;const e=r.work_log_patches.at(-1);e&&Z.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{p.value=!1}})}return(r,e)=>{const d=B("v-date-input");return v(),_(Y,{title:r.user.first_name+" "+r.user.last_name,backurl:r.route().params.fromUserWorkLogs?r.route("workLog.index"):r.route("dashboard")},{default:n(()=>[l(D,null,{default:n(()=>[l(E,{headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Dauer",key:"duration"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"action",sortable:!1,align:"end"}],items:o(U).map(a=>({...a.work_log_patches.filter(m=>m.status==="accepted").toSorted((m,u)=>m.updated_at<u.updated_at?1:-1)[0]??a,id:a.id})).toSorted((a,s)=>a.start<s.start?1:-1).map(a=>{var s,m;return{start:o(f).fromSQL(a.start).toFormat("dd.MM.yyyy HH:mm"),end:a.end?o(f).fromSQL(a.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",duration:a.end?o(f).fromSQL(a.end).diff(o(f).fromSQL(a.start)).toFormat("hh:mm"):"",is_home_office:a.is_home_office?"Ja":"Nein",id:a.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((m=(s=r.workLogs.data.find(u=>u.id===a.id))==null?void 0:s.work_log_patches.at(-1))==null?void 0:m.status)||"none"]}})},{"item.action":n(({item:a})=>{var s,m;return[I.value.find(u=>u.id===a.id)&&r.can("workLogPatch","create")?(v(),_(h,{key:0,color:"primary",onClick:b(u=>H(a.id),["stop"]),icon:((m=(s=r.workLogs.data.find(u=>u.id===a.id))==null?void 0:s.work_log_patches.at(-1))==null?void 0:m.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text"},null,8,["onClick","icon"])):S("",!0)]}),bottom:n(()=>[o(C)>1?(v(),_(W,{key:0,modelValue:o(y),"onUpdate:modelValue":e[0]||(e[0]=a=>z(y)?y.value=a:null),length:o(C)},null,8,["modelValue","length"])):S("",!0)]),_:1},8,["items"]),l(R,{"max-width":"1000",modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=a=>p.value=a)},{default:n(({isActive:a})=>[l(D,{title:"Zeitkorrektur"},{append:n(()=>[l(h,{icon:"",variant:"text",onClick:s=>a.value=!1},{default:n(()=>[l($,null,{default:n(()=>e[8]||(e[8]=[L("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:n(()=>[l(K,null,{default:n(()=>[l(j,{onSubmit:b(Q,["prevent"])},{default:n(()=>[l(G,null,{default:n(()=>[l(c,{cols:"12",md:"3"},{default:n(()=>[l(d,{label:"Start","data-testid":"userTimeCorrectionStartDay",required:"","error-messages":o(t).errors.start,modelValue:o(t).start,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).start=s),variant:g.value,style:{height:"73px"}},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(T,{type:"time",label:"Start","data-testid":"userTimeCorrectionStartTime",required:"","error-messages":o(t).errors.start_time,modelValue:o(t).start_time,"onUpdate:modelValue":e[2]||(e[2]=s=>o(t).start_time=s),variant:g.value},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(d,{label:"Ende","data-testid":"userTimeCorrectionEndDay",required:"","error-messages":o(t).errors.end,modelValue:o(t).end,"onUpdate:modelValue":e[3]||(e[3]=s=>o(t).end=s),variant:g.value,style:{height:"73px"}},null,8,["error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(T,{disabled:!!i.value,type:"time",label:"Ende","data-testid":"userTimeCorrectionEndTime",required:"","error-messages":o(t).errors.end_time,modelValue:o(t).end_time,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).end_time=s),variant:g.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12"},{default:n(()=>[l(J,{label:"Bemerkung (optional)",modelValue:o(t).comment,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).comment=s),"error-messages":o(t).errors.comment,variant:"filled",rows:"3"},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"12",md:"3"},{default:n(()=>[l(X,{disabled:!!i.value,label:"Homeoffice",required:"","error-messages":o(t).errors.is_home_office,modelValue:o(t).is_home_office,"onUpdate:modelValue":e[6]||(e[6]=s=>o(t).is_home_office=s),variant:g.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),l(c,{cols:"12",class:"text-end"},{default:n(()=>[i.value&&r.can("workLogPatch","update")&&V.value==="show"?(v(),_(h,{key:0,loading:o(t).processing,onClick:b(M,["stop"]),color:"primary"},{default:n(()=>e[9]||(e[9]=[L("Antrag zurÃ¼ckziehen")])),_:1},8,["loading"])):r.can("workLogPatch","create")&&V.value==="edit"?(v(),_(h,{key:1,loading:o(t).processing,type:"submit",color:"primary"},{default:n(()=>e[10]||(e[10]=[L("Korrektur beantragen")])),_:1},8,["loading"])):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{se as default};
