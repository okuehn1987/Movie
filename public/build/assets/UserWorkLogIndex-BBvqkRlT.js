import{d as q,P as T,r as w,N as C,a7 as A,T as B,D as u,a as Q,o as v,c as V,w as l,b as d,K as W,u as s,e as h,l as y,j as P,J as O,S as z,q as E,V as x,f as K,g as L,h as R,k as $,m as J,n as p,B as D,W as j,L as Z}from"./app-DTo6f2ib.js";import{_ as G}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BpgdpbS9.js";import{a as X}from"./utils-CUnn1VJl.js";const ae=q({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(F){const g=F,{currentPage:b,lastPage:S,data:U}=X(T(g),"workLogs",{user:g.user.id}),_=w(!1),c=w(null),f=w(null),k=C(()=>f.value?"plain":"underlined"),N=C(()=>g.workLogs.data.filter((r,e)=>e<5));A(()=>{const r=route().params.workLog;if(r)return H(Number(r))});const t=B({id:-1,start:new Date,end:new Date,start_time:"",end_time:"",is_home_office:!1});function I(){t.transform(r=>{const e=u.fromFormat(r.start_time,"HH:mm"),i=u.fromFormat(r.end_time,"HH:mm");return{...r,start:u.fromISO(r.start.toISOString()).set({hour:e.hour,minute:e.minute}),end:u.fromISO(r.end.toISOString()).set({hour:i.hour,minute:i.minute}),workLog:t.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{t.reset(),_.value=!1}})}function H(r){const e=g.workLogs.data.find(n=>n.id===r);if(!e)return;const i=e.work_log_patches.at(-1);e.end?i?i&&i.status==="created"&&(f.value=i,c.value="show"):(f.value=null,c.value="edit"):(c.value="fix",f.value=e);let a=e.start,o=e.end;i&&i.status=="accepted"&&(a=i.start,o=i.end),t.id=r,t.start=new Date(a),t.end=o?new Date(o):new Date,t.start_time=u.fromSQL(a).toFormat("HH:mm"),t.end_time=u.fromSQL(o||u.now().toSQL()).toFormat("HH:mm"),t.is_home_office=e.is_home_office,_.value=!0}function M(){const r=g.workLogs.data.find(i=>i.id===t.id);if(!r)return;const e=r.work_log_patches.at(-1);e&&Z.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{_.value=!1}})}return(r,e)=>{const i=Q("v-date-input");return v(),V(G,{title:r.user.first_name+" "+r.user.last_name,backurl:r.route().params.fromUserWorkLogs?r.route("users.workLogs"):r.route("dashboard")},{default:l(()=>[d(x,null,{default:l(()=>[d(W,{headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"action",width:"96px",sortable:!1}],items:s(U).map(a=>({...a.work_log_patches.filter(n=>n.status==="accepted").toSorted((n,m)=>n.updated_at<m.updated_at?1:-1)[0]??a,id:a.id})).toSorted((a,o)=>a.start<o.start?1:-1).map(a=>{var o,n;return{start:s(u).fromSQL(a.start).toFormat("dd.MM.yyyy HH:mm"),end:a.end?s(u).fromSQL(a.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",is_home_office:a.is_home_office?"Ja":"Nein",id:a.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((n=(o=r.workLogs.data.find(m=>m.id===a.id))==null?void 0:o.work_log_patches.at(-1))==null?void 0:n.status)||"none"]}})},{"item.action":l(({item:a})=>{var o,n;return[N.value.find(m=>m.id===a.id)?(v(),V(h,{key:0,color:"primary",onClick:y(m=>H(a.id),["stop"]),icon:((n=(o=r.workLogs.data.find(m=>m.id===a.id))==null?void 0:o.work_log_patches.at(-1))==null?void 0:n.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text"},null,8,["onClick","icon"])):P("",!0)]}),bottom:l(()=>[s(S)>1?(v(),V(O,{key:0,modelValue:s(b),"onUpdate:modelValue":e[0]||(e[0]=a=>z(b)?b.value=a:null),length:s(S)},null,8,["modelValue","length"])):P("",!0)]),_:1},8,["items"]),d(E,{"max-width":"1000",modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=a=>_.value=a)},{default:l(({isActive:a})=>[d(x,{title:"Zeitkorrektur"},{append:l(()=>[d(h,{icon:"",variant:"text",onClick:o=>a.value=!1},{default:l(()=>[d(K,null,{default:l(()=>e[7]||(e[7]=[L("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:l(()=>[d(R,null,{default:l(()=>[d($,{onSubmit:y(I,["prevent"])},{default:l(()=>[d(J,null,{default:l(()=>[d(p,{cols:"12",md:"3"},{default:l(()=>[d(i,{disabled:c.value=="fix",label:"Start",required:"","error-messages":s(t).errors.start,modelValue:s(t).start,"onUpdate:modelValue":e[1]||(e[1]=o=>s(t).start=o),variant:k.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),d(p,{cols:"12",md:"3"},{default:l(()=>[d(D,{disabled:c.value=="fix",type:"time",label:"Start",required:"","error-messages":s(t).errors.start_time,modelValue:s(t).start_time,"onUpdate:modelValue":e[2]||(e[2]=o=>s(t).start_time=o),variant:k.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),d(p,{cols:"12",md:"3"},{default:l(()=>[d(i,{disabled:c.value=="fix",label:"Ende",required:"","error-messages":s(t).errors.end,modelValue:s(t).end,"onUpdate:modelValue":e[3]||(e[3]=o=>s(t).end=o),variant:k.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),d(p,{cols:"12",md:"3"},{default:l(()=>[d(D,{disabled:!!f.value,type:"time",label:"Ende",required:"","error-messages":s(t).errors.end_time,modelValue:s(t).end_time,"onUpdate:modelValue":e[4]||(e[4]=o=>s(t).end_time=o),variant:k.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),d(p,{cols:"12",md:"3"},{default:l(()=>[d(j,{disabled:!!f.value,label:"Homeoffice",required:"","error-messages":s(t).errors.is_home_office,modelValue:s(t).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=o=>s(t).is_home_office=o),variant:k.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),d(p,{cols:"12",class:"text-end"},{default:l(()=>[f.value?(v(),V(h,{key:0,loading:s(t).processing,onClick:y(M,["stop"]),color:"primary"},{default:l(()=>e[8]||(e[8]=[L("Antrag zurÃ¼ckziehen")])),_:1},8,["loading"])):(v(),V(h,{key:1,loading:s(t).processing,type:"submit",color:"primary"},{default:l(()=>e[9]||(e[9]=[L("Korrektur beantragen")])),_:1},8,["loading"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{ae as default};
