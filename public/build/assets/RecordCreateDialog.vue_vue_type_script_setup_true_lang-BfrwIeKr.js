import{d as O,D as f,c as U,w as _,r as E,a as g,o as V,Q as I,b as a,f as t,x as L,g as M,J as A,m as B,K as N,L as u,O as x,i as o,M as Q,a1 as w,a2 as j,l as m,s as p,t as q,p as S,V as z,e as y,P as C}from"./app-CCAlNh-e.js";import{D as J}from"./types-BVvW7sCV.js";import{s as T}from"./utils-BV17eheg.js";const G=O({__name:"RecordCreateDialog",props:{users:{},ticket:{},record:{},operatingSites:{}},setup(R){var v,b,k,D;const s=R,e=useForm({start:s.record?f.fromSQL(s.record.start).toISO():null,operatingSite:(v=s.operatingSites.find(i=>i.value.type==="App\\Models\\OperatingSite"))==null?void 0:v.value,duration:T(((b=s.record)==null?void 0:b.duration)??0),description:((k=s.record)==null?void 0:k.description)??"",resources:((D=s.record)==null?void 0:D.resources)??"",files:[]}),c=U(()=>s.record?"edit":"create");_(()=>s.record,()=>{var i,r,d;e.defaults({start:s.record?f.fromSQL(s.record.start).toISO():null,duration:T(((i=s.record)==null?void 0:i.duration)??0),description:((r=s.record)==null?void 0:r.description)??"",resources:((d=s.record)==null?void 0:d.resources)??"",files:[]}).reset()});const n=E(!1);function F(){s.record?e.transform(i=>({...i,_method:"patch"})).post(route("ticketRecord.update",{ticketRecord:s.record.id}),{onSuccess:()=>{e.reset(),n.value=!1}}):e.post(route("ticket.ticketRecord.store",{ticket:s.ticket.id}),{onSuccess:()=>{e.reset(),n.value=!1}})}return(i,r)=>(V(),g(I,{"max-width":"600px",modelValue:n.value,"onUpdate:modelValue":r[6]||(r[6]=d=>n.value=d)},{activator:a(({props:d})=>[c.value==="create"?(V(),g(m,C({key:0,title:"Eintrag hinzufügen"},d,{variant:"text"}),{default:a(()=>[t(S,null,{default:a(()=>[...r[7]||(r[7]=[p("mdi-plus",-1)])]),_:1})]),_:1},16)):y("",!0),i.record&&i.can("ticketRecord","update",i.record)?(V(),g(m,C({key:1,title:"Eintrag bearbeiten"},d,{variant:"text"}),{default:a(()=>[t(S,null,{default:a(()=>[...r[8]||(r[8]=[p("mdi-pencil",-1)])]),_:1})]),_:1},16)):y("",!0)]),default:a(({isActive:d})=>[t(z,{title:c.value==="create"?"Eintrag erstellen":"Eintrag bearbeiten"},{append:a(()=>[t(m,{icon:"",variant:"text",onClick:l=>d.value=!1},{default:a(()=>[t(S,null,{default:a(()=>[...r[9]||(r[9]=[p("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[t(L),t(M,{style:{"max-height":"600px","overflow-y":"auto"}},{default:a(()=>[t(A,{onSubmit:B(F,["prevent"])},{default:a(()=>[t(N,null,{default:a(()=>[t(u,{cols:"12",md:"6"},{default:a(()=>[t(x,{label:"Start",type:"datetime-local","model-value":o(f).fromISO(o(e).start??"").toFormat(o(J)),"onUpdate:modelValue":r[0]||(r[0]=l=>{o(e).start=l}),"error-messages":o(e).errors.start,required:""},null,8,["model-value","error-messages"])]),_:1}),t(u,{cols:"12",md:"6"},{default:a(()=>[t(x,{label:"Dauer (in Stunden)",type:"time",modelValue:o(e).duration,"onUpdate:modelValue":r[1]||(r[1]=l=>o(e).duration=l),"error-messages":o(e).errors.duration,required:""},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12"},{default:a(()=>[t(Q,{label:"Standort",modelValue:o(e).operatingSite,"onUpdate:modelValue":r[2]||(r[2]=l=>o(e).operatingSite=l),items:i.operatingSites.filter(l=>!("customer_id"in l)||l.customer_id===i.ticket.customer_id),"error-messages":o(e).errors.operatingSite},null,8,["modelValue","items","error-messages"])]),_:1}),t(u,{cols:"12"},{default:a(()=>[t(w,{label:"Beschreibung",modelValue:o(e).description,"onUpdate:modelValue":r[3]||(r[3]=l=>o(e).description=l),"error-messages":o(e).errors.description,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12"},{default:a(()=>[t(w,{label:"Ressourcen",rows:"1",modelValue:o(e).resources,"onUpdate:modelValue":r[4]||(r[4]=l=>o(e).resources=l),"error-messages":o(e).errors.resources,"auto-grow":""},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12"},{default:a(()=>[t(j,{label:"Dateien anhängen",multiple:"",modelValue:o(e).files,"onUpdate:modelValue":r[5]||(r[5]=l=>o(e).files=l),"error-messages":o(e).errors["files.0"],accept:"image/jpg, image/png, image/jpeg, image/avif, image/tiff, image/svg+xml, application/pdf"},null,8,["modelValue","error-messages"])]),_:1}),t(u,{class:"text-end"},{default:a(()=>[t(m,{color:"primary",type:"submit",loading:o(e).processing,disabled:!o(e).isDirty},{default:a(()=>[p(q(c.value==="create"?"Speichern":"Änderungen speichern"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]),_:1},8,["modelValue"]))}});export{G as _};
