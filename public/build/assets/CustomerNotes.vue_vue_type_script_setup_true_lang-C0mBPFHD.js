import{d as T,r as f,w as z,c as D,a as u,b as a,e as r,g as o,k as N,y as I,U as M,j as n,q as _,a1 as x,f as F,v as p,a2 as H,a0 as K,h,D as k,m as O,t as U,s as $,V as A,B as L}from"./app-CqzKjYDh.js";import{t as j,u as q,a as G,m as J,b as P}from"./utils-YP4QL_W4.js";import{_ as c}from"./CreateEditCustomerNoteFolder.vue_vue_type_script_setup_true_lang-DP2RPHBU.js";import{_ as g}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-CU89BkiV.js";import{_ as V}from"./CreateEditCustomerNoteEntry.vue_vue_type_script_setup_true_lang-Y1VPesln.js";const Q={class:"d-flex align-center"},R={key:1,class:"d-flex"},W={class:"flex-shrink-1",style:{"max-width":"40%"}},X={class:"ma-2"},Y={style:{"user-select":"none"}},Z={class:"flex-grow-1"},ee={key:0},te={class:"d-flex"},ne=T({__name:"CustomerNotes",props:{customerNoteFolders:{},customerNoteEntries:{},customer:{}},setup(b){var y;const v=b,l=f(((y=v.customerNoteFolders[0])==null?void 0:y.id)??null),m=f(!1),E=j(()=>{l.value&&L.reload({data:{selectedFolder:l.value},only:["customerNoteEntries"],onStart:()=>{l.value&&(m.value=!0)},onFinish:()=>m.value=!1})},500);z(l,E);const w=q(48),d=f([]),B=D(()=>G(J(v.customerNoteFolders,"sub_folders",(s,i)=>({name:s.name,id:s.id,level:i})),"sub_folders",()=>!0)),{clickHandler:S}=P();function C(t){S(()=>{l.value=t??l.value},s=>{d.value.includes(t??s)?d.value=d.value.filter(i=>i!=(t??s)):d.value.push(t??s)},t)}return(t,s)=>(a(),u(A,{style:$({height:h(w)}),title:"Kundennotizen"},{append:r(()=>[...s[2]||(s[2]=[])]),default:r(()=>{var i;return[o(I),t.customerNoteFolders.length==0?(a(),u(M,{key:0,color:"warning"},{default:r(()=>[n("div",Q,[o(_,{icon:"mdi-information",class:"me-2"}),s[3]||(s[3]=n("span",{class:"me-2"},"Es existiert noch kein Ordner, hier kannst du einen anlegen:",-1)),o(c,{customer:t.customer,hasFolders:!1},null,8,["customer"])])]),_:1})):(a(),N("div",R,[n("div",W,[n("div",X,[o(c,{customer:t.customer,hasFolders:!0},null,8,["customer"])]),o(x,{indentLines:!0,opened:d.value,"onUpdate:opened":s[0]||(s[0]=e=>d.value=e),"item-children":"sub_folders",items:B.value,"item-value":"id",activatable:"","onUpdate:activated":s[1]||(s[1]=e=>C(e[0]))},{prepend:r(()=>[o(_,{icon:"mdi-folder"})]),title:r(({item:e})=>[n("span",Y,p(e.name),1)]),append:r(({item:e})=>[e.level<2?(a(),u(c,{key:0,createSubFolder:e,customer:t.customer},null,8,["createSubFolder","customer"])):F("",!0),o(c,{editNoteFolder:e,customer:t.customer},null,8,["editNoteFolder","customer"]),o(g,{title:'Kategorie "'+e.name+'" löschen',content:'Bist du dir sicher, dass du die Kategorie "'+e.name+'" mit all ihren Inhalten löschen möchtest?',route:t.route("customerNoteFolder.destroy",{customerNoteFolder:e.id})},null,8,["title","content","route"])]),_:1},8,["opened","items"])]),n("div",Z,[m.value?(a(),u(H,{key:0,type:"table"})):l.value?(a(),u(K,{key:1,items:(i=t.customerNoteEntries)==null?void 0:i.map(e=>({...e,userName:e.user.first_name+" "+e.user.last_name+" am "+h(k).fromISO(e.updated_at).toFormat("dd.MM.yyyy")})),headers:[{title:"Titel",value:"title"},{title:"Inhalt",value:"value"},{title:"letzte Bearbeitung",value:"userName"},{title:"",value:"actions",width:"1px",align:"end"}]},{"header.actions":r(()=>[o(V,{selectedFolder:l.value,customer:t.customer},null,8,["selectedFolder","customer"])]),"item.updated_at":r(({item:e})=>[U(p(h(k).fromISO(e.updated_at).toFormat("dd.MM.yyyy")),1)]),"item.value":r(({item:e})=>[e.type=="text"?(a(),N("span",ee,p(e.value),1)):(a(),u(O,{key:1,color:"primary",variant:"text",icon:"mdi-file-document-outline",href:t.route("customerNoteEntry.getFile",{customerNoteEntry:e.id}),download:e.title},null,8,["href","download"]))]),"item.actions":r(({item:e})=>[n("div",te,[o(V,{selectedFolder:l.value,customer:t.customer,customerNoteEntry:e},null,8,["selectedFolder","customer","customerNoteEntry"]),o(g,{title:'Notiz "'+e.title+'" löschen',content:'Bist du dir sicher, dass du die Notiz "'+e.title+'" löschen möchtest?',route:t.route("customerNoteEntry.destroy",{customerNoteEntry:e.id})},null,8,["title","content","route"])])]),_:1},8,["items"])):F("",!0)])]))]}),_:1},8,["style"]))}});export{ne as _};
