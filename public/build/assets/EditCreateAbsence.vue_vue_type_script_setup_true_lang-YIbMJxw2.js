import{d as K,B as O,C as $,c as L,R as Q,a as u,o,b as t,f as n,V as h,i as a,e as b,x as z,g as Y,S as j,s as m,t as f,J as G,m as _,K as E,L as i,M as W,O as P,D as H,h as A,j as X,F as Z,l as v,p as x,Q as ee}from"./app-CCqQBZdk.js";const se={class:"d-flex ga-2 justify-end"},le=K({__name:"EditCreateAbsence",props:O({users:{},absenceTypes:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:O(["absenceReload"],["update:modelValue","update:selectedUser"]),setup(V,{emit:I}){var U,w,B,S,T,R,q;const D=I,r=V,p=$(V,"modelValue"),k=$(V,"selectedUser"),c=L(()=>r.users.find(s=>s.id===k.value)),e=useForm({user_id:((U=r.selectedAbsence)==null?void 0:U.user_id)??k.value,start:((w=r.selectedAbsence)==null?void 0:w.start)??((B=r.selectedDate)==null?void 0:B.toFormat("yyyy-MM-dd"))??null,end:((S=r.selectedAbsence)==null?void 0:S.end)??((T=r.selectedDate)==null?void 0:T.toFormat("yyyy-MM-dd"))??null,absence_type_id:((R=r.selectedAbsence)==null?void 0:R.absence_type_id)??null,absence_id:r.selectedAbsence&&"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:((q=r.selectedAbsence)==null?void 0:q.id)??null});function J(){const s={onSuccess:()=>{e.reset(),p.value=!1,D("absenceReload")}};e.absence_type_id=="homeOffice"?e.post(route("homeOfficeDay.store"),s):e.absence_id?e.post(route("absence.absencePatch.store",{absence:e.absence_id}),s):e.post(route("absence.store"),s)}const F=useForm({});function C(){r.selectedAbsence&&F.delete(route("absence.destroy",{absence:"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:r.selectedAbsence.id}),{onSuccess:()=>{p.value=!1,D("absenceReload")}})}const M=L(()=>{const s=r.absenceTypes.find(d=>d.id===e.absence_type_id);return!r.selectedAbsence||(s==null?void 0:s.requires_approval)&&Q().props.auth.user.supervisor_id});return(s,d)=>(o(),u(ee,{"max-width":"1000",modelValue:p.value,"onUpdate:modelValue":d[5]||(d[5]=g=>p.value=g)},{default:t(({isActive:g})=>{var N;return[n(h,{title:"Abwesenheit"+(a(e).user_id!=s.$page.props.auth.user.id?" von "+((N=s.users.map(l=>({...l,name:l.first_name+" "+l.last_name})).find(l=>l.id===a(e).user_id))==null?void 0:N.name):"")+(s.can("absence","update",s.users.find(l=>l.id==a(e).user_id))||!M.value?" bearbeiten":" beantragen")},{append:t(()=>[n(v,{icon:"",variant:"text",onClick:l=>{g.value=!1,a(e).reset()}},{default:t(()=>[n(x,null,{default:t(()=>[...d[6]||(d[6]=[m("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:t(()=>[n(z),a(e).errors.user_id?(o(),u(Y,{key:0},{default:t(()=>[n(j,{color:"error",closable:""},{default:t(()=>[m(f(a(e).errors.user_id),1)]),_:1})]),_:1})):b("",!0),n(Y,null,{default:t(()=>[n(G,{onSubmit:_(J,["prevent"])},{default:t(()=>[n(E,null,{default:t(()=>[n(i,{cols:"12"},{default:t(()=>{var l;return[n(W,{label:"Abwesenheitsgrund angeben",items:[...s.absenceTypes.map(y=>({title:y.name,value:y.id})),((l=c.value)==null?void 0:l.home_office)&&{title:"Homeoffice",value:"homeOffice"}].filter(Boolean),modelValue:a(e).absence_type_id,"onUpdate:modelValue":d[0]||(d[0]=y=>a(e).absence_type_id=y),"error-messages":a(e).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]}),_:1}),n(i,{cols:"12",md:"6"},{default:t(()=>[n(P,{type:"date",label:"Von",modelValue:a(e).start,"onUpdate:modelValue":d[1]||(d[1]=l=>a(e).start=l),"error-messages":a(e).errors.start},null,8,["modelValue","error-messages"])]),_:1}),n(i,{cols:"12",md:"6"},{default:t(()=>[n(P,{type:"date",label:"Bis",modelValue:a(e).end,"onUpdate:modelValue":d[2]||(d[2]=l=>a(e).end=l),"error-messages":a(e).errors.end},null,8,["modelValue","error-messages"])]),_:1}),c.value&&c.value.leaveDaysForYear&&(!s.selectedDate||s.selectedDate.year==a(H).now().year)?(o(),u(j,{key:0,type:"info",class:"w-100"},{default:t(()=>[n(E,null,{default:t(()=>[n(i,{cols:"12",md:"6"},{default:t(()=>[A("div",null,"Bereits verwendete Urlaubstage für "+f(a(H).now().year),1)]),_:1}),n(i,{cols:"12",md:"6"},{default:t(()=>[A("div",null,f(c.value.usedLeaveDaysForYear)+" von "+f(c.value.leaveDaysForYear),1)]),_:1})]),_:1})]),_:1})):b("",!0),n(i,{cols:"12"},{default:t(()=>[A("div",se,[s.selectedAbsence?(o(),X(Z,{key:0},[s.can("absence","update",s.users.find(l=>l.id==a(e).user_id))?(o(),u(v,{key:0,onClick:d[3]||(d[3]=_(l=>C(),["stop"])),color:"error",loading:a(F).processing},{default:t(()=>[...d[7]||(d[7]=[m(" löschen ",-1)])]),_:1},8,["loading"])):s.selectedAbsence.status!=="declined"?(o(),u(v,{key:1,onClick:d[4]||(d[4]=_(l=>C(),["stop"])),color:"error"},{default:t(()=>[...d[8]||(d[8]=[m(" Löschung beantragen ",-1)])]),_:1})):b("",!0)],64)):b("",!0),!s.selectedAbsence||s.selectedAbsence.status!=="declined"?(o(),u(v,{key:1,loading:a(e).processing,type:"submit",color:"primary",disabled:!a(e).isDirty},{default:t(()=>[m(f(s.can("absence","update",s.users.find(l=>l.id==a(e).user_id))||!M.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])):b("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{le as _};
