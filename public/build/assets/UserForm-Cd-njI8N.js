import{d as I,T as P,M as k,r as A,a as N,o as V,c as W,w as u,V as q,b as o,al as K,e as C,l as v,g as c,t as j,am as J,v as O,x as R,F as B,an as G,R as Z,U as $,j as D,k as x,ao as Q,ap as S,h as y,m as U,n as a,B as d,u as l,s as b,p as f,y as X,W as Y,aq as h,D as M}from"./app-BF2zvPeQ.js";import{b as ee,g as re}from"./utils-BC8LhfFi.js";import{_ as w}from"./PermissionSelector.vue_vue_type_script_setup_true_lang-Bw8t2qCq.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le=I({__name:"UserForm",props:{user:{},supervisors:{},operating_sites:{},groups:{},mode:{},countries:{},permissions:{}},emits:["success"],setup(F,{emit:T}){var H;const i=F,E=T,e=P({first_name:"",last_name:"",email:"",date_of_birth:null,city:"",zip:"",street:"",house_number:"",address_suffix:"",country:"",federal_state:"",phone_number:"",staff_number:0,password:"",group_id:null,operating_site_id:null,supervisor_id:null,is_supervisor:!1,userWorkingHours:0,userWorkingHoursSince:new Date,userWorkingWeek:[],userWorkingWeekSince:new Date,organizationUser:{absence_permission:null,absenceType_permission:null,group_permission:null,operatingSite_permission:null,organization_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,specialWorkingHoursFactor_permission:null,workLogPatch_permission:null},groupUser:{absence_permission:null,group_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null},operatingSiteUser:{absence_permission:null,operatingSite_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null}});if(i.user){e.first_name=i.user.first_name,e.last_name=i.user.last_name,e.email=i.user.email,e.date_of_birth=i.user.date_of_birth,e.city=i.user.city??"",e.zip=i.user.zip??"",e.street=i.user.street??"",e.house_number=i.user.house_number??"",e.address_suffix=i.user.address_suffix??"",e.country=i.user.country,e.federal_state=i.user.federal_state,e.phone_number=i.user.phone_number??"",e.staff_number=i.user.staff_number,e.password=i.user.password,e.group_id=i.user.group_id,e.operating_site_id=i.user.operating_site_id,e.supervisor_id=i.user.supervisor_id,e.userWorkingHours=((H=i.user.currentWorkingHours)==null?void 0:H.weekly_working_hours)??0,e.userWorkingHoursSince=new Date(i.user.currentWorkingHours.active_since);for(const n of k.weekdays("long",{locale:"en"}).map(r=>r.toLowerCase()))i.user.userWorkingWeek[n]&&e.userWorkingWeek.push(n);e.userWorkingWeekSince=new Date(i.user.userWorkingWeek.active_since),e.organizationUser=i.user.organization_user,e.groupUser=i.user.group_user,e.operatingSiteUser=i.user.operating_site_user}function z(){const n=e.transform(r=>({...r,userWorkingHoursSince:M.fromJSDate(e.userWorkingHoursSince).toFormat("yyyy-MM-dd"),userWorkingWeekSince:M.fromJSDate(e.userWorkingWeekSince).toFormat("yyyy-MM-dd"),date_of_birth:r.date_of_birth?new Date(r.date_of_birth).toISOString():null,organizationUser:Object.fromEntries(Object.entries(r.organizationUser).filter(([p])=>i.permissions.find(s=>s.name==p))),groupUser:Object.fromEntries(Object.entries(r.groupUser).filter(([p])=>i.permissions.find(s=>s.name==p))),operatingSiteUser:Object.fromEntries(Object.entries(r.operatingSiteUser).filter(([p])=>i.permissions.find(s=>s.name==p)))}));i.mode=="edit"&&i.user?n.patch(route("user.update",{user:i.user.id}),{onError:r=>console.log(r)}):n.post(route("user.store"),{onSuccess:()=>{e.reset(),E("success")},onError:r=>console.log(r)})}const _=A(1),t=A([{isValidated:!1,name:"Allgemeine Angaben",fields:{first_name:[()=>!!e.first_name],last_name:[()=>!!e.last_name],email:[()=>!!e.email],date_of_birth:[()=>!0],password:[()=>i.mode!=="create"||!!e.password],userWorkingHours:[()=>!!e.userWorkingHours],userWorkingHoursSince:[()=>!!e.userWorkingHoursSince],userWorkingWeek:[()=>!!e.userWorkingWeek],userWorkingWeekSince:[()=>!!e.userWorkingWeekSince]}},{isValidated:!1,name:"Adresse",fields:{street:[()=>!0],house_number:[()=>!0],zip:[()=>!0],city:[()=>!0],federal_state:[()=>!!e.federal_state],country:[()=>!!e.country]}},{isValidated:!1,name:"Berechtigungen",fields:{operating_site_id:[()=>!!e.operating_site_id],group_id:[()=>!!e.group_id]}}]);return(n,r)=>{const p=N("v-date-input");return V(),W(q,null,{default:u(()=>[o(h,{modelValue:_.value,"onUpdate:modelValue":r[22]||(r[22]=s=>_.value=s)},{actions:u(({next:s,prev:m})=>[o(K,{disabled:!1},{prev:u(()=>[o(C,{color:"primary",variant:"elevated",onClick:v(m,["stop"])},{default:u(()=>r[28]||(r[28]=[c("Zurück")])),_:2},1032,["onClick"])]),next:u(()=>[o(C,{color:"secondary",variant:"elevated",onClick:v(()=>{const g=t.value[_.value-1];g&&Object.values(g.fields).flat().some(L=>!L())||(g&&(g.isValidated=!0),_.value==3?z():s())},["stop"])},{default:u(()=>[c(j(_.value==3?"Speichern":"Weiter"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:u(()=>[o(J,null,{default:u(()=>[(V(!0),O(B,null,R(t.value,(s,m)=>(V(),O(B,{key:m},[o(G,Z({ref_for:!0},{editable:n.mode=="edit"&&s.isValidated,rules:s.isValidated?Object.values(s.fields).flat():[],step:m,title:s.name,value:m+1}),null,16),c(" "+j(s)+" ",1),m<t.value.length?(V(),W($,{key:m})):D("",!0)],64))),128))]),_:1}),o(x,{onSubmit:v(z,["prevent"])},{default:u(()=>[o(Q,null,{default:u(()=>[o(S,{value:1},{default:u(()=>[o(y,null,{default:u(()=>[o(U,null,{default:u(()=>[o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).first_name,"onUpdate:modelValue":r[0]||(r[0]=s=>l(e).first_name=s),label:"Vorname","error-messages":l(e).errors.first_name,rules:t.value[0].fields.first_name},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).last_name,"onUpdate:modelValue":r[1]||(r[1]=s=>l(e).last_name=s),label:"Nachname","error-messages":l(e).errors.last_name,rules:t.value[0].fields.last_name},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).email,"onUpdate:modelValue":r[2]||(r[2]=s=>l(e).email=s),label:"Email","error-messages":l(e).errors.email,rules:t.value[0].fields.email},null,8,["modelValue","error-messages","rules"])]),_:1}),n.mode=="create"?(V(),W(a,{key:0,cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).password,"onUpdate:modelValue":r[3]||(r[3]=s=>l(e).password=s),label:"Passwort","error-messages":l(e).errors.password,rules:t.value[0].fields.password},null,8,["modelValue","error-messages","rules"])]),_:1})):D("",!0),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{type:"date",modelValue:l(e).date_of_birth,"onUpdate:modelValue":r[4]||(r[4]=s=>l(e).date_of_birth=s),label:"Geburtsdatum",required:"","error-messages":l(e).errors.date_of_birth,rules:t.value[0].fields.date_of_birth},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12"},{default:u(()=>r[23]||(r[23]=[b("h4",null,"Arbeitszeiten",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).userWorkingHours,"onUpdate:modelValue":r[5]||(r[5]=s=>l(e).userWorkingHours=s),label:"Trage die wöchentliche Arbeitszeit des Mitarbeiters ein","error-messages":l(e).errors.userWorkingHours,rules:t.value[0].fields.userWorkingHours},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(p,{"prepend-icon":"",modelValue:l(e).userWorkingHoursSince,"onUpdate:modelValue":r[6]||(r[6]=s=>l(e).userWorkingHoursSince=s),label:"seit","error-messages":l(e).errors.userWorkingHoursSince,rules:t.value[0].fields.userWorkingHoursSince},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:l(e).userWorkingWeek,"onUpdate:modelValue":r[7]||(r[7]=s=>l(e).userWorkingWeek=s),multiple:"",items:l(k).weekdays().map((s,m)=>{var g;return{title:s,value:(g=l(k).weekdays("long",{locale:"en"})[m])==null?void 0:g.toLowerCase()}}),label:"Wähle die Arbeitstage des Mitarbeiters aus","error-messages":l(e).errors.userWorkingWeek,rules:t.value[0].fields.userWorkingWeek},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(p,{"prepend-icon":"",modelValue:l(e).userWorkingWeekSince,"onUpdate:modelValue":r[8]||(r[8]=s=>l(e).userWorkingWeekSince=s),label:"seit","error-messages":l(e).errors.userWorkingWeekSince,rules:t.value[0].fields.userWorkingWeekSince},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),o(S,{value:2},{default:u(()=>[o(y,null,{default:u(()=>[o(U,null,{default:u(()=>[o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).street,"onUpdate:modelValue":r[9]||(r[9]=s=>l(e).street=s),label:"Straße","error-messages":l(e).errors.street,rules:t.value[1].fields.street},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).house_number,"onUpdate:modelValue":r[10]||(r[10]=s=>l(e).house_number=s),label:"Hausnummer","error-messages":l(e).errors.house_number,rules:t.value[1].fields.house_number},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).zip,"onUpdate:modelValue":r[11]||(r[11]=s=>l(e).zip=s),label:"Postleitzahl","error-messages":l(e).errors.zip,rules:t.value[1].fields.zip},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:l(e).city,"onUpdate:modelValue":r[12]||(r[12]=s=>l(e).city=s),label:"Ort","error-messages":l(e).errors.city,rules:t.value[1].fields.city},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{label:"Land",required:"",items:n.countries,"error-messages":l(e).errors.country,modelValue:l(e).country,"onUpdate:modelValue":r[13]||(r[13]=s=>l(e).country=s),rules:t.value[1].fields.country},null,8,["items","error-messages","modelValue","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{label:"Bundesland",items:l(ee)(l(e).country,n.countries),disabled:!l(e).country,required:"","error-messages":l(e).errors.federal_state,modelValue:l(e).federal_state,"onUpdate:modelValue":r[14]||(r[14]=s=>l(e).federal_state=s),rules:t.value[1].fields.federal_state},null,8,["items","disabled","error-messages","modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),o(S,{value:3},{default:u(()=>[o(y,{style:X(n.mode=="create"?{maxHeight:l(re)(72+24*2+52)}:{}),class:"overflow-auto"},{default:u(()=>[o(U,null,{default:u(()=>[o(a,{cols:"12"},{default:u(()=>r[24]||(r[24]=[b("h4",null,"Organisation",-1)])),_:1}),o(w,{modelValue:l(e).organizationUser,"onUpdate:modelValue":r[15]||(r[15]=s=>l(e).organizationUser=s),objKey:"organizationUser",permissions:n.permissions,errors:l(e).errors,label:"Organisationsrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[25]||(r[25]=[b("h4",null,"Betriebsstätte",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:l(e).operating_site_id,"onUpdate:modelValue":r[16]||(r[16]=s=>l(e).operating_site_id=s),items:n.operating_sites.map(s=>({title:s.name,value:s.id})),label:"Wähle die Betriebsstätte des Mitarbeiters aus.","error-messages":l(e).errors.operating_site_id,rules:t.value[2].fields.operating_site_id},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(w,{modelValue:l(e).operatingSiteUser,"onUpdate:modelValue":r[17]||(r[17]=s=>l(e).operatingSiteUser=s),objKey:"operatingSiteUser",permissions:n.permissions,errors:l(e).errors,label:"Betriebstättenrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[26]||(r[26]=[b("h4",null,"Abteilung",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:l(e).group_id,"onUpdate:modelValue":r[18]||(r[18]=s=>l(e).group_id=s),items:n.groups.map(s=>({title:s.name,value:s.id})),label:"Wähle eine Abteilung aus, zu die der Mitarbeiter gehören soll.","error-messages":l(e).errors.group_id,rules:t.value[2].fields.group_id},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(w,{modelValue:l(e).groupUser,"onUpdate:modelValue":r[19]||(r[19]=s=>l(e).groupUser=s),objKey:"groupUser",permissions:n.permissions,errors:l(e).errors,label:"Abteilungsrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[27]||(r[27]=[b("h4",null,"Vorgesetzter",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:l(e).supervisor_id,"onUpdate:modelValue":r[20]||(r[20]=s=>l(e).supervisor_id=s),items:n.supervisors.map(s=>({title:s.first_name+" "+s.last_name,value:s.id})),label:"Wähle einen Vorgesetzten, falls vorhanden","error-messages":l(e).errors.supervisor_id},null,8,["modelValue","items","error-messages"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(Y,{modelValue:l(e).is_supervisor,"onUpdate:modelValue":r[21]||(r[21]=s=>l(e).is_supervisor=s),label:"Ist ein Vorgesetzter"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),te=se(le,[["__scopeId","data-v-ec81140b"]]);export{te as default};
