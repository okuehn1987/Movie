import{d as T,y as j,z as S,c as I,A as z,o as u,a as c,B as H,b as l,f as n,h as b,j as J,k as i,u as t,V as w,C as K,t as D,e as q,E as L,i as V,H as P,I as m,J as R,K as N,g as G,q as O,F as Q,v as W}from"./app-BCEOGN35.js";const X={class:"d-flex ga-2 justify-end"},Z=T({__name:"EditCreateAbsence",props:j({users:{},absence_types:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:["update:modelValue","update:selectedUser"],setup(p){var A,v,k,C,F,M,U;const d=p,o=S(p,"modelValue"),$=S(p,"selectedUser"),e=useForm({user_id:((A=d.selectedAbsence)==null?void 0:A.user_id)??$.value,start:((v=d.selectedAbsence)==null?void 0:v.start)??((k=d.selectedDate)==null?void 0:k.toFormat("yyyy-MM-dd"))??null,end:((C=d.selectedAbsence)==null?void 0:C.end)??((F=d.selectedDate)==null?void 0:F.toFormat("yyyy-MM-dd"))??null,absence_type_id:((M=d.selectedAbsence)==null?void 0:M.absence_type_id)??null,absence_id:d.selectedAbsence&&"absence_id"in d.selectedAbsence?d.selectedAbsence.absence_id:((U=d.selectedAbsence)==null?void 0:U.id)??null});function E(){e.absence_id?e.post(route("absence.absencePatch.store",{absence:e.absence_id}),{onSuccess:()=>{e.reset(),o.value=!1}}):e.post(route("absence.store"),{onSuccess:()=>{e.reset(),o.value=!1}})}const y=useForm({});function _(){d.selectedAbsence&&y.delete(route("absence.destroy",{absence:"absence_id"in d.selectedAbsence?d.selectedAbsence.absence_id:d.selectedAbsence.id}),{onSuccess:()=>{o.value=!1}})}const g=I(()=>{const r=d.absence_types.find(a=>a.id===e.absence_type_id);return!d.selectedAbsence||(r==null?void 0:r.requires_approval)&&z().props.auth.user.supervisor_id});return(r,a)=>(u(),c(H,{"max-width":"1000",modelValue:o.value,"onUpdate:modelValue":a[5]||(a[5]=f=>o.value=f)},{default:l(({isActive:f})=>{var B;return[n(W,{title:"Abwesenheit"+(t(e).user_id!=r.$page.props.auth.user.id?" von "+((B=r.users.map(s=>({...s,name:s.first_name+" "+s.last_name})).find(s=>s.id===t(e).user_id))==null?void 0:B.name):"")+(r.can("absence","update",r.users.find(s=>s.id==t(e).user_id))||!g.value?" bearbeiten":" beantragen")},{append:l(()=>[n(b,{icon:"",variant:"text",onClick:s=>f.value=!1},{default:l(()=>[n(J,null,{default:l(()=>a[6]||(a[6]=[i("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:l(()=>[t(e).errors.user_id?(u(),c(w,{key:0},{default:l(()=>[n(K,{color:"error",closable:""},{default:l(()=>[i(D(t(e).errors.user_id),1)]),_:1})]),_:1})):q("",!0),n(w,null,{default:l(()=>[n(L,{onSubmit:V(E,["prevent"])},{default:l(()=>[n(P,null,{default:l(()=>[n(m,{cols:"12"},{default:l(()=>[n(R,{label:"Abwesenheitsgrund angeben",items:r.absence_types.map(s=>({title:s.name,value:s.id})),modelValue:t(e).absence_type_id,"onUpdate:modelValue":a[0]||(a[0]=s=>t(e).absence_type_id=s),"error-messages":t(e).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),n(m,{cols:"12",md:"6"},{default:l(()=>[n(N,{type:"date",label:"Von",modelValue:t(e).start,"onUpdate:modelValue":a[1]||(a[1]=s=>t(e).start=s),"error-messages":t(e).errors.start},null,8,["modelValue","error-messages"])]),_:1}),n(m,{cols:"12",md:"6"},{default:l(()=>[n(N,{type:"date",label:"Bis",modelValue:t(e).end,"onUpdate:modelValue":a[2]||(a[2]=s=>t(e).end=s),"error-messages":t(e).errors.end},null,8,["modelValue","error-messages"])]),_:1}),n(m,{cols:"12"},{default:l(()=>[G("div",X,[r.selectedAbsence?(u(),O(Q,{key:0},[r.can("absence","update",r.users.find(s=>s.id==t(e).user_id))?(u(),c(b,{key:0,onClick:a[3]||(a[3]=V(s=>_(),["stop"])),color:"error",loading:t(y).processing},{default:l(()=>a[7]||(a[7]=[i(" löschen ")])),_:1},8,["loading"])):(u(),c(b,{key:1,onClick:a[4]||(a[4]=V(s=>_(),["stop"])),color:"error"},{default:l(()=>a[8]||(a[8]=[i("Löschung beantragen")])),_:1}))],64)):q("",!0),n(b,{loading:t(e).processing,type:"submit",color:"primary",disabled:!t(e).isDirty},{default:l(()=>[i(D(r.can("absence","update",r.users.find(s=>s.id==t(e).user_id))||!g.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{Z as _};
