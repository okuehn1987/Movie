import{d as T,as as E,r as C,w as m,at as B,af as R,j as h,o as r,i as g,f as v,b as l,e as n,a as c,F as D,z as I,g as i,T as w,t as b,l as L,m as d,A as N,s as k,al as $,p as F,au as x,a2 as A,D as K}from"./app-CWaWGJDI.js";import V from"./ChatMessage-BJnZlXGW.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"chat-details"},j={id:"messages",class:"messages"},z=["id"],q={key:1,class:"bg-white"},G={class:"d-flex justify-space-between"},H=T({__name:"ChatDetails",props:{chat:{},reachedMonthlyTokenLimit:{type:Boolean},showChat:{type:Boolean}},setup(M){const f=M,{chat:_}=E(f),a=C(_.value);m(_,e=>a.value=e),m(()=>f.showChat,()=>{f.showChat&&setTimeout(y,200)});const s=B({msg:""});function u(){var e;s.clearErrors(),s.post(route("isa.message"),{preserveScroll:!0}),(e=a.value)==null||e.chat_messages.push({id:-1,created_at:K.local().toISO(),msg:s.msg.replaceAll(`
`,"<br>"),role:"user"}),s.reset()}const p=C("");m(a,()=>{p.value="",R(y)},{immediate:!0,deep:!0}),m(p,y,{immediate:!0});function y(){const e=document.getElementById("messages");e&&e.scrollTo({top:e.scrollHeight,behavior:"instant"})}return a.value&&window.Echo.channel("chat."+a.value.id).listen(".ChatMessageDelta",({msg:e})=>{p.value+=e}),(e,t)=>(r(),h("div",P,[g("div",j,[v($,{style:{"max-width":"100%"},class:"m-0 px-0 pb-0 pt-2"},{default:l(()=>[a.value&&a.value.chat_messages.length>0?(r(!0),h(D,{key:0},I(a.value.chat_messages.filter(o=>o.role!="annotation"),(o,S)=>(r(),h("div",{key:S.toString(),id:"ChatMessage-"+o.id.toString()},[v(V,{chatMessage:o},null,8,["chatMessage"])],8,z))),128)):n("",!0),i(s).processing?n("",!0):(r(),h("div",q,[e.$page.props.errors.openai?(r(),c(w,{key:0,variant:"tonal",color:"error"},{default:l(()=>[g("div",G,[g("span",null,b(e.$page.props.errors.openai),1),e.$page.props.errors.error_code=="OPENAI_SERVER_ERROR"?(r(),c(L,{key:0,color:"primary",onClick:t[0]||(t[0]=d(o=>i(N).post(e.route("chat.retryLastRun",{chat:a.value.id})),["stop"]))},{default:l(()=>[...t[3]||(t[3]=[k(" Erneut senden ",-1)])]),_:1})):n("",!0)])]),_:1})):n("",!0),e.$page.props.errors.msg?(r(),c(w,{key:1,variant:"tonal",color:"error"},{default:l(()=>[k(b(e.$page.props.errors.msg),1)]),_:1})):n("",!0),e.reachedMonthlyTokenLimit?(r(),c(w,{key:2,variant:"tonal",color:"error"},{default:l(()=>[...t[4]||(t[4]=[k(" Dieser Service ist derzeit leider nicht verfÃ¼gbar, bitte wenden Sie sich an den technischen Support ",-1)])]),_:1})):n("",!0)])),i(s).processing||p.value?(r(),c(V,{key:2,chatMessage:{msg:p.value,role:"assistant",id:-1},isLoading:!0,reached_token_limit:null},null,8,["chatMessage"])):n("",!0)]),_:1})]),g("form",{class:"composer mt-2 w-100",onSubmit:d(u,["prevent"])},[v(A,{label:"Geben Sie hier Ihre Frage ein...",modelValue:i(s).msg,"onUpdate:modelValue":t[2]||(t[2]=o=>i(s).msg=o),required:"","auto-grow":"",maxlength:"2000",rows:"1","hide-details":"",autocomplete:"none",disabled:i(s).processing||e.reachedMonthlyTokenLimit,"error-messages":i(s).errors.msg,onKeydown:x(d(u,["ctrl","exact","prevent"]),["enter"]),style:{"user-select":"unset"},title:"Nachricht senden (Strg + Enter)"},{"append-inner":l(()=>[v(F,{style:{opacity:"1"},color:"primary",icon:"mdi-send-variant",class:"pa-6 ps-13 ms-n6",onTouchstart:d(u,["stop","prevent"]),onMousedown:d(u,["stop"]),onClick:t[1]||(t[1]=d(()=>{},["stop"]))})]),_:1},8,["modelValue","disabled","error-messages","onKeydown"])],32)]))}}),W=O(H,[["__scopeId","data-v-ed7ab15c"]]);export{W as default};
