import{d as L,r as o,D as p,c as P,w as H,o as l,a as b,b as r,e as x,f as n,V as j,g as d,h,i as k,j as g,k as G,t as C,l as Q,m as q,n as z,p as R,u as T,q as c,s as J,F as w,v as K,G as W}from"./app-BjDVB6Ua.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-0eeX3oFR.js";import{u as Y,t as Z}from"./utils-C0yNdIM4.js";import{_ as ee,g as te}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-Cp0F4oE5.js";import{_ as ae}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-uDXnHBLC.js";import{_ as se}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-CfNrBLRd.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={class:"d-flex flex-wrap justify-center align-center"},le={class:"d-flex flex-wrap align-center"},oe={class:"d-flex"},re={class:"mx-4 text-center",style:{"min-width":"170px"}},ue={class:"d-flex"},ie={key:0},de={key:0},ce={key:1},Me=L({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{}},setup(I){const y=I,S=route().params.date,s=o(S?p.fromFormat(S,"yyyy-MM"):p.now()),D=P(()=>[].concat(y.absencePatches.filter(t=>t.start<=s.value.endOf("month").toFormat("yyyy-MM-dd")&&t.end>=s.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(y.absences.filter(t=>t.start<=s.value.endOf("month").toFormat("yyyy-MM-dd")&&t.end>=s.value.startOf("month").toFormat("yyyy-MM-dd")))),m=o(!1),M=o(!1),u=o(null),v=o(null),O=o(null),U=P(()=>y.users.find(a=>{var t;return a.id===((t=u.value)==null?void 0:t.user_id)})),V=(()=>{var a,t;return route().params.openAbsence?((a=y.absences)==null?void 0:a.find(e=>e.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((t=y.absencePatches)==null?void 0:t.find(e=>e.id==Number(route().params.openAbsencePatch)))??null:null})();V&&(u.value=V,v.value=V.user_id,m.value=!0);function $(a,t){v.value=a;const e=D.value.filter(i=>i.user_id===a).find(i=>t&&p.fromSQL(i.start)<=t&&t<=p.fromSQL(i.end));O.value=t??null,u.value=e??null,e&&["hasOpenPatch","created"].includes(te(e))?M.value=!0:m.value=!0}function N(){const a=[];for(let t=1;t<=s.value.daysInMonth;t++)a.push(s.value.startOf("month").plus({day:t-1}));return a}const _=o([s.value.toFormat("yyyy-MM")]),A=o(!1),E=Z(()=>{_.value.includes(s.value.toFormat("yyyy-MM"))||W.reload({only:["absences","holidays"],data:{date:s.value.toFormat("yyyy-MM")},onStart:()=>{_.value.push(s.value.toFormat("yyyy-MM")),A.value=!0},onError:()=>_.value=_.value.filter(a=>a!=s.value.toFormat("yyyy-MM")),onFinish:()=>A.value=!1})},500);H(s,E);const B=Y(81);return(a,t)=>(l(),b(X,{title:"Abwesenheiten"},{default:r(()=>[m.value&&v.value?(l(),b(ae,{key:0,absence_types:a.absence_types,users:a.users,selectedAbsence:u.value,selectedDate:O.value,selectedUser:v.value,"onUpdate:selectedUser":t[0]||(t[0]=e=>v.value=e),modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):x("",!0),M.value&&u.value&&U.value?(l(),b(se,{key:1,absence_types:a.absence_types,users:a.users,selectedAbsence:u.value,absenceUser:U.value,modelValue:M.value,"onUpdate:modelValue":t[2]||(t[2]=e=>M.value=e)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):x("",!0),n(K,null,{default:r(()=>[n(j,null,{default:r(()=>[d("div",ne,[d("div",le,[d("div",oe,[n(h,{onClick:t[3]||(t[3]=k(e=>s.value=s.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(g,{icon:"mdi-chevron-double-left"})]),_:1}),n(h,{onClick:t[4]||(t[4]=k(e=>s.value=s.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(g,{icon:"mdi-chevron-left"})]),_:1})]),d("h2",re,[G(C(s.value.toFormat("MMMM yyyy"))+" ",1),A.value?(l(),b(Q,{key:0,indeterminate:""})):x("",!0)]),d("div",ue,[n(h,{onClick:t[5]||(t[5]=k(e=>s.value=s.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(g,{icon:"mdi-chevron-right"})]),_:1}),n(h,{onClick:t[6]||(t[6]=k(e=>s.value=s.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(g,{icon:"mdi-chevron-double-right"})]),_:1})])])])]),_:1}),n(q),n(z,{"fixed-header":"",style:R([{"white-space":"pre"},{maxHeight:T(B)}]),id:"absence-table",items:a.users.map(e=>({...e,name:e.last_name+", "+e.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px",sortable:!1},...N().map(e=>({title:e.weekdayShort+`
`+e.day.toString(),key:e.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":e.toISODate()===T(p).local().toISODate()}}}))]},{item:r(({item:e,columns:i})=>[d("tr",null,[(l(!0),c(w,null,J(i,f=>(l(),c(w,{key:f.key},[f.key==="name"?(l(),c("td",ie,C(e.first_name)+" "+C(e.last_name),1)):f.key==="action"?(l(),c(w,{key:1},[a.can("absence","create",e)?(l(),c("td",de,[n(h,{icon:"mdi-plus",variant:"text",onClick:F=>a.can("absence","create",e)&&$(e.id)},null,8,["onClick"])])):(l(),c("td",ce))],64)):(l(),b(ee,{key:2,onClick:F=>a.can("absence","create",e)&&$(e.id,s.value.startOf("month").plus({day:+(f.key??0)-1})),holidays:a.holidays,absenceTypes:a.absence_types,user:e,date:s.value.startOf("month").plus({day:+(f.key??0)-1}),entries:D.value.filter(F=>F.user_id===e.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{Me as default};
