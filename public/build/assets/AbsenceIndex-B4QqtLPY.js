import{d as z,r as y,D as p,c as N,w as Q,u as q,a as m,o as n,b as i,e as x,f as o,V as G,g as J,h as k,i as u,j as l,k as K,F as v,l as f,m as h,n as M,p as E,q as B,t as V,s as X,v as Y,x as Z,y as ee,z as se}from"./app-C3elVbWO.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DpDPz7Nl.js";import{t as ae,u as ne}from"./utils-DMcLPfZY.js";import{_ as le}from"./AbsenceFilter.vue_vue_type_script_setup_true_lang-DqY0eos2.js";import{_ as oe,g as re}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-C0Y0X9Af.js";import{_ as ue}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-CiNenEsX.js";import{_ as de}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-CKFBfvHH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"d-flex justify-space-between align-center w-100"},ce={class:"d-flex justify-center align-center w-100"},ye={class:"d-flex"},me={class:"d-flex"},pe={key:1,style:{width:"64px"}},ve={key:0,style:{"max-width":"calc(100vw - 28px * 7)","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:"px-sm-4 px-1"},fe={key:0},be={key:1},xe=z({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},date:{},user_absence_filters:{}},setup(L){const A=L,D=route().params.date,t=y(D?p.fromFormat(D,"yyyy-MM"):p.now()),r=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]}),O=N(()=>[].concat(A.absencePatches.filter(e=>e.start<=t.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=t.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(A.absences.filter(e=>e.start<=t.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=t.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(r.selected_users.length==0||r.selected_users.includes(e.user_id))&&(r.selected_absence_types.length==0||!e.absence_type_id||r.selected_absence_types.includes(e.absence_type_id))&&(r.selected_statuses.length==0||r.selected_statuses.includes(e.status)))),g=y(!1),U=y(!1),b=y(null),w=y(null),I=y(null),P=N(()=>A.users.find(a=>{var e;return a.id===((e=b.value)==null?void 0:e.user_id)})),C=(()=>{var a,e;return route().params.openAbsence?((a=A.absences)==null?void 0:a.find(s=>s.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=A.absencePatches)==null?void 0:e.find(s=>s.id==Number(route().params.openAbsencePatch)))??null:null})();C&&(b.value=C,w.value=C.user_id,g.value=!0);function T(a,e){w.value=a;const s=O.value.filter(c=>c.user_id===a).find(c=>e&&p.fromSQL(c.start)<=e&&e<=p.fromSQL(c.end));I.value=e??null,b.value=s??null,s&&["hasOpenPatch","created"].includes(re(s))?U.value=!0:g.value=!0}function R(){const a=[];for(let e=1;e<=t.value.daysInMonth;e++)a.push(t.value.startOf("month").plus({day:e-1}));return a}function j(){const a=[];for(let e=1;e<=7;e++)a.push(t.value.startOf("week").plus({day:e-1}));return a}const _=y([t.value.toFormat("yyyy-MM")]),S=y(!1),H=ae(()=>{_.value.includes(t.value.toFormat("yyyy-MM"))||se.reload({only:["absences","holidays"],data:{date:t.value.toFormat("yyyy-MM"),openAbsence:null,openAbsencePatch:null},onStart:()=>{_.value.push(t.value.toFormat("yyyy-MM")),S.value=!0},onError:()=>_.value=_.value.filter(a=>a!=t.value.toFormat("yyyy-MM")),onFinish:()=>S.value=!1})},500);Q(t,H);const W=ne(81),d=q();return(a,e)=>(n(),m(te,{title:"Abwesenheiten"},{default:i(()=>[g.value&&w.value?(n(),m(ue,{key:0,absence_types:a.absence_types,users:a.users,selectedAbsence:b.value,selectedDate:I.value,selectedUser:w.value,"onUpdate:selectedUser":e[0]||(e[0]=s=>w.value=s),modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),onAbsenceReload:e[2]||(e[2]=s=>_.value=[t.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):x("",!0),U.value&&b.value&&P.value?(n(),m(de,{key:1,absence_types:a.absence_types,users:a.users,selectedAbsence:b.value,absenceUser:P.value,modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=s=>U.value=s),onAbsenceReload:e[4]||(e[4]=s=>_.value=[t.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):x("",!0),o(G,null,{default:i(()=>[o(J,null,{default:i(()=>[k("div",ie,[l(d).mdAndUp.value?(n(),m(le,{key:0,absence_types:a.absence_types,users:a.users,user_absence_filters:a.user_absence_filters,filterForm:l(r),"onUpdate:filterForm":e[5]||(e[5]=s=>K(r)?r.value=s:null)},null,8,["absence_types","users","user_absence_filters","filterForm"])):x("",!0),k("div",ce,[k("div",ye,[l(d).mdAndUp.value?(n(),u(v,{key:0},[o(f,{onClick:e[6]||(e[6]=h(s=>t.value=t.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-double-left"})]),_:1}),o(f,{onClick:e[7]||(e[7]=h(s=>t.value=t.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-left"})]),_:1})],64)):(n(),m(f,{key:1,onClick:e[8]||(e[8]=h(s=>t.value=t.value.minus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-left"})]),_:1}))]),k("h2",{class:"mx-md-4 text-center",style:E({minWidth:l(d).mdAndUp.value?"170px":"110px"})},[l(d).smAndUp.value?(n(),u(v,{key:0},[B(V(t.value.toFormat("MMMM yyyy")),1)],64)):(n(),u(v,{key:1},[B(V(t.value.startOf("week").toFormat("dd.MM.yyyy"))+" - "+V(t.value.endOf("week").toFormat("dd.MM.yyyy")),1)],64)),S.value?(n(),m(X,{key:2,indeterminate:""})):x("",!0)],4),k("div",me,[l(d).mdAndUp.value?(n(),u(v,{key:0},[o(f,{onClick:e[9]||(e[9]=h(s=>t.value=t.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-right"})]),_:1}),o(f,{onClick:e[10]||(e[10]=h(s=>t.value=t.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-double-right"})]),_:1})],64)):(n(),m(f,{key:1,onClick:e[11]||(e[11]=h(s=>t.value=t.value.plus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(M,{icon:"mdi-chevron-right"})]),_:1}))])]),l(d).mdAndUp.value?(n(),u("div",pe)):x("",!0)])]),_:1}),o(Y),o(Z,{"fixed-header":"",style:E([{"white-space":"pre"},{maxHeight:l(W)}]),id:"absence-table",items:a.users.filter(s=>l(r).selected_users.length==0||l(r).selected_users.includes(s.id)).map(s=>({...s,name:l(d).mdAndUp.value?s.last_name+", "+s.first_name:s.first_name.substring(0,1)+"."+s.last_name})).toSorted((s,c)=>s.last_name.localeCompare(c.last_name)),headers:[{title:"Name",key:"name",headerProps:{class:"px-sm-4 px-1"}},...l(d).mdAndUp.value?[{title:"",key:"action",width:"48px",sortable:!1}]:[],...(l(d).mdAndUp.value?R():j()).map(s=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.toString(),sortable:!1,align:"center",width:l(d).mdAndUp.value?"44px":"14%",headerProps:{class:{"bg-blue-darken-2":s.toISODate()===l(p).local().toISODate()}}}))]},{item:i(({item:s,columns:c})=>[k("tr",null,[(n(!0),u(v,null,ee(c,F=>(n(),u(v,{key:F.key},[F.key==="name"?(n(),u("td",ve,V(s.name),1)):F.key==="action"?(n(),u(v,{key:1},[a.can("absence","create",s)?(n(),u("td",fe,[o(f,{icon:"mdi-plus",variant:"text",onClick:$=>a.can("absence","create",s)&&T(s.id)},null,8,["onClick"])])):(n(),u("td",be))],64)):(n(),m(oe,{key:2,onClick:$=>a.can("absence","create",s)&&T(s.id,l(p).fromISO(F.key)),holidays:a.holidays,absenceTypes:a.absence_types,user:s,date:l(p).fromISO(F.key),entries:O.value.filter($=>$.user_id===s.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{xe as default};
