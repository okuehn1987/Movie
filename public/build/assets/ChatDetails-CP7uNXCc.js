import{d as T,at as B,r as C,w as m,au as E,ag as R,aa as D,k as h,b as r,j as g,g as v,e as l,f as n,a as c,F as I,A as L,h as i,U as k,v as b,m as N,p as d,B as $,t as w,am as F,q as x,av as A,a3 as K,D as O}from"./app-DwageWwB.js";import V from"./ChatMessage-vwKBJQXg.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"chat-details"},q={id:"messages",class:"messages"},U=["id"],z={key:1,class:"bg-white"},G={class:"d-flex justify-space-between"},H=T({__name:"ChatDetails",props:{chat:{},reachedMonthlyTokenLimit:{type:Boolean},showChat:{type:Boolean}},setup(M){const f=M,{chat:_}=B(f),a=C(_.value);m(_,e=>a.value=e),m(()=>f.showChat,()=>{f.showChat&&setTimeout(y,200)});const s=E({msg:""});function u(){var e;s.clearErrors(),s.post(route("isa.message"),{preserveScroll:!0}),(e=a.value)==null||e.chat_messages.push({id:-1,created_at:O.local().toISO(),msg:s.msg.replaceAll(`
`,"<br>"),role:"user"}),s.reset()}const p=C("");m(a,()=>{p.value="",R(y)},{immediate:!0,deep:!0}),m(p,y,{immediate:!0});function y(){const e=document.getElementById("messages");e&&e.scrollTo({top:e.scrollHeight,behavior:"instant"})}return a.value&&D("chat."+a.value.id,"ChatMessageDelta",e=>{p.value+=e.msg}),(e,t)=>(r(),h("div",j,[g("div",q,[v(F,{style:{"max-width":"100%"},class:"m-0 px-0 pb-0 pt-2"},{default:l(()=>[a.value&&a.value.chat_messages.length>0?(r(!0),h(I,{key:0},L(a.value.chat_messages.filter(o=>o.role!="annotation"),(o,S)=>(r(),h("div",{key:S.toString(),id:"ChatMessage-"+o.id.toString()},[v(V,{chatMessage:o},null,8,["chatMessage"])],8,U))),128)):n("",!0),i(s).processing?n("",!0):(r(),h("div",z,[e.$page.props.errors.openai?(r(),c(k,{key:0,variant:"tonal",color:"error"},{default:l(()=>[g("div",G,[g("span",null,b(e.$page.props.errors.openai),1),e.$page.props.errors.error_code=="OPENAI_SERVER_ERROR"?(r(),c(N,{key:0,color:"primary",onClick:t[0]||(t[0]=d(o=>i($).post(e.route("chat.retryLastRun",{chat:a.value.id})),["stop"]))},{default:l(()=>[...t[3]||(t[3]=[w(" Erneut senden ",-1)])]),_:1})):n("",!0)])]),_:1})):n("",!0),e.$page.props.errors.msg?(r(),c(k,{key:1,variant:"tonal",color:"error"},{default:l(()=>[w(b(e.$page.props.errors.msg),1)]),_:1})):n("",!0),e.reachedMonthlyTokenLimit?(r(),c(k,{key:2,variant:"tonal",color:"error"},{default:l(()=>[...t[4]||(t[4]=[w(" Dieser Service ist derzeit leider nicht verfÃ¼gbar, bitte wenden Sie sich an den technischen Support ",-1)])]),_:1})):n("",!0)])),i(s).processing||p.value?(r(),c(V,{key:2,chatMessage:{msg:p.value,role:"assistant",id:-1},isLoading:!0,reached_token_limit:null},null,8,["chatMessage"])):n("",!0)]),_:1})]),g("form",{class:"composer mt-2 w-100",onSubmit:d(u,["prevent"])},[v(K,{label:"Geben Sie hier Ihre Frage ein...",modelValue:i(s).msg,"onUpdate:modelValue":t[2]||(t[2]=o=>i(s).msg=o),required:"","auto-grow":"",maxlength:"2000",rows:"1","hide-details":"",autocomplete:"none",disabled:i(s).processing||e.reachedMonthlyTokenLimit,"error-messages":i(s).errors.msg,onKeydown:A(d(u,["ctrl","exact","prevent"]),["enter"]),style:{"user-select":"unset"},title:"Nachricht senden (Strg + Enter)"},{"append-inner":l(()=>[v(x,{style:{opacity:"1"},color:"primary",icon:"mdi-send-variant",class:"pa-6 ps-13 ms-n6",onTouchstart:d(u,["stop","prevent"]),onMousedown:d(u,["stop"]),onClick:t[1]||(t[1]=d(()=>{},["stop"]))})]),_:1},8,["modelValue","disabled","error-messages","onKeydown"])],32)]))}}),X=P(H,[["__scopeId","data-v-0c6c739e"]]);export{X as default};
