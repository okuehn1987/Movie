import{d as Q,r as d,a8 as W,D as n,N as P,a as G,o as g,c as y,w as a,L as O,b as l,u as v,a9 as j,e as h,f as w,s as q,g as D,t as x,aa as Y,j as J,p as E,B as K,l as S,q as F,V as M,h as R,ab as I,y as X}from"./app-D7N-wvAF.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DqvbmMl0.js";import{b as ee}from"./utils-XOkCromH.js";const te={class:"d-flex align-center"},T=3,se=Q({__name:"WorkLogIndex",props:{users:{},date:{},groups:{}},setup(H){const k=H,C=d(k.groups.map(o=>o.id)),f=d(new Set([])),N=[{value:"Monat",key:"month"},{value:"Woche",key:"week"},{value:"Tag",key:"day"}],p=d("month"),r=d([new Date(k.date)]),U=ee();W(()=>[...r.value],(o,t)=>{o[0].getMonth()!==t[0].getMonth()&&O.get(route("workLog.index"),{year:r.value[0].getFullYear(),month:(r.value[0].getMonth()+1).toString().padStart(2,"0")},{preserveState:!0})},{deep:!0});const _=d(""),V=d(!1),$=n.fromJSDate(r.value[0]).daysInMonth??n.now().daysInMonth,z=P(()=>{let o=k.users;o=o.filter(e=>C.value.find(s=>s==e.group_id)),o=o.filter(e=>(e.first_name+e.last_name).toLowerCase().includes(_.value.toLowerCase()));const t=o.flatMap(e=>{const s=[];for(const u of e.work_logs){const m=n.fromSQL(u.start).startOf("day").toISO();m&&!s.includes(m)&&s.push(m)}return s.map(u=>({start:new Date(u),end:new Date(u),title:e.first_name+" "+e.last_name,id:e.id}))}),i=[];for(let e=1;e<=$;e++){const s=t.filter(m=>n.fromJSDate(m.start).day===e);s.length>T&&i.push({start:s[0].start,end:s[0].end,title:"",id:-1});let u=0;for(const m of s)if(u<T||f.value.has(e))i.push(m),u++;else break}return i});function A(o){const t=n.fromJSDate(o.start).day;f.value.has(t)?f.value.delete(t):f.value.add(t)}const b=d(!1),c=d(null);function B(o){const t=k.users.find(i=>i.id===o.id);t&&(c.value={...o,...t,work_logs:t.work_logs.filter(i=>n.fromSQL(i.start).day===n.fromJSDate(o.start).day)},b.value=!0)}function L(o){const t=p.value==="month"?{month:1}:p.value==="week"?{week:1}:{day:1};o?r.value[0]=n.fromJSDate(r.value[0]).plus(t).toJSDate():r.value[0]=n.fromJSDate(r.value[0]).minus(t).toJSDate()}return(o,t)=>{const i=G("v-calendar");return g(),y(Z,{title:"Arbeitszeiten"},{default:a(()=>[l(M,null,{default:a(()=>[l(i,{height:"600",class:"bg-white",events:z.value,modelValue:r.value,"onUpdate:modelValue":t[8]||(t[8]=e=>r.value=e),"view-mode":p.value,weekdays:[1,2,3,4,5,6,0],"hide-week-number":"","interval-format":e=>v(n).fromJSDate(e.start).toFormat("HH:mm")+" Uhr"},{header:a(()=>[l(j,{color:"primary"},{prepend:a(()=>[l(h,{onClick:t[0]||(t[0]=()=>L(!1))},{default:a(()=>[l(w,{size:"large",icon:"mdi-chevron-left"})]),_:1}),l(h,{onClick:t[1]||(t[1]=()=>L(!0))},{default:a(()=>[l(w,{size:"large",icon:"mdi-chevron-right"})]),_:1})]),title:a(()=>[q("div",te,[D(x(r.value[0].toLocaleDateString("de-DE",{year:"numeric",month:"long"}))+" ",1),v(U)?(g(),y(Y,{key:0,indeterminate:"",class:"ms-4"})):J("",!0)])]),default:a(()=>[l(E,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),items:N,"item-value":"key","item-title":"value",class:"me-2","max-width":"150","hide-details":"",label:"Ansicht"},null,8,["modelValue"]),l(K,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value=e),"hide-details":"",label:"Suche","max-width":"300",class:"me-2"},null,8,["modelValue"]),l(h,{onClick:t[4]||(t[4]=S(e=>V.value=!0,["stop"])),class:"me-2"},{default:a(()=>[l(w,{icon:"mdi-filter"})]),_:1}),l(F,{"max-width":"1000",modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=e=>V.value=e)},{default:a(()=>[l(M,{title:"Filteroptionen"},{append:a(()=>[l(h,{icon:"mdi-close",variant:"text",onClick:t[5]||(t[5]=S(e=>V.value=!1,["stop"]))})]),default:a(()=>[l(R,null,{default:a(()=>[l(E,{label:"Gruppe",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=e=>C.value=e),multiple:"",items:o.groups,"item-value":"id","item-title":"name"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),event:a(({event:e})=>[e.id==-1?(g(),y(I,{key:0,class:"w-100 mb-2","prepend-icon":f.value.has(v(n).fromJSDate(e.start).day)?"mdi-chevron-up":"mdi-chevron-down",onClick:S(s=>A(e),["stop"])},{default:a(()=>[D(x(f.value.has(v(n).fromJSDate(e.start).day)?"Weniger Anzeigen":"Alle Anzeigen"),1)]),_:2},1032,["prepend-icon","onClick"])):(g(),y(I,{key:1,class:"mb-1 me-1","prepend-icon":"mdi-circle-medium",onClick:S(s=>B(e),["stop"])},{default:a(()=>[D(x(e.title),1)]),_:2},1032,["onClick"]))]),_:1},8,["events","modelValue","view-mode","interval-format"]),c.value?(g(),y(F,{key:0,"max-width":"1000",modelValue:b.value,"onUpdate:modelValue":t[9]||(t[9]=e=>b.value=e)},{default:a(({isActive:e})=>[l(M,{title:c.value.title+" "+c.value.start.toLocaleDateString()},{append:a(()=>[l(h,{icon:"",variant:"text",onClick:s=>e.value=!1},{default:a(()=>[l(w,null,{default:a(()=>t[10]||(t[10]=[D("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:a(()=>[l(X,{headers:[{title:"Start",key:"start",sortable:!1},{title:"Ende",key:"end",sortable:!1},{title:"Homeoffice",key:"is_home_office",sortable:!1}],items:c.value.work_logs.map(s=>({start:v(n).fromSQL(s.start).toFormat("dd.MM.yyyy HH:mm"),end:s.end?v(n).fromSQL(s.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",is_home_office:s.is_home_office?"Ja":"Nein"}))},null,8,["items"])]),_:2},1032,["title"])]),_:1},8,["modelValue"])):J("",!0)]),_:1})]),_:1})}}});export{se as default};
