import{d as L,r as o,D as m,c as $,w as H,o as l,a as v,b as r,e as C,f as n,V as j,g as u,h as f,i as _,j as k,k as G,t as F,l as Q,m as q,n as z,p as J,u as T,q as d,s as K,F as w,v as R,G as W}from"./app-BhHYUD1N.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-C3KRW-rU.js";import{u as Y,t as Z}from"./utils-CDazrL7u.js";import{_ as ee,g as I}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-NAT8Vocb.js";import{_ as te}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-DwGbl104.js";import{_ as ae}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-TFMUkfQY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"d-flex flex-wrap justify-center align-center"},ne={class:"d-flex flex-wrap align-center"},le={class:"d-flex"},oe={class:"mx-4 text-center",style:{"min-width":"170px"}},re={class:"d-flex"},ie={key:0},ue={key:0},de={key:1},he=L({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{}},setup(E){const g=E,S=route().params.date,a=o(S?m.fromFormat(S,"yyyy-MM"):m.now()),A=$(()=>[].concat(g.absencePatches.filter(t=>t.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&t.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(g.absences.filter(t=>t.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&t.end>=a.value.startOf("month").toFormat("yyyy-MM-dd")))),p=o(!1),b=o(!1),c=o(null),h=o(null),D=o(null),O=$(()=>g.users.find(s=>{var t;return s.id===((t=c.value)==null?void 0:t.user_id)}));function U(s,t){h.value=s;const e=A.value.filter(i=>i.user_id===s).find(i=>t&&m.fromSQL(i.start)<=t&&t<=m.fromSQL(i.end));D.value=t??null,c.value=e??null,console.log(e&&I(e)),e&&["hasOpenPatch","created"].includes(I(e))?b.value=!0:p.value=!0}function P(){const s=[];for(let t=1;t<=a.value.daysInMonth;t++)s.push(a.value.startOf("month").plus({day:t-1}));return s}const M=o([a.value.toFormat("yyyy-MM")]),V=o(!1),B=Z(()=>{M.value.includes(a.value.toFormat("yyyy-MM"))||W.reload({only:["absences","holidays"],data:{date:a.value.toFormat("yyyy-MM")},onStart:()=>{M.value.push(a.value.toFormat("yyyy-MM")),V.value=!0},onError:()=>M.value=M.value.filter(s=>s!=a.value.toFormat("yyyy-MM")),onFinish:()=>V.value=!1})},500);H(a,B);const N=Y(81);return(s,t)=>(l(),v(X,{title:"Abwesenheiten"},{default:r(()=>[p.value&&h.value?(l(),v(te,{key:0,absence_types:s.absence_types,users:s.users,selectedAbsence:c.value,selectedDate:D.value,selectedUser:h.value,"onUpdate:selectedUser":t[0]||(t[0]=e=>h.value=e),modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):C("",!0),b.value&&c.value&&O.value?(l(),v(ae,{key:1,absence_types:s.absence_types,users:s.users,selectedAbsence:c.value,absenceUser:O.value,modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=e=>b.value=e)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):C("",!0),n(R,null,{default:r(()=>[n(j,null,{default:r(()=>[u("div",se,[u("div",ne,[u("div",le,[n(f,{onClick:t[3]||(t[3]=_(e=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-double-left"})]),_:1}),n(f,{onClick:t[4]||(t[4]=_(e=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",oe,[G(F(a.value.toFormat("MMMM yyyy"))+" ",1),V.value?(l(),v(Q,{key:0,indeterminate:""})):C("",!0)]),u("div",re,[n(f,{onClick:t[5]||(t[5]=_(e=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-right"})]),_:1}),n(f,{onClick:t[6]||(t[6]=_(e=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:r(()=>[n(k,{icon:"mdi-chevron-double-right"})]),_:1})])])])]),_:1}),n(q),n(z,{"fixed-header":"",style:J([{"white-space":"pre"},{maxHeight:T(N)}]),id:"absence-table",items:s.users.map(e=>({...e,name:e.last_name+", "+e.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px",sortable:!1},...P().map(e=>({title:e.weekdayShort+`
`+e.day.toString(),key:e.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":e.toISODate()===T(m).local().toISODate()}}}))]},{item:r(({item:e,columns:i})=>[u("tr",null,[(l(!0),d(w,null,K(i,y=>(l(),d(w,{key:y.key},[y.key==="name"?(l(),d("td",ie,F(e.first_name)+" "+F(e.last_name),1)):y.key==="action"?(l(),d(w,{key:1},[s.can("absence","create",e)?(l(),d("td",ue,[n(f,{icon:"mdi-plus",variant:"text",onClick:x=>s.can("absence","create",e)&&U(e.id)},null,8,["onClick"])])):(l(),d("td",de))],64)):(l(),v(ee,{key:2,onClick:x=>s.can("absence","create",e)&&U(e.id,a.value.startOf("month").plus({day:+(y.key??0)-1})),holidays:s.holidays,absenceTypes:s.absence_types,user:e,date:a.value.startOf("month").plus({day:+(y.key??0)-1}),entries:A.value.filter(x=>x.user_id===e.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{he as default};
