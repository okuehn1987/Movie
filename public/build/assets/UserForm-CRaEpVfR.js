import{d as I,T as L,R as W,r as A,a as P,o as f,c as k,b as u,V as q,e as l,am as N,f as C,m as v,h as O,t as K,an as J,B as j,C as R,F as B,ao as G,W as Y,y as Z,k as c,l as $,ap as Q,aq as S,i as y,n as U,p as t,I as m,u as s,v as b,q as _,A as X,Y as h,ar as x,D}from"./app-C48xMY2B.js";import{c as ee,g as re}from"./utils-Cd5cUjxN.js";import{_ as w}from"./PermissionSelector.vue_vue_type_script_setup_true_lang-2l6U-bhq.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le=I({__name:"UserForm",props:{user:{},supervisors:{},operating_sites:{},groups:{},mode:{},countries:{},permissions:{}},emits:["success"],setup(F,{emit:M}){var H;const i=F,T=M,e=L({first_name:"",last_name:"",email:"",date_of_birth:null,city:"",zip:"",street:"",house_number:"",address_suffix:"",country:"",federal_state:"",phone_number:"",staff_number:0,password:"",group_id:null,operating_site_id:null,supervisor_id:null,is_supervisor:!1,userWorkingHours:0,userWorkingHoursSince:new Date,userWorkingWeek:[],userWorkingWeekSince:new Date,organizationUser:{absence_permission:null,absenceType_permission:null,group_permission:null,operatingSite_permission:null,organization_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,specialWorkingHoursFactor_permission:null,workLogPatch_permission:null},groupUser:{absence_permission:null,group_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null},operatingSiteUser:{absence_permission:null,operatingSite_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null}});if(i.user){e.first_name=i.user.first_name,e.last_name=i.user.last_name,e.email=i.user.email,e.date_of_birth=i.user.date_of_birth,e.city=i.user.city??"",e.zip=i.user.zip??"",e.street=i.user.street??"",e.house_number=i.user.house_number??"",e.address_suffix=i.user.address_suffix??"",e.country=i.user.country,e.federal_state=i.user.federal_state,e.phone_number=i.user.phone_number??"",e.staff_number=i.user.staff_number,e.password=i.user.password,e.group_id=i.user.group_id,e.operating_site_id=i.user.operating_site_id,e.supervisor_id=i.user.supervisor_id,e.userWorkingHours=((H=i.user.currentWorkingHours)==null?void 0:H.weekly_working_hours)??0,e.userWorkingHoursSince=new Date(i.user.currentWorkingHours.active_since);for(const d of W.weekdays("long",{locale:"en"}).map(r=>r.toLowerCase()))i.user.userWorkingWeek[d]&&e.userWorkingWeek.push(d);e.userWorkingWeekSince=new Date(i.user.userWorkingWeek.active_since),e.organizationUser=i.user.organization_user,e.groupUser=i.user.group_user??e.groupUser,e.operatingSiteUser=i.user.operating_site_user}function z(){const d=e.transform(r=>({...r,userWorkingHoursSince:D.fromJSDate(e.userWorkingHoursSince).toFormat("yyyy-MM-dd"),userWorkingWeekSince:D.fromJSDate(e.userWorkingWeekSince).toFormat("yyyy-MM-dd"),date_of_birth:r.date_of_birth?new Date(r.date_of_birth).toISOString():null,organizationUser:Object.fromEntries(Object.entries(r.organizationUser).filter(([p])=>i.permissions.find(o=>o.name==p))),groupUser:Object.fromEntries(Object.entries(r.groupUser).filter(([p])=>i.permissions.find(o=>o.name==p))),operatingSiteUser:Object.fromEntries(Object.entries(r.operatingSiteUser).filter(([p])=>i.permissions.find(o=>o.name==p)))}));i.mode=="edit"&&i.user?d.patch(route("user.update",{user:i.user.id}),{onError:r=>console.log(r)}):d.post(route("user.store"),{onSuccess:()=>{e.reset(),T("success")},onError:r=>console.log(r)})}const V=A(1),n=A([{isValidated:!1,name:"Allgemeine Angaben",fields:{first_name:[()=>!!e.first_name],last_name:[()=>!!e.last_name],email:[()=>!!e.email],date_of_birth:[()=>!0],password:[()=>i.mode!=="create"||!!e.password],userWorkingHours:[()=>!!e.userWorkingHours],userWorkingHoursSince:[()=>!!e.userWorkingHoursSince],userWorkingWeek:[()=>!!e.userWorkingWeek],userWorkingWeekSince:[()=>!!e.userWorkingWeekSince]}},{isValidated:!1,name:"Adresse",fields:{street:[()=>!0],house_number:[()=>!0],zip:[()=>!0],city:[()=>!0],federal_state:[()=>!!e.federal_state],country:[()=>!!e.country]}},{isValidated:!1,name:"Berechtigungen",fields:{operating_site_id:[()=>!!e.operating_site_id]}}]);return(d,r)=>{const p=P("v-date-input");return f(),k(q,null,{default:u(()=>[l(x,{modelValue:V.value,"onUpdate:modelValue":r[22]||(r[22]=o=>V.value=o)},{actions:u(({next:o,prev:a})=>[l(N,{disabled:!1},{prev:u(()=>[l(C,{color:"primary",variant:"elevated",onClick:v(a,["stop"])},{default:u(()=>r[28]||(r[28]=[O("Zurück")])),_:2},1032,["onClick"])]),next:u(()=>[l(C,{color:"secondary",variant:"elevated",onClick:v(()=>{const g=n.value[V.value-1];g&&Object.values(g.fields).flat().some(E=>!E())||(g&&(g.isValidated=!0),V.value==3?z():o())},["stop"])},{default:u(()=>[O(K(V.value==3?"Speichern":"Weiter"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:u(()=>[l(J,null,{default:u(()=>[(f(!0),j(B,null,R(n.value,(o,a)=>(f(),j(B,{key:a},[l(G,Y({ref_for:!0},{editable:d.mode=="edit"||o.isValidated,rules:o.isValidated?Object.values(o.fields).flat():[],step:a,title:o.name,value:a+1}),null,16),a<n.value.length?(f(),k(Z,{key:a})):c("",!0)],64))),128))]),_:1}),l($,{onSubmit:v(z,["prevent"])},{default:u(()=>[l(Q,null,{default:u(()=>[l(S,{value:1},{default:u(()=>[l(y,null,{default:u(()=>[l(U,null,{default:u(()=>[l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).first_name,"onUpdate:modelValue":r[0]||(r[0]=o=>s(e).first_name=o),label:"Vorname","error-messages":s(e).errors.first_name,rules:n.value[0].fields.first_name},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).last_name,"onUpdate:modelValue":r[1]||(r[1]=o=>s(e).last_name=o),label:"Nachname","error-messages":s(e).errors.last_name,rules:n.value[0].fields.last_name},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).email,"onUpdate:modelValue":r[2]||(r[2]=o=>s(e).email=o),label:"Email","error-messages":s(e).errors.email,rules:n.value[0].fields.email},null,8,["modelValue","error-messages","rules"])]),_:1}),d.mode=="create"?(f(),k(t,{key:0,cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).password,"onUpdate:modelValue":r[3]||(r[3]=o=>s(e).password=o),label:"Passwort","error-messages":s(e).errors.password,rules:n.value[0].fields.password},null,8,["modelValue","error-messages","rules"])]),_:1})):c("",!0),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{type:"date",modelValue:s(e).date_of_birth,"onUpdate:modelValue":r[4]||(r[4]=o=>s(e).date_of_birth=o),label:"Geburtsdatum",required:"","error-messages":s(e).errors.date_of_birth,rules:n.value[0].fields.date_of_birth},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12"},{default:u(()=>r[23]||(r[23]=[b("h4",null,"Arbeitszeiten",-1)])),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).userWorkingHours,"onUpdate:modelValue":r[5]||(r[5]=o=>s(e).userWorkingHours=o),label:"Trage die wöchentliche Arbeitszeit des Mitarbeiters ein","error-messages":s(e).errors.userWorkingHours,rules:n.value[0].fields.userWorkingHours},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(p,{"prepend-icon":"",modelValue:s(e).userWorkingHoursSince,"onUpdate:modelValue":r[6]||(r[6]=o=>s(e).userWorkingHoursSince=o),label:"seit","error-messages":s(e).errors.userWorkingHoursSince,rules:n.value[0].fields.userWorkingHoursSince},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{modelValue:s(e).userWorkingWeek,"onUpdate:modelValue":r[7]||(r[7]=o=>s(e).userWorkingWeek=o),multiple:"",items:s(W).weekdays().map((o,a)=>{var g;return{title:o,value:(g=s(W).weekdays("long",{locale:"en"})[a])==null?void 0:g.toLowerCase()}}),label:"Wähle die Arbeitstage des Mitarbeiters aus","error-messages":s(e).errors.userWorkingWeek,rules:n.value[0].fields.userWorkingWeek},null,8,["modelValue","items","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(p,{"prepend-icon":"",modelValue:s(e).userWorkingWeekSince,"onUpdate:modelValue":r[8]||(r[8]=o=>s(e).userWorkingWeekSince=o),label:"seit","error-messages":s(e).errors.userWorkingWeekSince,rules:n.value[0].fields.userWorkingWeekSince},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,{value:2},{default:u(()=>[l(y,null,{default:u(()=>[l(U,null,{default:u(()=>[l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).street,"onUpdate:modelValue":r[9]||(r[9]=o=>s(e).street=o),label:"Straße","error-messages":s(e).errors.street,rules:n.value[1].fields.street},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).house_number,"onUpdate:modelValue":r[10]||(r[10]=o=>s(e).house_number=o),label:"Hausnummer","error-messages":s(e).errors.house_number,rules:n.value[1].fields.house_number},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).zip,"onUpdate:modelValue":r[11]||(r[11]=o=>s(e).zip=o),label:"Postleitzahl","error-messages":s(e).errors.zip,rules:n.value[1].fields.zip},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(m,{modelValue:s(e).city,"onUpdate:modelValue":r[12]||(r[12]=o=>s(e).city=o),label:"Ort","error-messages":s(e).errors.city,rules:n.value[1].fields.city},null,8,["modelValue","error-messages","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{label:"Land",required:"",items:d.countries,"error-messages":s(e).errors.country,modelValue:s(e).country,"onUpdate:modelValue":r[13]||(r[13]=o=>s(e).country=o),rules:n.value[1].fields.country},null,8,["items","error-messages","modelValue","rules"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{label:"Bundesland",items:s(ee)(s(e).country,d.countries),disabled:!s(e).country,required:"","error-messages":s(e).errors.federal_state,modelValue:s(e).federal_state,"onUpdate:modelValue":r[14]||(r[14]=o=>s(e).federal_state=o),rules:n.value[1].fields.federal_state},null,8,["items","disabled","error-messages","modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),l(S,{value:3},{default:u(()=>[l(y,{style:X(d.mode=="create"?{maxHeight:s(re)(72+24*2+52)}:{}),class:"overflow-auto"},{default:u(()=>[l(U,null,{default:u(()=>{var o;return[l(t,{cols:"12"},{default:u(()=>r[24]||(r[24]=[b("h4",null,"Organisation",-1)])),_:1}),l(w,{modelValue:s(e).organizationUser,"onUpdate:modelValue":r[15]||(r[15]=a=>s(e).organizationUser=a),objKey:"organizationUser",permissions:d.permissions,errors:s(e).errors,label:"Organisationsrechte"},null,8,["modelValue","permissions","errors"]),l(t,{cols:"12"},{default:u(()=>r[25]||(r[25]=[b("h4",null,"Betriebsstätte",-1)])),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{modelValue:s(e).operating_site_id,"onUpdate:modelValue":r[16]||(r[16]=a=>s(e).operating_site_id=a),items:d.operating_sites.map(a=>({title:a.name,value:a.id})),label:"Wähle die Betriebsstätte des Mitarbeiters aus.","error-messages":s(e).errors.operating_site_id,rules:n.value[2].fields.operating_site_id},null,8,["modelValue","items","error-messages","rules"])]),_:1}),l(w,{modelValue:s(e).operatingSiteUser,"onUpdate:modelValue":r[17]||(r[17]=a=>s(e).operatingSiteUser=a),objKey:"operatingSiteUser",permissions:d.permissions,errors:s(e).errors,label:"Betriebstättenrechte"},null,8,["modelValue","permissions","errors"]),l(t,{cols:"12"},{default:u(()=>r[26]||(r[26]=[b("h4",null,"Abteilung",-1)])),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{modelValue:s(e).group_id,"onUpdate:modelValue":r[18]||(r[18]=a=>s(e).group_id=a),items:d.groups.map(a=>({title:a.name,value:a.id})),label:"Wähle eine Abteilung aus, zu die der Mitarbeiter gehören soll.","error-messages":s(e).errors.group_id},null,8,["modelValue","items","error-messages"])]),_:1}),(o=d.user)!=null&&o.group_id?(f(),k(w,{key:0,modelValue:s(e).groupUser,"onUpdate:modelValue":r[19]||(r[19]=a=>s(e).groupUser=a),objKey:"groupUser",permissions:d.permissions,errors:s(e).errors,label:"Abteilungsrechte"},null,8,["modelValue","permissions","errors"])):c("",!0),l(t,{cols:"12"},{default:u(()=>r[27]||(r[27]=[b("h4",null,"Vorgesetzter",-1)])),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(_,{modelValue:s(e).supervisor_id,"onUpdate:modelValue":r[20]||(r[20]=a=>s(e).supervisor_id=a),items:d.supervisors.map(a=>({title:a.first_name+" "+a.last_name,value:a.id})),label:"Wähle einen Vorgesetzten, falls vorhanden","error-messages":s(e).errors.supervisor_id},null,8,["modelValue","items","error-messages"])]),_:1}),l(t,{cols:"12",md:"6"},{default:u(()=>[l(h,{modelValue:s(e).is_supervisor,"onUpdate:modelValue":r[21]||(r[21]=a=>s(e).is_supervisor=a),label:"Ist ein Vorgesetzter"},null,8,["modelValue"])]),_:1})]}),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),te=se(le,[["__scopeId","data-v-036c6771"]]);export{te as default};
