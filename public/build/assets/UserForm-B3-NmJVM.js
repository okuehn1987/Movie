import{d as I,T as L,R as k,r as H,a as P,o as V,c as W,b as u,V as q,e as o,am as N,f as A,m as v,h as C,t as K,an as J,B as O,C as R,F as j,ao as G,W as Y,y as Z,k as B,l as $,ap as Q,aq as c,i as S,n as y,p as a,I as d,u as s,v as b,q as f,A as X,Y as x,ar as h,D}from"./app-Dl5H85QD.js";import{c as ee,g as re}from"./utils-CMhyecrx.js";import{_ as U}from"./PermissionSelector.vue_vue_type_script_setup_true_lang-Bw_BQw0S.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le=I({__name:"UserForm",props:{user:{},supervisors:{},operating_sites:{},groups:{},mode:{},countries:{},permissions:{}},emits:["success"],setup(F,{emit:M}){var z;const i=F,T=M,e=L({first_name:"",last_name:"",email:"",date_of_birth:null,city:"",zip:"",street:"",house_number:"",address_suffix:"",country:"",federal_state:"",phone_number:"",staff_number:0,password:"",group_id:null,operating_site_id:null,supervisor_id:null,is_supervisor:!1,userWorkingHours:0,userWorkingHoursSince:new Date,userWorkingWeek:[],userWorkingWeekSince:new Date,organizationUser:{absence_permission:null,absenceType_permission:null,group_permission:null,operatingSite_permission:null,organization_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,specialWorkingHoursFactor_permission:null,workLogPatch_permission:null},groupUser:{absence_permission:null,group_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null},operatingSiteUser:{absence_permission:null,operatingSite_permission:null,timeAccount_permission:null,timeAccountSetting_permission:null,timeAccountTransaction_permission:null,user_permission:null,workLogPatch_permission:null}});if(i.user){e.first_name=i.user.first_name,e.last_name=i.user.last_name,e.email=i.user.email,e.date_of_birth=i.user.date_of_birth,e.city=i.user.city??"",e.zip=i.user.zip??"",e.street=i.user.street??"",e.house_number=i.user.house_number??"",e.address_suffix=i.user.address_suffix??"",e.country=i.user.country,e.federal_state=i.user.federal_state,e.phone_number=i.user.phone_number??"",e.staff_number=i.user.staff_number,e.password=i.user.password,e.group_id=i.user.group_id,e.operating_site_id=i.user.operating_site_id,e.supervisor_id=i.user.supervisor_id,e.userWorkingHours=((z=i.user.currentWorkingHours)==null?void 0:z.weekly_working_hours)??0,e.userWorkingHoursSince=new Date(i.user.currentWorkingHours.active_since);for(const n of k.weekdays("long",{locale:"en"}).map(r=>r.toLowerCase()))i.user.userWorkingWeek[n]&&e.userWorkingWeek.push(n);e.userWorkingWeekSince=new Date(i.user.userWorkingWeek.active_since),e.organizationUser=i.user.organization_user,e.groupUser=i.user.group_user,e.operatingSiteUser=i.user.operating_site_user}function w(){const n=e.transform(r=>({...r,userWorkingHoursSince:D.fromJSDate(e.userWorkingHoursSince).toFormat("yyyy-MM-dd"),userWorkingWeekSince:D.fromJSDate(e.userWorkingWeekSince).toFormat("yyyy-MM-dd"),date_of_birth:r.date_of_birth?new Date(r.date_of_birth).toISOString():null,organizationUser:Object.fromEntries(Object.entries(r.organizationUser).filter(([p])=>i.permissions.find(l=>l.name==p))),groupUser:Object.fromEntries(Object.entries(r.groupUser).filter(([p])=>i.permissions.find(l=>l.name==p))),operatingSiteUser:Object.fromEntries(Object.entries(r.operatingSiteUser).filter(([p])=>i.permissions.find(l=>l.name==p)))}));i.mode=="edit"&&i.user?n.patch(route("user.update",{user:i.user.id}),{onError:r=>console.log(r)}):n.post(route("user.store"),{onSuccess:()=>{e.reset(),T("success")},onError:r=>console.log(r)})}const _=H(1),t=H([{isValidated:!1,name:"Allgemeine Angaben",fields:{first_name:[()=>!!e.first_name],last_name:[()=>!!e.last_name],email:[()=>!!e.email],date_of_birth:[()=>!0],password:[()=>i.mode!=="create"||!!e.password],userWorkingHours:[()=>!!e.userWorkingHours],userWorkingHoursSince:[()=>!!e.userWorkingHoursSince],userWorkingWeek:[()=>!!e.userWorkingWeek],userWorkingWeekSince:[()=>!!e.userWorkingWeekSince]}},{isValidated:!1,name:"Adresse",fields:{street:[()=>!0],house_number:[()=>!0],zip:[()=>!0],city:[()=>!0],federal_state:[()=>!!e.federal_state],country:[()=>!!e.country]}},{isValidated:!1,name:"Berechtigungen",fields:{operating_site_id:[()=>!!e.operating_site_id],group_id:[()=>!!e.group_id]}}]);return(n,r)=>{const p=P("v-date-input");return V(),W(q,null,{default:u(()=>[o(h,{modelValue:_.value,"onUpdate:modelValue":r[22]||(r[22]=l=>_.value=l)},{actions:u(({next:l,prev:m})=>[o(N,{disabled:!1},{prev:u(()=>[o(A,{color:"primary",variant:"elevated",onClick:v(m,["stop"])},{default:u(()=>r[28]||(r[28]=[C("Zurück")])),_:2},1032,["onClick"])]),next:u(()=>[o(A,{color:"secondary",variant:"elevated",onClick:v(()=>{const g=t.value[_.value-1];g&&Object.values(g.fields).flat().some(E=>!E())||(g&&(g.isValidated=!0),_.value==3?w():l())},["stop"])},{default:u(()=>[C(K(_.value==3?"Speichern":"Weiter"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:u(()=>[o(J,null,{default:u(()=>[(V(!0),O(j,null,R(t.value,(l,m)=>(V(),O(j,{key:m},[o(G,Y({ref_for:!0},{editable:n.mode=="edit"&&l.isValidated,rules:l.isValidated?Object.values(l.fields).flat():[],step:m,title:l.name,value:m+1}),null,16),m<t.value.length?(V(),W(Z,{key:m})):B("",!0)],64))),128))]),_:1}),o($,{onSubmit:v(w,["prevent"])},{default:u(()=>[o(Q,null,{default:u(()=>[o(c,{value:1},{default:u(()=>[o(S,null,{default:u(()=>[o(y,null,{default:u(()=>[o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).first_name,"onUpdate:modelValue":r[0]||(r[0]=l=>s(e).first_name=l),label:"Vorname","error-messages":s(e).errors.first_name,rules:t.value[0].fields.first_name},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).last_name,"onUpdate:modelValue":r[1]||(r[1]=l=>s(e).last_name=l),label:"Nachname","error-messages":s(e).errors.last_name,rules:t.value[0].fields.last_name},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).email,"onUpdate:modelValue":r[2]||(r[2]=l=>s(e).email=l),label:"Email","error-messages":s(e).errors.email,rules:t.value[0].fields.email},null,8,["modelValue","error-messages","rules"])]),_:1}),n.mode=="create"?(V(),W(a,{key:0,cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).password,"onUpdate:modelValue":r[3]||(r[3]=l=>s(e).password=l),label:"Passwort","error-messages":s(e).errors.password,rules:t.value[0].fields.password},null,8,["modelValue","error-messages","rules"])]),_:1})):B("",!0),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{type:"date",modelValue:s(e).date_of_birth,"onUpdate:modelValue":r[4]||(r[4]=l=>s(e).date_of_birth=l),label:"Geburtsdatum",required:"","error-messages":s(e).errors.date_of_birth,rules:t.value[0].fields.date_of_birth},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12"},{default:u(()=>r[23]||(r[23]=[b("h4",null,"Arbeitszeiten",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).userWorkingHours,"onUpdate:modelValue":r[5]||(r[5]=l=>s(e).userWorkingHours=l),label:"Trage die wöchentliche Arbeitszeit des Mitarbeiters ein","error-messages":s(e).errors.userWorkingHours,rules:t.value[0].fields.userWorkingHours},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(p,{"prepend-icon":"",modelValue:s(e).userWorkingHoursSince,"onUpdate:modelValue":r[6]||(r[6]=l=>s(e).userWorkingHoursSince=l),label:"seit","error-messages":s(e).errors.userWorkingHoursSince,rules:t.value[0].fields.userWorkingHoursSince},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:s(e).userWorkingWeek,"onUpdate:modelValue":r[7]||(r[7]=l=>s(e).userWorkingWeek=l),multiple:"",items:s(k).weekdays().map((l,m)=>{var g;return{title:l,value:(g=s(k).weekdays("long",{locale:"en"})[m])==null?void 0:g.toLowerCase()}}),label:"Wähle die Arbeitstage des Mitarbeiters aus","error-messages":s(e).errors.userWorkingWeek,rules:t.value[0].fields.userWorkingWeek},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(p,{"prepend-icon":"",modelValue:s(e).userWorkingWeekSince,"onUpdate:modelValue":r[8]||(r[8]=l=>s(e).userWorkingWeekSince=l),label:"seit","error-messages":s(e).errors.userWorkingWeekSince,rules:t.value[0].fields.userWorkingWeekSince},null,8,["modelValue","error-messages","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),o(c,{value:2},{default:u(()=>[o(S,null,{default:u(()=>[o(y,null,{default:u(()=>[o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).street,"onUpdate:modelValue":r[9]||(r[9]=l=>s(e).street=l),label:"Straße","error-messages":s(e).errors.street,rules:t.value[1].fields.street},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).house_number,"onUpdate:modelValue":r[10]||(r[10]=l=>s(e).house_number=l),label:"Hausnummer","error-messages":s(e).errors.house_number,rules:t.value[1].fields.house_number},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).zip,"onUpdate:modelValue":r[11]||(r[11]=l=>s(e).zip=l),label:"Postleitzahl","error-messages":s(e).errors.zip,rules:t.value[1].fields.zip},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(d,{modelValue:s(e).city,"onUpdate:modelValue":r[12]||(r[12]=l=>s(e).city=l),label:"Ort","error-messages":s(e).errors.city,rules:t.value[1].fields.city},null,8,["modelValue","error-messages","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{label:"Land",required:"",items:n.countries,"error-messages":s(e).errors.country,modelValue:s(e).country,"onUpdate:modelValue":r[13]||(r[13]=l=>s(e).country=l),rules:t.value[1].fields.country},null,8,["items","error-messages","modelValue","rules"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{label:"Bundesland",items:s(ee)(s(e).country,n.countries),disabled:!s(e).country,required:"","error-messages":s(e).errors.federal_state,modelValue:s(e).federal_state,"onUpdate:modelValue":r[14]||(r[14]=l=>s(e).federal_state=l),rules:t.value[1].fields.federal_state},null,8,["items","disabled","error-messages","modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),o(c,{value:3},{default:u(()=>[o(S,{style:X(n.mode=="create"?{maxHeight:s(re)(72+24*2+52)}:{}),class:"overflow-auto"},{default:u(()=>[o(y,null,{default:u(()=>[o(a,{cols:"12"},{default:u(()=>r[24]||(r[24]=[b("h4",null,"Organisation",-1)])),_:1}),o(U,{modelValue:s(e).organizationUser,"onUpdate:modelValue":r[15]||(r[15]=l=>s(e).organizationUser=l),objKey:"organizationUser",permissions:n.permissions,errors:s(e).errors,label:"Organisationsrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[25]||(r[25]=[b("h4",null,"Betriebsstätte",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:s(e).operating_site_id,"onUpdate:modelValue":r[16]||(r[16]=l=>s(e).operating_site_id=l),items:n.operating_sites.map(l=>({title:l.name,value:l.id})),label:"Wähle die Betriebsstätte des Mitarbeiters aus.","error-messages":s(e).errors.operating_site_id,rules:t.value[2].fields.operating_site_id},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(U,{modelValue:s(e).operatingSiteUser,"onUpdate:modelValue":r[17]||(r[17]=l=>s(e).operatingSiteUser=l),objKey:"operatingSiteUser",permissions:n.permissions,errors:s(e).errors,label:"Betriebstättenrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[26]||(r[26]=[b("h4",null,"Abteilung",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:s(e).group_id,"onUpdate:modelValue":r[18]||(r[18]=l=>s(e).group_id=l),items:n.groups.map(l=>({title:l.name,value:l.id})),label:"Wähle eine Abteilung aus, zu die der Mitarbeiter gehören soll.","error-messages":s(e).errors.group_id,rules:t.value[2].fields.group_id},null,8,["modelValue","items","error-messages","rules"])]),_:1}),o(U,{modelValue:s(e).groupUser,"onUpdate:modelValue":r[19]||(r[19]=l=>s(e).groupUser=l),objKey:"groupUser",permissions:n.permissions,errors:s(e).errors,label:"Abteilungsrechte"},null,8,["modelValue","permissions","errors"]),o(a,{cols:"12"},{default:u(()=>r[27]||(r[27]=[b("h4",null,"Vorgesetzter",-1)])),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(f,{modelValue:s(e).supervisor_id,"onUpdate:modelValue":r[20]||(r[20]=l=>s(e).supervisor_id=l),items:n.supervisors.map(l=>({title:l.first_name+" "+l.last_name,value:l.id})),label:"Wähle einen Vorgesetzten, falls vorhanden","error-messages":s(e).errors.supervisor_id},null,8,["modelValue","items","error-messages"])]),_:1}),o(a,{cols:"12",md:"6"},{default:u(()=>[o(x,{modelValue:s(e).is_supervisor,"onUpdate:modelValue":r[21]||(r[21]=l=>s(e).is_supervisor=l),label:"Ist ein Vorgesetzter"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["style"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),te=se(le,[["__scopeId","data-v-c90f3029"]]);export{te as default};
