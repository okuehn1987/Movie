import{d as z,r as y,D as v,c as N,w as Q,u as q,a as m,o as n,b as i,e as x,f as o,V as G,g as J,h as k,i as u,j as l,k as K,F as f,l as b,m as M,n as A,p as E,q as B,t as V,s as X,v as Y,x as Z,y as ee,z as se}from"./app-CDxl7bQp.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-U5Nf1AVF.js";import{t as ae,u as ne}from"./utils-Hc_rD-4g.js";import{_ as le}from"./AbsenceFilter.vue_vue_type_script_setup_true_lang-CB9FvlDa.js";import{_ as oe,g as re}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-h_kkLlD4.js";import{_ as ue}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-DPjf8ExP.js";import{_ as de}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-DJce9sqt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"d-flex justify-space-between align-center w-100"},ce={class:"d-flex justify-center align-center w-100"},ye={class:"d-flex"},me={class:"d-flex"},pe={key:1,style:{width:"64px"}},ve={key:0,style:{"max-width":"calc(100vw - 28px * 7)","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap"},class:"px-sm-4 px-1"},fe={key:0},be={key:1},xe=z({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},date:{},user_absence_filters:{}},setup(L){const g=L,D=route().params.date,a=y(D?v.fromFormat(D,"yyyy-MM"):v.now()),r=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]}),O=N(()=>[].concat(g.absencePatches.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(g.absences.filter(e=>e.start<=a.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=a.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(r.selected_users.length==0||r.selected_users.includes(e.user_id))&&(r.selected_absence_types.length==0||!e.absence_type_id||r.selected_absence_types.includes(e.absence_type_id))&&(r.selected_statuses.length==0||r.selected_statuses.includes(e.status)))),w=y(!1),U=y(!1),_=y(null),F=y(null),P=y(null),I=N(()=>g.users.find(t=>{var e;return t.id===((e=_.value)==null?void 0:e.user_id)})),C=(()=>{var t,e;return route().params.openAbsence?((t=g.absences)==null?void 0:t.find(s=>s.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=g.absencePatches)==null?void 0:e.find(s=>s.id==Number(route().params.openAbsencePatch)))??null:null})();C&&(_.value=C,F.value=C.user_id,w.value=!0);function T(t,e){F.value=t;const s=O.value.filter(d=>d.user_id===t).find(d=>e&&v.fromSQL(d.start)<=e&&e<=v.fromSQL(d.end));P.value=e??null,_.value=s??null,s&&["hasOpenPatch","created"].includes(re(s))?U.value=!0:w.value=!0}function R(){const t=[];for(let e=1;e<=a.value.daysInMonth;e++)t.push(a.value.startOf("month").plus({day:e-1}));return t}function j(){const t=[];for(let e=1;e<=7;e++)t.push(a.value.startOf("week").plus({day:e-1}));return t}const h=y([a.value.toFormat("yyyy-MM")]),S=y(!1),H=ae(()=>{h.value.includes(a.value.toFormat("yyyy-MM"))||se.reload({only:["absences","absencePatches","holidays"],data:{date:a.value.toFormat("yyyy-MM"),openAbsence:null,openAbsencePatch:null},onStart:()=>{h.value.push(a.value.toFormat("yyyy-MM")),S.value=!0},onError:()=>h.value=h.value.filter(t=>t!=a.value.toFormat("yyyy-MM")),onFinish:()=>S.value=!1})},500);Q(a,H);const W=ne(81),c=q();return(t,e)=>(n(),m(te,{title:"Abwesenheiten"},{default:i(()=>[w.value&&F.value?(n(),m(ue,{key:0,absence_types:t.absence_types,users:t.users,selectedAbsence:_.value,selectedDate:P.value,selectedUser:F.value,"onUpdate:selectedUser":e[0]||(e[0]=s=>F.value=s),modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),onAbsenceReload:e[2]||(e[2]=s=>h.value=[a.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):x("",!0),U.value&&_.value&&I.value?(n(),m(de,{key:1,absence_types:t.absence_types,users:t.users,selectedAbsence:_.value,absenceUser:I.value,modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=s=>U.value=s),onAbsenceReload:e[4]||(e[4]=s=>h.value=[a.value.toFormat("yyyy-MM")])},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):x("",!0),o(G,null,{default:i(()=>[o(J,null,{default:i(()=>[k("div",ie,[l(c).mdAndUp.value?(n(),m(le,{key:0,absence_types:t.absence_types,users:t.users,user_absence_filters:t.user_absence_filters,filterForm:l(r),"onUpdate:filterForm":e[5]||(e[5]=s=>K(r)?r.value=s:null)},null,8,["absence_types","users","user_absence_filters","filterForm"])):x("",!0),k("div",ce,[k("div",ye,[l(c).mdAndUp.value?(n(),u(f,{key:0},[o(b,{onClick:e[6]||(e[6]=M(s=>a.value=a.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-double-left"})]),_:1}),o(b,{onClick:e[7]||(e[7]=M(s=>a.value=a.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-left"})]),_:1})],64)):(n(),m(b,{key:1,onClick:e[8]||(e[8]=M(s=>a.value=a.value.minus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-left"})]),_:1}))]),k("h2",{class:"mx-md-4 text-center",style:E({minWidth:l(c).mdAndUp.value?"170px":"110px"})},[l(c).smAndUp.value?(n(),u(f,{key:0},[B(V(a.value.toFormat("MMMM yyyy")),1)],64)):(n(),u(f,{key:1},[B(V(a.value.startOf("week").toFormat("dd.MM.yyyy"))+" - "+V(a.value.endOf("week").toFormat("dd.MM.yyyy")),1)],64)),S.value?(n(),m(X,{key:2,indeterminate:""})):x("",!0)],4),k("div",me,[l(c).mdAndUp.value?(n(),u(f,{key:0},[o(b,{onClick:e[9]||(e[9]=M(s=>a.value=a.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-right"})]),_:1}),o(b,{onClick:e[10]||(e[10]=M(s=>a.value=a.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-double-right"})]),_:1})],64)):(n(),m(b,{key:1,onClick:e[11]||(e[11]=M(s=>a.value=a.value.plus({week:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:i(()=>[o(A,{icon:"mdi-chevron-right"})]),_:1}))])]),l(c).mdAndUp.value?(n(),u("div",pe)):x("",!0)])]),_:1}),o(Y),o(Z,{"fixed-header":"",style:E([{"white-space":"pre"},{maxHeight:l(W)}]),id:"absence-table",items:t.users.filter(s=>l(r).selected_users.length==0||l(r).selected_users.includes(s.id)).map(s=>({...s,name:l(c).mdAndUp.value?s.last_name+", "+s.first_name:s.first_name.substring(0,1)+"."+s.last_name})).toSorted((s,d)=>d.id==t.$page.props.auth.user.id?1:s.last_name.localeCompare(d.last_name)),headers:[{title:"Name",key:"name",headerProps:{class:"px-sm-4 px-1"}},...l(c).mdAndUp.value?[{title:"",key:"action",width:"48px",sortable:!1}]:[],...(l(c).mdAndUp.value?R():j()).map((s,d,p)=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.toString(),sortable:!1,align:"center",width:1/p.length*100+"%",headerProps:{class:{"bg-blue-darken-2":s.toISODate()===l(v).local().toISODate()}}}))]},{item:i(({item:s,columns:d})=>[k("tr",null,[(n(!0),u(f,null,ee(d,p=>(n(),u(f,{key:p.key},[p.key==="name"?(n(),u("td",ve,V(s.name),1)):p.key==="action"?(n(),u(f,{key:1},[t.can("absence","create",s)?(n(),u("td",fe,[o(b,{icon:"mdi-plus",variant:"text",onClick:$=>t.can("absence","create",s)&&T(s.id)},null,8,["onClick"])])):(n(),u("td",be))],64)):(n(),m(oe,{key:2,onClick:$=>t.can("absence","create",s)&&T(s.id,l(v).fromISO(p.key)),holidays:t.holidays,absenceTypes:t.absence_types,user:s,date:l(v).fromISO(p.key),entries:O.value.filter($=>$.user_id===s.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{xe as default};
