import{d as U,Q as x,r as A,T as B,a as I,o as f,c as V,w as o,b as l,V as M,u as n,e as k,f as T,g as y,h as w,i as N,t as S,j as O,k as Q,l as E,m as F,n as c,p as $,q as z,s as j,v,x as J,F as q,y as R,D as u,z as G,A as H}from"./app-D7N-wvAF.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DqvbmMl0.js";const P=["role","onClick"],Y=U({__name:"AbsenceIndex",props:{users:{},absence_types:{}},setup(C){const D=C,m=x();function g(){const r=[];for(let t=1;t<=u.now().daysInMonth;t++)r.push(u.now().startOf("month").plus({day:t-1}));return r}function h(r,t){var s;const i=r.absences.find(d=>u.fromSQL(d.start)<=t&&t<=u.fromSQL(d.end));return i&&i.status==="accepted"?((s=i.absence_type)==null?void 0:s.abbreviation)||"âŒ":r.user_working_weeks.find(d=>{var e;return d[(e=t.setLocale("en-US").weekdayLong)==null?void 0:e.toLowerCase()]})?" ":""}function b(r,t){return t.supervisor_id===r||t.id==r}const _=A(!1),a=B({absence_type_id:void 0,start:new Date,end:new Date,user_id:m.props.auth.user.id});function L(r,t){const i=D.users.find(e=>e.id===t);if(!i||!b(m.props.auth.user.id,i))return;const s=u.now().startOf("month").plus({day:+r}),d=i.absences.find(e=>u.fromSQL(e.start)<=s&&s<=u.fromSQL(e.end));d&&(a.absence_type_id=d.absence_type_id),a.user_id=t,a.start=u.now().startOf("month").plus({day:+r-1}).toJSDate(),a.end=u.now().startOf("month").plus({day:+r}).toJSDate(),_.value=!0}return(r,t)=>{const i=I("v-date-input");return f(),V(K,{title:"Abwesenheiten"},{default:o(()=>[l(z,{"max-width":"1000",modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=s=>_.value=s)},{default:o(({isActive:s})=>{var d;return[l(M,{title:"Abwesenheit"+(n(a).user_id!=n(m).props.auth.user.id?" von "+((d=r.users.map(e=>({...e,name:e.first_name+" "+e.last_name})).find(e=>e.id===n(a).user_id))==null?void 0:d.name):"")+" beantragen"},{append:o(()=>[l(k,{icon:"",variant:"text",onClick:e=>s.value=!1},{default:o(()=>[l(T,null,{default:o(()=>t[4]||(t[4]=[y("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:o(()=>[n(a).errors.user_id?(f(),V(w,{key:0},{default:o(()=>[l(N,{color:"error",closable:""},{default:o(()=>[y(S(n(a).errors.user_id),1)]),_:1})]),_:1})):O("",!0),l(w,null,{default:o(()=>[l(Q,{onSubmit:E(e=>{n(a).transform(p=>({...p,start:p.start.toLocaleDateString(),end:p.end.toLocaleDateString()})).post(r.route("absence.store"),{onSuccess:()=>{n(a).reset(),s.value=!1}})},["prevent"])},{default:o(()=>[l(F,null,{default:o(()=>[l(c,{cols:"12"},{default:o(()=>[l($,{label:"Abwesenheitsgrund angeben",items:r.absence_types.map(e=>({title:e.name,value:e.id})),modelValue:n(a).absence_type_id,"onUpdate:modelValue":t[0]||(t[0]=e=>n(a).absence_type_id=e),"error-messages":n(a).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),l(c,{cols:"12",md:"6"},{default:o(()=>[l(i,{label:"Von",modelValue:n(a).start,"onUpdate:modelValue":t[1]||(t[1]=e=>n(a).start=e),"error-messages":n(a).errors.start},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"12",md:"6"},{default:o(()=>[l(i,{label:"Bis",modelValue:n(a).end,"onUpdate:modelValue":t[2]||(t[2]=e=>n(a).end=e),"error-messages":n(a).errors.end},null,8,["modelValue","error-messages"])]),_:1}),l(c,{cols:"12",class:"text-end"},{default:o(()=>[l(k,{loading:n(a).processing,type:"submit",color:"primary"},{default:o(()=>t[5]||(t[5]=[y("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),l(R,{style:{"white-space":"pre"},id:"absence-table",items:r.users.map(s=>({...s,name:s.first_name+`
`+s.last_name,...Object.fromEntries(g().map(d=>[d.day,h(s,d)]))})),headers:[{title:"Name",key:"name"},...g().map(s=>({title:s.weekdayShort+`
`+s.day.toString(),key:s.day.toString(),sortable:!1,align:"center"}))]},{item:o(({item:s,columns:d})=>[j("tr",null,[(f(!0),v(q,null,J(d,e=>(f(),v("td",{key:e.key+"",style:G({backgroundColor:s[e.key]?"":"lightgray"}),class:H({"editable-cell":b(n(m).props.auth.user.id,s)}),role:b(n(m).props.auth.user.id,s)?"button":"cell",onClick:p=>L(e.key+"",s.id)},S(s[e.key]),15,P))),128))])]),_:1},8,["items","headers"])]),_:1})}}});export{Y as default};
