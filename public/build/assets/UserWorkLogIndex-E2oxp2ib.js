import{d as M,r as w,c as B,o as U,D as d,aP as I,a as h,b as k,e as i,g as s,V as C,z as N,h as a,s as Q,j as A,f as V,m as _,p as b,S as E,y as q,i as z,K,L as W,M as c,P as D,a3 as $,Q as O,t as L,v as j,q as J,B as R}from"./app-CrU0wnO9.js";import{_ as Z}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-DHP1rF-t.js";import{A as G}from"./AdminLayout-BjjWDou1.js";import{u as X}from"./utils-DYLd7X5p.js";import{_ as Y}from"./CreateNewWorkLog.vue_vue_type_script_setup_true_lang-DzYjHav-.js";import{_ as ee}from"./UserShowNavBar.vue_vue_type_script_setup_true_lang-C_R0xhnX.js";import"./ChatDetails-CdHooTHm.js";import"./ChatMessage-B9BYBEPk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"d-flex ga-2"},me=M({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(H){const v=H,f=w(!1),m=w(null),u=w(null),p=B(()=>m.value=="show"?"plain":"underlined");U(()=>{const r=route().params.workLog;if(r)return y(Number(r));const e=Number(route().params.openWorkLogPatch);if(e){const n=v.workLogs.find(l=>{var o,g;return((o=l.latest_patch)==null?void 0:o.id)==e||((g=l.current_accepted_patch)==null?void 0:g.id)==e});if(n)return y(n.id)}});const t=useForm({id:null,start:new Date,end:new Date,comment:null,start_time:"",end_time:"",is_home_office:!1,type:"log",status:"created"});function S(r){let e=d.fromFormat(r,"HH:mm:ss");return e.isValid||(e=d.fromFormat(r,"HH:mm")),e}function P(){t.id&&t.transform(r=>{const e=S(r.start_time),n=S(r.end_time);return{...r,start:d.fromISO(r.start.toISOString()).set({hour:e.hour,minute:e.minute,second:e.second}),end:d.fromISO(r.end.toISOString()).set({hour:n.hour,minute:n.minute,second:n.second})}}).post(route("workLog.workLogPatch.store",{workLog:t.id}),{onSuccess:()=>{f.value=!1,t.reset()}})}function y(r){var g;const e=v.workLogs.find(F=>F.id===r);if(!e)return;const n=e.latest_patch;n?n.status==="created"?(u.value=n,m.value="show"):(n.status,u.value=n,m.value="edit"):(u.value=null,m.value=e.status=="created"?"show":"edit");const l=(u.value??e).start,o=(u.value??e).end;t.defaults({comment:((g=u.value)==null?void 0:g.comment)??e.comment,id:r,start:new Date(l),end:o?new Date(o):new Date,start_time:d.fromSQL(l).toFormat("HH:mm:ss"),end_time:d.fromSQL(o||d.now().toSQL()).toFormat("HH:mm:ss"),is_home_office:(u.value??e).is_home_office,type:u.value?"patch":"log",status:(u.value??e).status}),t.reset(),f.value=!0}function T(){const r=v.workLogs.find(n=>n.id===t.id);if(!r)return;const e=r.latest_patch;e&&R.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{f.value=!1}})}const x=X(0);return(r,e)=>{const n=I("v-date-input");return k(),h(G,{title:r.user.first_name+" "+r.user.last_name,backurl:r.route().params.fromUserWorkLogs?r.route("workLog.index"):r.route("dashboard")},{default:i(()=>[s(ee,{user:r.user,tab:"workLog.index"},null,8,["user"]),s(C,null,{default:i(()=>[s(N,{"fixed-header":"",style:Q({maxHeight:a(x)}),headers:[{title:"Start",key:"start_text",width:"20%"},{title:"Ende",key:"end",width:"20%"},{title:"Dauer",key:"duration",width:"20%"},{title:"Homeoffice",key:"is_home_office",width:"20%"},{title:"Stand",key:"displayStatus",width:"20%"},{title:"",key:"actions",sortable:!1,width:"1px",align:"end"}],items:r.workLogs.map(l=>{const o=l.current_accepted_patch??l;return{start:o.start,start_text:a(d).fromSQL(o.start).toFormat("dd.MM.yyyy HH:mm"),end:o.end?a(d).fromSQL(o.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",duration:o.end?a(d).fromSQL(o.end).diff(a(d).fromSQL(o.start)).toFormat("hh:mm"):"",is_home_office:o.is_home_office?"Ja":"Nein",id:l.id,displayStatus:l.latest_patch?{created:"Korrektur Beantragt",declined:"Korrektur Abgelehnt",accepted:"Korrektur Akzeptiert"}[l.latest_patch.status]:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert"}[l.status],status:(l.latest_patch??l).status}}).toSorted((l,o)=>o.start.localeCompare(l.start))},{"header.actions":i(()=>[s(Y,{user:r.user},null,8,["user"])]),"item.actions":i(({item:l})=>[A("div",te,[r.can("workLogPatch","create")?(k(),h(_,{key:0,color:"primary",onClick:b(o=>y(l.id),["stop"]),icon:l.status==="created"?"mdi-eye":"mdi-pencil",variant:"text","data-testid":"entryToWorkLog"},null,8,["onClick","icon"])):V("",!0),r.can("workLog","delete")?(k(),h(Z,{key:1,title:"Eintrag löschen",content:"Möchten Sie diesen Eintrag wirklich löschen? Dies kann nicht rückgängig gemacht werden.",route:r.route("workLog.destroy",{workLog:l.id})},null,8,["route"])):V("",!0)])]),_:1},8,["style","items"]),s(E,{"max-width":"1000",modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l)},{default:i(({isActive:l})=>[s(C,{title:a(t).type=="patch"?"Zeitkorrektur":"Buchung"},{append:i(()=>[s(_,{icon:"",variant:"text",onClick:o=>{l.value=!1,a(t).reset()}},{default:i(()=>[s(J,null,{default:i(()=>[...e[7]||(e[7]=[L("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:i(()=>[s(q),s(z,null,{default:i(()=>[s(K,{onSubmit:b(P,["prevent"])},{default:i(()=>[s(W,null,{default:i(()=>[s(c,{cols:"12",md:"3"},{default:i(()=>[s(n,{label:"Start","data-testid":"userTimeCorrectionStartDay",required:"","error-messages":a(t).errors.start,modelValue:a(t).start,"onUpdate:modelValue":e[0]||(e[0]=o=>a(t).start=o),variant:p.value,style:{height:"73px"},disabled:a(t).status=="created"},null,8,["error-messages","modelValue","variant","disabled"])]),_:1}),s(c,{cols:"12",md:"3"},{default:i(()=>[s(D,{type:"time",label:"Start",step:"1","data-testid":"userTimeCorrectionStartTime",required:"","error-messages":a(t).errors.start_time,modelValue:a(t).start_time,"onUpdate:modelValue":e[1]||(e[1]=o=>a(t).start_time=o),disabled:a(t).status=="created",variant:p.value},null,8,["error-messages","modelValue","disabled","variant"])]),_:1}),s(c,{cols:"12",md:"3"},{default:i(()=>[s(n,{label:"Ende","data-testid":"userTimeCorrectionEndDay",required:"","error-messages":a(t).errors.end,modelValue:a(t).end,"onUpdate:modelValue":e[2]||(e[2]=o=>a(t).end=o),variant:p.value,style:{height:"73px"},disabled:a(t).status=="created"},null,8,["error-messages","modelValue","variant","disabled"])]),_:1}),s(c,{cols:"12",md:"3"},{default:i(()=>[s(D,{disabled:a(t).status=="created",type:"time",label:"Ende",step:"1","data-testid":"userTimeCorrectionEndTime",required:"","error-messages":a(t).errors.end_time,modelValue:a(t).end_time,"onUpdate:modelValue":e[3]||(e[3]=o=>a(t).end_time=o),variant:p.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),s(c,{cols:"12"},{default:i(()=>[s($,{label:"Bemerkung (optional)",modelValue:a(t).comment,"onUpdate:modelValue":e[4]||(e[4]=o=>a(t).comment=o),"error-messages":a(t).errors.comment,disabled:a(t).status=="created",variant:"filled","max-rows":"10","auto-grow":""},null,8,["modelValue","error-messages","disabled"])]),_:1}),s(c,{cols:"12",md:"3"},{default:i(()=>[s(O,{disabled:a(t).status=="created",label:"Homeoffice",required:"","error-messages":a(t).errors.is_home_office,modelValue:a(t).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=o=>a(t).is_home_office=o),variant:p.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),s(c,{cols:"12",class:"text-end"},{default:i(()=>[a(t).type=="patch"&&a(t).status=="created"&&r.can("workLogPatch","delete")&&m.value==="show"?(k(),h(_,{key:0,loading:a(t).processing,onClick:b(T,["stop"]),color:"primary"},{default:i(()=>[...e[8]||(e[8]=[L(" Antrag zurückziehen ",-1)])]),_:1},8,["loading"])):r.can("workLogPatch","create")&&m.value==="edit"?(k(),h(_,{key:1,loading:a(t).processing,disabled:!a(t).isDirty,type:"submit",color:"primary"},{default:i(()=>[L(" Korrektur "+j(r.can("workLogPatch","update")?"speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{me as default};
