import{d as I,w as E,r as Q,c as T,a as g,o as u,Q as q,b as i,f as o,V as j,x as K,g as O,K as A,e as v,L as p,O as C,M as G,i as a,ab as J,a7 as W,a8 as Z,p as k,s as d,t as f,N as X,ap as Y,h as l,P as B,ao as _,y as x,aq as ee,j as V,F as N,ar as te,z as se,l as b,m as S,D,J as ie,A as P,n as oe}from"./app-CkPkeUk-.js";import{_ as ae}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-CAL9XB3-.js";import{P as re}from"./types-BVvW7sCV.js";import{c as F}from"./utils-CO8JpIIy.js";import{_ as le}from"./RecordCreateDialog.vue_vue_type_script_setup_true_lang-BO7J-le6.js";const ne={class:"d-flex ga-2"},de=["colspan"],ue={class:"bg-surface-medium"},me={class:"bg-surface-light"},ce={class:"py-2"},pe={class:"py-2"},ke={key:0},fe={key:1},ge={class:"py-2"},be={style:{width:"1px",padding:"0"}},ye={style:{width:"1px",padding:"0"}},Ce=I({__name:"TicketShowDialog",props:{ticket:{},customers:{},users:{},tab:{},operatingSites:{}},setup($){const n=$,r=useForm({priority:n.ticket.priority,assignees:n.ticket.assignees.map(e=>e.id),title:n.ticket.title,description:n.ticket.description,selected:n.ticket.records.filter(e=>e.accounted_at).map(e=>e.id)});E(n.ticket,()=>{r.defaults({priority:n.ticket.priority,assignees:n.ticket.assignees.map(e=>e.id)??[],title:n.ticket.title,description:n.ticket.description,selected:n.ticket.records.filter(e=>e.accounted_at).map(e=>e.id)}).reset()},{deep:!0});const h=Q(Number(route().params.openTicket)==n.ticket.id),z=T(()=>n.ticket.records.length>0),U=T(()=>n.ticket.records.reduce((e,t)=>e+t.duration,0)),H=T(()=>n.ticket.records.filter(e=>r.selected.find(t=>t===e.id)).reduce((e,t)=>e+t.duration,0)),L={accepted:"mdi-check",created:"mdi-timer-sand",declined:"mdi-close"};function R(){if(route().current()==="ticket.show")P.get(route("ticket.index",{tab:n.tab}));else{const e=route().routeParams.customer;e?P.get(route("customer.show",{customer:e,tab:n.tab})):h.value=!1}}function M(e){navigator.clipboard.writeText(D.fromSQL(e.start).toFormat("dd.MM.yyyy HH:mm")+" - "+D.fromSQL(e.start).plus({seconds:e.duration}).toFormat("HH:mm")+" Uhr, "+e.userName+`

`+(e.description??""))}return(e,t)=>(u(),g(q,{"max-width":"1000px",height:"800px",modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=y=>h.value=y)},{activator:i(({props:y})=>[o(b,B({title:"Auftrag anzeigen"},y,{icon:"",variant:"text"}),{default:i(()=>[o(k,{icon:"mdi-eye"})]),_:1},16)]),default:i(({isActive:y})=>[o(ie,{onSubmit:S(s=>{a(r).patch(e.route("ticket.update",{ticket:e.ticket.id}),{onSuccess:()=>{a(r).reset(),y.value=!1,R()}})},["prevent"])},{default:i(()=>[o(j,{title:"Auftrag anzeigen"},{append:i(()=>[o(b,{icon:"",variant:"text",onClick:S(s=>{y.value=!1,R()},["stop"])},{default:i(()=>[o(k,null,{default:i(()=>[...t[6]||(t[6]=[d("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:i(()=>[o(K),o(O,null,{default:i(()=>[o(A,null,{default:i(()=>[o(p,{cols:"12",md:"8"},{default:i(()=>[o(C,{label:"Kunde","model-value":e.ticket.customer.name,disabled:""},null,8,["model-value"])]),_:1}),o(p,{cols:"12",md:"4"},{default:i(()=>[o(G,{items:a(re),label:"Priorität",required:"","error-messages":a(r).errors.priority,modelValue:a(r).priority,"onUpdate:modelValue":t[0]||(t[0]=s=>a(r).priority=s),disabled:e.tab!=="newTickets"},{selection:i(({item:s})=>[d(f(s.raw.title)+" ",1),o(k,{class:"ms-2",icon:s.raw.icon,color:s.raw.color},null,8,["icon","color"])]),item:i(({props:s,item:m})=>[o(J,W(Z(s)),{append:i(()=>[o(k,{icon:m.raw.icon,color:m.raw.color},null,8,["icon","color"])]),_:2},1040)]),_:1},8,["items","error-messages","modelValue","disabled"])]),_:1}),o(p,{cols:"12",md:"12"},{default:i(()=>[o(X,{label:"Zuweisung",disabled:e.tab!=="newTickets"&&e.tab!=="workingTickets",required:"",multiple:"",chips:"",modelValue:a(r).assignees,"onUpdate:modelValue":t[1]||(t[1]=s=>a(r).assignees=s),"error-messages":a(r).errors.assignees,items:e.users.map(s=>({value:s.id,title:`${s.first_name} ${s.last_name}`,props:{subtitle:s.job_role??""}}))},{chip:i(({item:s})=>{var m;return[o(_,{"prepend-icon":L[((m=e.ticket.assignees.find(c=>c.id===s.value))==null?void 0:m.pivot.status)??"created"]},null,8,["prepend-icon"])]}),append:i(()=>[o(Y,null,{activator:i(({props:s})=>[o(k,B(s,{icon:"mdi-information-outline",variant:"text",color:"primary"}),null,16)]),default:i(()=>[o(k,null,{default:i(()=>[...t[7]||(t[7]=[d("mdi-check",-1)])]),_:1}),t[10]||(t[10]=d(" : angenommen ",-1)),t[11]||(t[11]=l("br",null,null,-1)),o(k,null,{default:i(()=>[...t[8]||(t[8]=[d("mdi-timer-sand",-1)])]),_:1}),t[12]||(t[12]=d(" : zugewiesen ",-1)),t[13]||(t[13]=l("br",null,null,-1)),o(k,null,{default:i(()=>[...t[9]||(t[9]=[d("mdi-close",-1)])]),_:1}),t[14]||(t[14]=d(" : abgelehnt ",-1))]),_:1})]),_:1},8,["disabled","modelValue","error-messages","items"])]),_:1}),o(p,{cols:"12"},{default:i(()=>[o(C,{label:"Betreff",modelValue:a(r).title,"onUpdate:modelValue":t[2]||(t[2]=s=>a(r).title=s),disabled:e.tab!=="newTickets","error-messages":a(r).errors.title},null,8,["modelValue","disabled","error-messages"])]),_:1}),o(p,{cols:"12"},{default:i(()=>[o(C,{label:"Beschreibung",modelValue:a(r).description,"onUpdate:modelValue":t[3]||(t[3]=s=>a(r).description=s),disabled:e.tab!=="newTickets","error-messages":a(r).errors.description},null,8,["modelValue","disabled","error-messages"])]),_:1}),z.value?(u(),g(x,{key:0,modelValue:a(r).selected,"onUpdate:modelValue":t[4]||(t[4]=s=>a(r).selected=s),headers:[{title:"Start",key:"start"},{title:"Auftragsdauer",key:"duration"},{title:"Erstellt von",key:"userName"},{title:"",key:"actions",width:"1px",sortable:!1}],items:e.ticket.records.map(s=>({...s,userName:s.user.first_name+" "+s.user.last_name})),"show-expand":"","show-select":e.tab!=="archive"&&e.can("ticket","account",e.ticket)},ee({"item.start":i(({item:s})=>[d(f(a(D).fromSQL(s.start).toFormat("dd.MM.yyyy HH:mm")),1)]),"item.duration":i(({item:s})=>[d(f(a(F)(s.duration,"minutes","duration")),1)]),"item.actions":i(({item:s})=>[l("div",ne,[o(b,{variant:"text",color:"primary",title:"Eintrag kopieren",onClick:S(m=>M(s),["stop"])},{default:i(()=>[o(k,{icon:"mdi-content-copy"})]),_:1},8,["onClick"]),e.tab!="finishedTickets"&&e.tab!=="archive"?(u(),g(le,{key:0,ticket:e.ticket,users:e.users,record:s,operatingSites:e.operatingSites},null,8,["ticket","users","record","operatingSites"])):v("",!0)])]),"item.data-table-expand":i(({internalItem:s,isExpanded:m,toggleExpand:c})=>[o(b,{size:"small",variant:"text",border:"",onClick:w=>c(s)},{default:i(()=>[o(k,{icon:m(s)?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:2},1032,["onClick"])]),"expanded-row":i(({columns:s,item:m})=>[l("tr",null,[l("td",{colspan:s.length,class:"py-2"},[o(te,{density:"compact"},{default:i(()=>[l("tbody",ue,[l("tr",me,[t[15]||(t[15]=l("th",null,"Ressourcen",-1)),l("td",ce,f(m.resources),1),t[16]||(t[16]=l("td",null,null,-1)),t[17]||(t[17]=l("td",null,null,-1))]),l("tr",null,[t[18]||(t[18]=l("th",null,"Beschreibung",-1)),l("td",pe,f(m.description),1),t[19]||(t[19]=l("td",null,null,-1)),t[20]||(t[20]=l("td",null,null,-1))]),(u(!0),V(N,null,se(m.files,(c,w)=>(u(),V("tr",{class:oe({"bg-surface-light":w%2==0}),key:w},[w==0?(u(),V("th",ke,"Anhang")):(u(),V("th",fe)),l("td",ge,f(c.original_name),1),l("td",be,[c.original_name.endsWith(".pdf")?(u(),g(b,{key:0,variant:"text",href:e.route("ticketRecordFile.show",{ticketRecordFile:c.id}),color:"primary",icon:"mdi-eye"},null,8,["href"])):(u(),g(b,{key:1,variant:"text",href:e.route("ticketRecordFile.getContent",{ticketRecordFile:c.id}),color:"primary",icon:"mdi-download",download:c.original_name},null,8,["href","download"]))]),l("td",ye,[o(ae,{title:"Datei löschen",content:"Bist du dir sicher, dass du diese Datei löschen möchtest?",route:e.route("ticketRecordFile.destroy",{ticketRecordFile:c.id})},null,8,["route"])])],2))),128))])]),_:2},1024)],8,de)])]),_:2},[e.tab!=="archive"&&e.can("ticket","account",e.ticket)?{name:"bottom",fn:i(()=>[o(A,{class:"text-end","no-gutters":""},{default:i(()=>[(u(),V(N,{key:0},[o(p,{cols:"12",md:"11"},{default:i(()=>[...t[21]||(t[21]=[d("Ausgewählte Auftragsdauer",-1)])]),_:1}),o(p,{cols:"12",md:"1"},{default:i(()=>[d(f(a(F)(H.value,"minutes","duration")),1)]),_:1})],64)),o(p,{cols:"12",md:"11"},{default:i(()=>[...t[22]||(t[22]=[d("Gesamte Auftragsdauer",-1)])]),_:1}),o(p,{cols:"12",md:"1"},{default:i(()=>[d(f(a(F)(U.value,"minutes","duration")),1)]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["modelValue","items","show-select"])):v("",!0),e.tab!=="archive"?(u(),g(p,{key:1,cols:"12",class:"text-end"},{default:i(()=>[e.can("ticket","account",e.ticket)?(u(),g(b,{key:0,color:"primary",type:"submit",loading:a(r).processing,disabled:!a(r).isDirty},{default:i(()=>[d(f(e.tab==="newTickets"?"Änderungen und Abrechnungen speichern":"Abrechnungen speichern"),1)]),_:1},8,["loading","disabled"])):["newTickets","workingTickets"].includes(e.tab)?(u(),g(b,{key:1,color:"primary",type:"submit",loading:a(r).processing,disabled:!a(r).isDirty},{default:i(()=>[...t[23]||(t[23]=[d(" Änderungen speichern ",-1)])]),_:1},8,["loading","disabled"])):v("",!0)]),_:1})):v("",!0)]),_:1})]),_:1})]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:1},8,["modelValue"]))}});export{Ce as _};
