import{d as C,r as N,a as d,o as m,b as t,f as a,y as $,i as l,e as p,Q as A,V as h,x as D,g as S,K as B,L as V,S as L,s as u,h as b,l as g,m as v,p as T,P,t as y,O as I,D as M}from"./app-Ct_Uu1No.js";import{_ as R}from"./TicketCreateDialog.vue_vue_type_script_setup_true_lang-BYAERI30.js";import{_ as x}from"./TicketShowDialog.vue_vue_type_script_setup_true_lang-C8eVuTbs.js";import{_ as E}from"./RecordCreateDialog.vue_vue_type_script_setup_true_lang-_K-Dh-o4.js";import{_ as F}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-Csr7Iuc5.js";import{P as f}from"./types-BVvW7sCV.js";const H={class:"d-flex ga-2 align-center"},j=C({__name:"TicketTable",props:{tickets:{},customers:{},users:{},tab:{}},setup(K){const _=useForm({}),k=N("");function w(s){const n=s.sort((r,o)=>r.accounted_at?o.accounted_at?o.accounted_at.localeCompare(r.accounted_at):-1:1);if(!n[0])return"-";const e=M.fromSQL(n[0].accounted_at??"");return e.isValid?e.toFormat("dd.MM.yyyy HH:mm"):"-"}return(s,n)=>(m(),d(h,null,{default:t(()=>[a($,{"fixed-header":"",headers:[{title:"Ticketnummer",key:"reference_number"},{title:"Titel",key:"title"},{title:"Kunde",key:"customer.name"},{title:"Priorität",key:"priorityText"},{title:"Erstellt von",key:"user.name"},{title:"Zugewiesen an",key:"assigneeName"},...s.tab==="archive"?[{title:"Abgerechnet am",key:"accounted_at"}]:[],{title:"",key:"actions",align:"end",sortable:!1}],items:s.tickets.map(e=>{var o,c;const r=(()=>{if(e.assignees.length==0)return null;const i=e.assignees[0];return e.assignees.length==1?i.first_name+" "+i.last_name:`${i.first_name} ${i.last_name} (+${e.assignees.length-1} weitere)`})();return{...e,user:{...e.user,name:e.user.first_name+" "+e.user.last_name},assigneeName:r,priorityText:(o=l(f).find(i=>i.value===e.priority))==null?void 0:o.title,priorityValue:(c=l(f).find(i=>i.value===e.priority))==null?void 0:c.priorityValue}}).filter(e=>{const r=k.value.replace(/\W/gi,"").toLowerCase();return(e.title+e.customer.name+e.user.name+e.assigneeName+e.priorityText).toLowerCase().replace(/\W/gi,"").includes(r)}),hover:""},{"header.actions":t(()=>[b("div",H,[a(I,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=e=>k.value=e),placeholder:"Suche",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"]),s.tab==="newTickets"?(m(),d(R,{key:0,customers:s.customers,users:s.users},null,8,["customers","users"])):p("",!0)])]),"item.priorityText":t(({item:e})=>{var r,o,c;return[u(y((r=l(f).find(i=>i.value===e.priority))==null?void 0:r.title)+" ",1),a(T,{icon:(o=l(f).find(i=>i.value===e.priority))==null?void 0:o.icon,color:(c=l(f).find(i=>i.value===e.priority))==null?void 0:c.color},null,8,["icon","color"])]}),"item.assigneeName":t(({item:e})=>[u(y(e.assigneeName),1)]),"item.accounted_at":t(({item:e})=>[u(y(w(e.records)),1)]),"item.actions":t(({item:e})=>[s.tab==="newTickets"?(m(),d(A,{key:0,"max-width":"1000"},{activator:t(({props:r})=>[a(g,P({title:"Auftrag abschließen"},r,{variant:"text",icon:"mdi-check"}),null,16)]),default:t(({isActive:r})=>[a(h,{title:"Auftrag als abgeschlossen markieren"},{append:t(()=>[a(g,{icon:"",variant:"text",onClick:v(o=>r.value=!1,["stop"])},{default:t(()=>[a(T,null,{default:t(()=>[...n[1]||(n[1]=[u("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:t(()=>[a(D),a(S,null,{default:t(()=>[a(B,null,{default:t(()=>[a(V,{cols:"12"},{default:t(()=>[a(L,{type:"warning"},{default:t(()=>[...n[2]||(n[2]=[u(" Bist du dir sicher, dass du diesen Auftrag als abgeschlossen markieren möchtest? ",-1),b("br",null,null,-1),u(" Du kannst danach keine weiteren Einträge für diesen Auftrag hinzufügen oder bearbeiten. ",-1)])]),_:1})]),_:1}),a(V,{cols:"12",class:"text-end"},{default:t(()=>[a(g,{color:"primary",onClick:v(o=>l(_).patch(s.route("ticket.finish",{ticket:e.id}),{onSuccess:()=>r.value=!1}),["stop"]),loading:l(_).processing},{default:t(()=>[...n[3]||(n[3]=[u(" Bestätigen ",-1)])]),_:1},8,["onClick","loading"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):p("",!0),s.tab==="newTickets"?(m(),d(E,{key:1,ticket:e,users:s.users,mode:"create"},null,8,["ticket","users"])):p("",!0),a(x,{ticket:e,customers:s.customers,users:s.users,tab:s.tab},null,8,["ticket","customers","users","tab"]),s.tab==="newTickets"?(m(),d(F,{key:2,content:"Möchtest du dieses Ticket löschen?",title:"Löschen",route:s.route("ticket.destroy",{ticket:e.id})},null,8,["route"])):p("",!0)]),_:1},8,["headers","items"])]),_:1}))}});export{j as _};
