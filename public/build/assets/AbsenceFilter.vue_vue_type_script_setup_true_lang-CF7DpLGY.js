import{d as $,B as E,u as G,C as w,w as C,r as j,a as T,o as z,b as t,f as s,V as x,x as q,g as I,e as H,i as m,E as K,G as D,H as L,I as B,J as S,K as F,L as i,M as p,N as v,h as P,l as n,m as f,s as o,O as R,y as W,p as A,t as M,P as Z,Q as J}from"./app-C0jDoDpN.js";const Q={class:"d-flex justify-end"},Y=$({__name:"AbsenceFilter",props:E({userAbsenceFilters:{},users:{},absenceTypes:{},schoolHolidays:{},federal_state:{},all_federal_states:{},filterableOperatingSites:{},filterableGroups:{}},{filterForm:{required:!0},filterFormModifiers:{},singleFilterForm:{required:!0},singleFilterFormModifiers:{}}),emits:["update:filterForm","update:singleFilterForm"],setup(g){const b=g,c={set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"],selected_holidays:[b.federal_state],selected_operating_sites:[],selected_groups:[]},k=G(),a=w(g,"filterForm"),u=w(g,"singleFilterForm"),V=useForm({filter_id:null});C(()=>a.value.set,U);function U(r){if(r==null)return;let l;if(typeof r=="object"&&a.value.isDirty?l=b.userAbsenceFilters.find(e=>e.id==r.value):typeof r=="string"&&(l=b.userAbsenceFilters.find(e=>e.name==r)),!l)return;const d={set:typeof r=="string"?{title:r,value:l.id}:r,selected_users:l.data.user_ids,selected_absence_types:l.data.absence_type_ids,selected_statuses:l.data.statuses,selected_holidays:l.data.holidays_from_federal_states,selected_groups:l.data.group_ids,selected_operating_sites:l.data.operating_site_ids};a.value.defaults(d).reset()}C(()=>u.value.set,r=>{if(r==null)return;const l=b.userAbsenceFilters.find(d=>d.id==r);l&&(u.value.defaults({set:l.id,selected_users:l.data.user_ids,selected_absence_types:l.data.absence_type_ids,selected_statuses:l.data.statuses,selected_holidays:l.data.holidays_from_federal_states,selected_groups:l.data.group_ids,selected_operating_sites:l.data.operating_site_ids}),u.value.reset())});function N(){var r;typeof a.value.set!="string"&&((r=a.value.set)!=null&&r.value)?a.value.patch(route("userAbsenceFilter.update",{userAbsenceFilter:a.value.set.value})):a.value.post(route("userAbsenceFilter.store"),{onSuccess:()=>{U(a.value.set)}})}function O(r){const l={value:r.id,title:r.name};a.value.defaults({set:l,selected_users:r.data.user_ids??[],selected_absence_types:r.data.absence_type_ids??[],selected_statuses:r.data.statuses??[],selected_holidays:r.data.holidays_from_federal_states??[],selected_groups:r.data.group_ids??[],selected_operating_sites:r.data.operating_site_ids??[]}),a.value.set=l,a.value.reset()}const y=j("singleFilter");return C([()=>u.value.set,()=>a.value.set],([r,l],[d,e])=>{d==null&&r!=null?a.value.defaults(c).reset():e==null&&l!=null&&u.value.defaults(c).reset()}),(r,l)=>(z(),T(J,{"max-width":"1000"},{activator:t(({props:d})=>[s(n,Z(d,{variant:"flat",color:"primary"}),{default:t(()=>[s(A,null,{default:t(()=>[...l[19]||(l[19]=[o("mdi-filter",-1)])]),_:1})]),_:1},16)]),default:t(({isActive:d})=>[s(x,{title:"Abwesenheiten filtern"},{append:t(()=>[s(n,{icon:"",variant:"text",onClick:e=>{d.value=!1,g.filterForm.reset()}},{default:t(()=>[s(A,null,{default:t(()=>[...l[20]||(l[20]=[o("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:t(()=>[s(q),s(I,null,{default:t(()=>[m(k).smAndDown.value?H("",!0):(z(),T(K,{key:0,modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=e=>y.value=e),color:"primary"},{default:t(()=>[s(D,{text:"Einzelfilter",value:"singleFilter"}),s(D,{text:"Filtergruppen",value:"groupFilter"})]),_:1},8,["modelValue"])),s(L,{modelValue:y.value,"onUpdate:modelValue":l[18]||(l[18]=e=>y.value=e),class:"w-100"},{default:t(()=>[s(B,{value:"singleFilter"},{default:t(()=>[s(S,null,{default:t(()=>[s(F,{class:"mt-2"},{default:t(()=>[s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Filtergruppe auswählen","auto-select-first":"exact",variant:"underlined",items:r.userAbsenceFilters.map(e=>({value:e.id,title:e.name})),modelValue:u.value.set,"onUpdate:modelValue":l[1]||(l[1]=e=>u.value.set=e),"error-messages":u.value.errors.set,required:"",clearable:""},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Betriebsstätten",items:r.filterableOperatingSites.map(e=>({title:e.name,value:e.id})),modelValue:u.value.selected_operating_sites,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value.selected_operating_sites=e),"error-messages":u.value.errors.selected_operating_sites,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Abteilungen",items:r.filterableGroups.map(e=>({title:e.name,value:e.id})),modelValue:u.value.selected_groups,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.selected_groups=e),"error-messages":u.value.errors.selected_groups,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Nutzer",items:r.users.map(e=>({title:e.first_name+" "+e.last_name,value:e.id})),modelValue:u.value.selected_users,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.selected_users=e),"error-messages":u.value.errors.selected_users,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Abwesenheitsgrund",items:r.absenceTypes.map(e=>({title:e.name,value:e.id})),modelValue:u.value.selected_absence_types,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.selected_absence_types=e),"error-messages":u.value.errors.selected_absence_types,clearable:"",chips:"",multiple:""},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Abwesenheitsstatus",items:[{title:"Erstellt",value:"created"},{title:"Akzeptiert",value:"accepted"},{title:"Abgelehnt",value:"declined"}],modelValue:u.value.selected_statuses,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.selected_statuses=e),"error-messages":u.value.errors.selected_statuses,clearable:"",chips:"",multiple:""},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Ferien",clearable:"",chips:"",multiple:"",modelValue:u.value.selected_holidays,"onUpdate:modelValue":l[7]||(l[7]=e=>u.value.selected_holidays=e),"error-messages":u.value.errors.selected_holidays,items:Object.entries(r.all_federal_states).map(([e,_])=>({value:e,title:_}))},null,8,["modelValue","error-messages","items"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[P("div",Q,[s(n,{class:"me-2",color:"primary",variant:"flat",onClick:l[8]||(l[8]=f(e=>u.value.defaults(c).reset(),["stop"]))},{default:t(()=>[...l[21]||(l[21]=[o(" Zurücksetzen ",-1)])]),_:1}),s(n,{color:"primary",variant:"flat",onClick:f(e=>d.value=!1,["stop"])},{default:t(()=>[...l[22]||(l[22]=[o("Anwenden",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),s(B,{value:"groupFilter"},{default:t(()=>[s(S,{onSubmit:l[17]||(l[17]=f(e=>N(),["prevent"]))},{default:t(()=>[s(F,{class:"mt-2"},{default:t(()=>[s(i,{cols:"12",md:"6"},{default:t(()=>[s(F,null,{default:t(()=>[s(i,{cols:"12"},{default:t(()=>[s(R,{label:"Gruppename","model-value":typeof a.value.set=="object"&&a.value.set!==null?a.value.set.title:a.value.set??"","onUpdate:modelValue":l[9]||(l[9]=e=>{a.value.set=e}),"error-messages":a.value.errors.set},null,8,["model-value","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Nutzer",items:r.users.map(e=>({title:e.first_name+" "+e.last_name,value:e.id})),modelValue:a.value.selected_users,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value.selected_users=e),"error-messages":a.value.errors.selected_users,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Betriebsstätten",items:r.filterableOperatingSites.map(e=>({title:e.name,value:e.id})),modelValue:a.value.selected_operating_sites,"onUpdate:modelValue":l[11]||(l[11]=e=>a.value.selected_operating_sites=e),"error-messages":a.value.errors.selected_operating_sites,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(v,{label:"Abteilungen",items:r.filterableGroups.map(e=>({title:e.name,value:e.id})),modelValue:a.value.selected_groups,"onUpdate:modelValue":l[12]||(l[12]=e=>a.value.selected_groups=e),"error-messages":a.value.errors.selected_groups,clearable:"",chips:"",multiple:"",variant:"underlined",autocomplete:"off"},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Abwesenheitsgrund",items:r.absenceTypes.map(e=>({title:e.name,value:e.id})),modelValue:a.value.selected_absence_types,"onUpdate:modelValue":l[13]||(l[13]=e=>a.value.selected_absence_types=e),"error-messages":a.value.errors.selected_absence_types,clearable:"",chips:"",multiple:""},null,8,["items","modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Abwesenheitsstatus",items:[{title:"Erstellt",value:"created"},{title:"Akzeptiert",value:"accepted"},{title:"Abgelehnt",value:"declined"}],modelValue:a.value.selected_statuses,"onUpdate:modelValue":l[14]||(l[14]=e=>a.value.selected_statuses=e),"error-messages":a.value.errors.selected_statuses,clearable:"",chips:"",multiple:""},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(p,{label:"Ferien",clearable:"",chips:"",multiple:"",modelValue:a.value.selected_holidays,"onUpdate:modelValue":l[15]||(l[15]=e=>a.value.selected_holidays=e),"error-messages":a.value.errors.selected_holidays,items:Object.entries(r.all_federal_states).map(([e,_])=>({value:e,title:_}))},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1})]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(W,{style:{height:"350px","overflow-y":"auto"},headers:[{title:"Gruppenübersicht",key:"name"},{title:"",key:"action",align:"end"}],items:r.userAbsenceFilters,"no-data-text":"Keine Filtergruppen vorhanden."},{"item.name":t(({item:e})=>[o(M(e.name.length>25?e.name.substring(0,25)+"...":e.name),1)]),"item.action":t(({item:e})=>[s(F,null,{default:t(()=>[s(i,{class:"text-end"},{default:t(()=>[s(n,{size:m(k).smAndDown.value?"small":void 0,class:"me-2",variant:"flat",color:"primary",onClick:f(_=>O(e),["stop"])},{default:t(()=>[s(A,null,{default:t(()=>[...l[23]||(l[23]=[o("mdi-pencil",-1)])]),_:1})]),_:1},8,["size","onClick"]),s(n,{size:m(k).smAndDown.value?"small":void 0,variant:"flat",color:"error",loading:m(V).processing&&m(V).filter_id==e.id,onClick:f(_=>{m(V).filter_id=e.id,m(V).delete(r.route("userAbsenceFilter.destroy",{userAbsenceFilter:e.id}),{onSuccess:()=>{a.value.defaults(c).reset()}})},["stop"])},{default:t(()=>[s(A,null,{default:t(()=>[...l[24]||(l[24]=[o("mdi-delete",-1)])]),_:1})]),_:1},8,["size","loading","onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["items"])]),_:1}),s(i,{cols:"12",class:"text-end"},{default:t(()=>[s(n,{class:"me-2",color:"primary",variant:"flat",onClick:l[16]||(l[16]=f(e=>a.value.defaults(c).reset(),["stop"]))},{default:t(()=>[...l[25]||(l[25]=[o(" Zurücksetzen ",-1)])]),_:1}),s(n,{disabled:!a.value.isDirty,color:"primary",type:"submit",loading:a.value.processing},{default:t(()=>[o(M(typeof a.value.set=="string"||a.value.set==null?"Anlegen":"Bearbeiten"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1024)]),_:1}))}});export{Y as _};
