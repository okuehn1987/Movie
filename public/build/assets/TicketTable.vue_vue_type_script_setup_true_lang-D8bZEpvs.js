import{d as _,r as b,a as o,b as l,e as r,g as p,z as S,h as a,s as V,f as m,m as v,p as w,t as k,v as g,q as N,D as y,j as $,P as C,V as M}from"./app-DpJhE1MF.js";import{_ as F}from"./TicketCreateDialog.vue_vue_type_script_setup_true_lang-CHYmXQlK.js";import{_ as I}from"./TicketShowDialog.vue_vue_type_script_setup_true_lang-3v26VkmV.js";import{_ as B}from"./RecordCreateDialog.vue_vue_type_script_setup_true_lang-DAP2M_Jw.js";import{_ as D}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-SfFLKm36.js";import{P as c}from"./types-BVvW7sCV.js";import{_ as H}from"./TicketFinishDialog.vue_vue_type_script_setup_true_lang-BYQT2NH-.js";import{u as L}from"./utils-BTSF0Lgh.js";const P={class:"d-flex ga-2 align-center"},Q=_({__name:"TicketTable",props:{tickets:{},customers:{},users:{},tab:{},operatingSites:{}},setup(E){const d=b(""),h=L(48),T=useForm({});return(t,f)=>(l(),o(M,null,{default:r(()=>[p(S,{style:V({maxHeight:a(h)}),"fixed-header":"",headers:[{title:"Prio",key:"priorityText",width:"1px"},{title:"Ticket",key:"reference_number",width:"1px"},{title:"Erstellt",key:"created_at",width:"1px"},{title:"Ersteller",key:"user.name"},{title:"Titel",key:"title"},{title:"Kunde",key:"customer.name"},{title:"Termin",key:"appointment_at"},{title:"Zugewiesen an",key:"assigneeName"},{title:"",key:"actions",align:"end",sortable:!1,width:"280px"}],items:t.tickets.map(e=>{var n,u;const i=(()=>{if(e.assignees.length==0)return null;const s=e.assignees[0];return e.assignees.length==1?s.first_name+" "+s.last_name:`${s.first_name} ${s.last_name} (+${e.assignees.length-1} weitere)`})();return{...e,user:{...e.user,name:e.user.first_name+" "+e.user.last_name},assigneeName:i,priorityText:(n=a(c).find(s=>s.value===e.priority))==null?void 0:n.title,priorityValue:(u=a(c).find(s=>s.value===e.priority))==null?void 0:u.priorityValue,assigneesNames:e.assignees.map(s=>s.first_name+s.last_name).join("")}}).filter(e=>{const i=d.value.replace(/\W/gi,"").toLowerCase();return(e.title+e.customer.name+e.user.name+e.assigneesNames+e.priorityText+e.reference_number).toLowerCase().replace(/\W/gi,"").includes(i)}),hover:""},{"header.actions":r(()=>[$("div",P,[p(C,{modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=e=>d.value=e),placeholder:"Suche",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"]),t.tab==="newTickets"?(l(),o(F,{key:0,customers:t.customers,users:t.users,operatingSites:t.operatingSites},null,8,["customers","users","operatingSites"])):m("",!0)])]),"item.created_at":r(({item:e})=>[k(g(a(y).fromISO(e.created_at).toFormat("dd.MM.yyyy")),1)]),"item.appointment_at":r(({item:e})=>[k(g(e.appointment_at?a(y).fromSQL(e.appointment_at).toFormat("dd.MM. 'um' HH:mm 'Uhr'"):"-"),1)]),"item.priorityText":r(({item:e})=>{var i,n,u;return[p(N,{title:(i=a(c).find(s=>s.value===e.priority))==null?void 0:i.title,icon:(n=a(c).find(s=>s.value===e.priority))==null?void 0:n.icon,color:(u=a(c).find(s=>s.value===e.priority))==null?void 0:u.color},null,8,["title","icon","color"])]}),"item.assigneeName":r(({item:e})=>[k(g(e.assigneeName),1)]),"item.actions":r(({item:e})=>[["newTickets","workingTickets"].includes(t.tab)&&!e.assignees.find(i=>i.pivot.status==="accepted"&&i.pivot.user_id===t.$page.props.auth.user.id)?(l(),o(v,{key:0,icon:"mdi-handshake",variant:"text",color:"primary",title:"Ticket übernehmen",onClick:w(i=>a(T).patch(t.route("ticket.accept",{ticket:e.id})),["stop"])},null,8,["onClick"])):m("",!0),["workingTickets","finishedTickets"].includes(t.tab)?(l(),o(H,{key:1,tab:t.tab,item:e},null,8,["tab","item"])):m("",!0),t.tab==="workingTickets"?(l(),o(B,{key:2,ticket:e,users:t.users,operatingSites:t.operatingSites},null,8,["ticket","users","operatingSites"])):m("",!0),p(I,{ticket:e,customers:t.customers,users:t.users,tab:t.tab,operatingSites:t.operatingSites},null,8,["ticket","customers","users","tab","operatingSites"]),t.tab==="newTickets"&&t.can("ticket","delete",e)?(l(),o(D,{key:3,content:"Möchtest du dieses Ticket löschen?",title:"Löschen",route:t.route("ticket.destroy",{ticket:e.id})},null,8,["route"])):m("",!0)]),_:1},8,["style","items"])]),_:1}))}});export{Q as _};
