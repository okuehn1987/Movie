import{d as J,r as m,D as g,c as E,w as I,o as u,a as v,b as o,e as D,f as n,V as j,g as d,h as K,i as c,m as W,j as b,k as M,l as B,n as X,p as F,q as Y,u as i,s as Z,t as z,v as p,x,y as ee,z as te,A as se,B as le,C as ae,F as U,G as ne}from"./app-BdR2tAKd.js";import{_ as re}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DW3Bglyy.js";import{u as oe,t as ie}from"./utils-CdvvTmH1.js";import{_ as ue,g as de}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-CTjcr3Nt.js";import{_ as ce}from"./EditCreateAbsence.vue_vue_type_script_setup_true_lang-voQtbCxJ.js";import{_ as me}from"./ShowAbsenceModal.vue_vue_type_script_setup_true_lang-KnFRGNu4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={class:"d-flex flex-wrap justify-space-between align-center"},pe={class:"d-flex justify-space-between"},fe={key:1},ve={class:"d-flex flex-wrap align-center"},be={class:"d-flex"},_e={class:"mx-4 text-center",style:{"min-width":"170px"}},he={class:"d-flex"},ke={key:0},ge={key:0},Me={key:1},De=J({__name:"AbsenceIndex",props:{users:{},absences:{},absencePatches:{},absence_types:{},holidays:{},user_absence_filters:{}},setup(L){const y=L,$=route().params.date,r=m($?g.fromFormat($,"yyyy-MM"):g.now()),O=E(()=>[].concat(y.absencePatches.filter(e=>e.start<=r.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=r.value.startOf("month").toFormat("yyyy-MM-dd"))).concat(y.absences.filter(e=>e.start<=r.value.endOf("month").toFormat("yyyy-MM-dd")&&e.end>=r.value.startOf("month").toFormat("yyyy-MM-dd"))).filter(e=>(l.selected_users.length==0||l.selected_users.includes(e.user_id))&&(l.selected_absence_types.length==0||!e.absence_type_id||l.selected_absence_types.includes(e.absence_type_id))&&(l.selected_statuses.length==0||l.selected_statuses.includes(e.status)))),_=m(!1),A=m(!1),f=m(null),h=m(null),P=m(null),N=E(()=>y.users.find(s=>{var e;return s.id===((e=f.value)==null?void 0:e.user_id)})),C=(()=>{var s,e;return route().params.openAbsence?((s=y.absences)==null?void 0:s.find(t=>t.id==Number(route().params.openAbsence)))??null:route().params.openAbsencePatch?((e=y.absencePatches)==null?void 0:e.find(t=>t.id==Number(route().params.openAbsencePatch)))??null:null})();C&&(f.value=C,h.value=C.user_id,_.value=!0);const l=useForm({set:null,selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]});I(()=>l.set,s=>{if(s==null)return;let e;if(typeof s=="object"&&l.isDirty?e=y.user_absence_filters.find(a=>a.id==s.value):typeof s=="string"&&(e=y.user_absence_filters.find(a=>a.name==s)),!e)return;const t={set:typeof s=="string"?{title:s,value:e.id}:s,selected_users:e.data.user_ids,selected_absence_types:e.data.absence_type_ids,selected_statuses:e.data.statuses};l.defaults(t),l.reset()});function T(s,e){h.value=s;const t=O.value.filter(a=>a.user_id===s).find(a=>e&&g.fromSQL(a.start)<=e&&e<=g.fromSQL(a.end));P.value=e??null,f.value=t??null,t&&["hasOpenPatch","created"].includes(de(t))?A.value=!0:_.value=!0}function H(){const s=[];for(let e=1;e<=r.value.daysInMonth;e++)s.push(r.value.startOf("month").plus({day:e-1}));return s}const V=m([r.value.toFormat("yyyy-MM")]),w=m(!1),q=ie(()=>{V.value.includes(r.value.toFormat("yyyy-MM"))||ne.reload({only:["absences","holidays"],data:{date:r.value.toFormat("yyyy-MM")},onStart:()=>{V.value.push(r.value.toFormat("yyyy-MM")),w.value=!0},onError:()=>V.value=V.value.filter(s=>s!=r.value.toFormat("yyyy-MM")),onFinish:()=>w.value=!1})},500);I(r,q);const G=oe(81);function Q(){var s;typeof l.set!="string"&&((s=l.set)!=null&&s.value)?l.patch(route("userAbsenceFilter.update",{userAbsenceFilter:l.set.value})):l.post(route("userAbsenceFilter.store"))}function R(){const s={set:"",selected_users:[],selected_absence_types:[],selected_statuses:["created","accepted"]};l.defaults(s),l.reset()}return(s,e)=>(u(),v(re,{title:"Abwesenheiten"},{default:o(()=>[_.value&&h.value?(u(),v(ce,{key:0,absence_types:s.absence_types,users:s.users,selectedAbsence:f.value,selectedDate:P.value,selectedUser:h.value,"onUpdate:selectedUser":e[0]||(e[0]=t=>h.value=t),modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t)},null,8,["absence_types","users","selectedAbsence","selectedDate","selectedUser","modelValue"])):D("",!0),A.value&&f.value&&N.value?(u(),v(me,{key:1,absence_types:s.absence_types,users:s.users,selectedAbsence:f.value,absenceUser:N.value,modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t)},null,8,["absence_types","users","selectedAbsence","absenceUser","modelValue"])):D("",!0),n(B,null,{default:o(()=>[n(j,null,{default:o(()=>[d("div",ye,[n(K,{"max-width":"1000"},{activator:o(({props:t})=>[n(c,W(t,{variant:"flat",color:"primary"}),{default:o(()=>[n(b,null,{default:o(()=>e[13]||(e[13]=[M("mdi-filter")])),_:1})]),_:2},1040)]),default:o(({isActive:t})=>[n(B,null,{title:o(()=>e[14]||(e[14]=[d("div",{class:"d-flex justify-space-between align-center w-100"},[d("span",null,"Abwesenheiten filtern")],-1)])),append:o(()=>[n(c,{icon:"",variant:"text",onClick:a=>t.value=!1},{default:o(()=>[n(b,null,{default:o(()=>e[15]||(e[15]=[M("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:o(()=>[n(j,null,{default:o(()=>[n(X,{onSubmit:e[8]||(e[8]=F(a=>Q(),["prevent"]))},{default:o(()=>[n(Y,{label:"Auswahl Filtergruppe","auto-select-first":"exact",variant:"underlined",items:s.user_absence_filters.map(a=>({value:a.id,title:a.name})),modelValue:i(l).set,"onUpdate:modelValue":e[3]||(e[3]=a=>i(l).set=a),"error-messages":i(l).errors.set,required:"",clearable:""},null,8,["items","modelValue","error-messages"]),n(Z,{label:"Nutzer",items:s.users.map(a=>({title:a.first_name+" "+a.last_name,value:a.id})),modelValue:i(l).selected_users,"onUpdate:modelValue":e[4]||(e[4]=a=>i(l).selected_users=a),clearable:"",chips:"",multiple:"",variant:"underlined"},null,8,["items","modelValue"]),n(z,{label:"Abwesenheitsgrund",items:s.absence_types.map(a=>({title:a.name,value:a.id})),modelValue:i(l).selected_absence_types,"onUpdate:modelValue":e[5]||(e[5]=a=>i(l).selected_absence_types=a),clearable:"",chips:"",multiple:""},null,8,["items","modelValue"]),n(z,{label:"Abwesenheitsstatus",items:[{title:"Erstellt",value:"created"},{title:"Akzeptiert",value:"accepted"},{title:"Abgelehnt",value:"declined"}],modelValue:i(l).selected_statuses,"onUpdate:modelValue":e[6]||(e[6]=a=>i(l).selected_statuses=a),clearable:"",chips:"",multiple:""},null,8,["modelValue"]),d("div",pe,[typeof i(l).set=="object"&&i(l).set!=null?(u(),v(c,{key:0,color:"error",onClick:e[7]||(e[7]=a=>{i(l).delete(s.route("userAbsenceFilter.destroy",{userAbsenceFilter:i(l).set.value}),{onSuccess:()=>{R()}})})},{default:o(()=>e[16]||(e[16]=[M(" Filter lÃ¶schen ")])),_:1})):(u(),p("div",fe)),n(c,{disabled:!i(l).isDirty,color:"primary",type:"submit"},{default:o(()=>[M(x(typeof i(l).set=="string"?"Filter anlegen":"Filter bearbeiten"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:2},1024)]),_:1}),d("div",ve,[d("div",be,[n(c,{onClick:e[9]||(e[9]=F(t=>r.value=r.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[n(b,{icon:"mdi-chevron-double-left"})]),_:1}),n(c,{onClick:e[10]||(e[10]=F(t=>r.value=r.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[n(b,{icon:"mdi-chevron-left"})]),_:1})]),d("h2",_e,[M(x(r.value.toFormat("MMMM yyyy"))+" ",1),w.value?(u(),v(ee,{key:0,indeterminate:""})):D("",!0)]),d("div",he,[n(c,{onClick:e[11]||(e[11]=F(t=>r.value=r.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[n(b,{icon:"mdi-chevron-right"})]),_:1}),n(c,{onClick:e[12]||(e[12]=F(t=>r.value=r.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:o(()=>[n(b,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[17]||(e[17]=d("div",{style:{width:"64px"}},null,-1))])]),_:1}),n(te),n(se,{"fixed-header":"",style:le([{"white-space":"pre"},{maxHeight:i(G)}]),id:"absence-table",items:s.users.filter(t=>i(l).selected_users.length==0||i(l).selected_users.includes(t.id)).map(t=>({...t,name:t.last_name+", "+t.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px",sortable:!1},...H().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center",width:"44px",headerProps:{class:{"bg-blue-darken-2":t.toISODate()===i(g).local().toISODate()}}}))]},{item:o(({item:t,columns:a})=>[d("tr",null,[(u(!0),p(U,null,ae(a,k=>(u(),p(U,{key:k.key},[k.key==="name"?(u(),p("td",ke,x(t.first_name)+" "+x(t.last_name),1)):k.key==="action"?(u(),p(U,{key:1},[s.can("absence","create",t)?(u(),p("td",ge,[n(c,{icon:"mdi-plus",variant:"text",onClick:S=>s.can("absence","create",t)&&T(t.id)},null,8,["onClick"])])):(u(),p("td",Me))],64)):(u(),v(ue,{key:2,onClick:S=>s.can("absence","create",t)&&T(t.id,r.value.startOf("month").plus({day:+(k.key??0)-1})),holidays:s.holidays,absenceTypes:s.absence_types,user:t,date:r.value.startOf("month").plus({day:+(k.key??0)-1}),entries:O.value.filter(S=>S.user_id===t.id)},null,8,["onClick","holidays","absenceTypes","user","date","entries"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{De as default};
