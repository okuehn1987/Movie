import{P as u}from"./types-BVvW7sCV.js";import{e as U}from"./utils-SP1thiZ6.js";import{d as N,ar as H,a as y,o as h,b as a,f as c,y as M,g as r,k as b,e as $,a4 as A,s as f,t as p,p as C,D as _,V as I}from"./app-BqC0o-bR.js";import{_ as R}from"./TicketArchiveFilter.vue_vue_type_script_setup_true_lang-Bzo-UGIS.js";import{_ as w}from"./TicketShowDialog.vue_vue_type_script_setup_true_lang-DONMqggv.js";import{_ as D}from"./TicketFinishDialog.vue_vue_type_script_setup_true_lang-DFYbHd7G.js";const Q=N({__name:"TicketArchiveTable",props:{archiveTickets:{},customers:{},users:{},operatingSites:{}},setup(k){const v=k,{currentPage:l,lastPage:g,data:V,itemsPerPage:P}=U(H(v),"archiveTickets",{tab:"archive"});function T(s){const o=s.sort((n,i)=>n.accounted_at?i.accounted_at?i.accounted_at.localeCompare(n.accounted_at):-1:1);if(!o[0])return"-";const e=_.fromSQL(o[0].accounted_at??"");return e.isValid?e.toFormat("dd.MM.yyyy HH:mm"):"-"}return(s,o)=>(h(),y(I,null,{default:a(()=>[c(M,{"fixed-header":"",page:r(l),"onUpdate:page":o[1]||(o[1]=e=>b(l)?l.value=e:null),itemsPerPage:r(P),headers:[{title:"Ticket",key:"reference_number",width:"100px",sortable:!1},{title:"Erstellt am",key:"created_at",sortable:!1},{title:"Titel",key:"title",sortable:!1},{title:"Kunde",key:"customer.name",sortable:!1},{title:"Abgeschlossen",key:"finished_at",sortable:!1},{title:"Bearbeitet von",key:"recordUserName",sortable:!1},{title:"Abgerechnet am",key:"accounted_at",sortable:!1},{title:"",key:"actions",align:"end",width:"250px",sortable:!1}],items:r(V).map(e=>{var i,m;const n=(()=>{const t=e.records.map(S=>S.user);if(t.length==0)return null;const d=t[0];return t.length==1?d.first_name+" "+d.last_name:`${d.first_name} ${d.last_name} (+${t.length-1} weitere)`})();return{...e,user:{...e.user,name:e.user.first_name+" "+e.user.last_name},recordUserName:n,priorityText:(i=r(u).find(t=>t.value===e.priority))==null?void 0:i.title,priorityValue:(m=r(u).find(t=>t.value===e.priority))==null?void 0:m.priorityValue,assigneesNames:e.assignees.map(t=>t.first_name+t.last_name).join("")}}),hover:""},{"header.actions":a(()=>[c(R,{customers:s.customers,users:s.users,"operating-sites":s.operatingSites},null,8,["customers","users","operating-sites"])]),"item.created_at":a(({item:e})=>[f(p(r(_).fromISO(e.created_at).toFormat("dd.MM. 'um' HH:mm 'Uhr'")),1)]),"item.finished_at":a(({item:e})=>[f(p(e.finished_at?r(_).fromSQL(e.finished_at).toFormat("dd.MM. 'um' HH:mm 'Uhr'"):"-"),1)]),"item.priorityText":a(({item:e})=>{var n,i,m;return[c(C,{title:(n=r(u).find(t=>t.value===e.priority))==null?void 0:n.title,icon:(i=r(u).find(t=>t.value===e.priority))==null?void 0:i.icon,color:(m=r(u).find(t=>t.value===e.priority))==null?void 0:m.color},null,8,["title","icon","color"])]}),"item.recordUserName":a(({item:e})=>[f(p(e.recordUserName),1)]),"item.accounted_at":a(({item:e})=>[f(p(T(e.records)),1)]),"item.actions":a(({item:e})=>[c(D,{tab:"archive",item:e},null,8,["item"]),c(w,{ticket:e,customers:s.customers,users:s.users,tab:"archive",operatingSites:s.operatingSites},null,8,["ticket","customers","users","operatingSites"])]),bottom:a(()=>[r(g)>1?(h(),y(A,{key:0,modelValue:r(l),"onUpdate:modelValue":o[0]||(o[0]=e=>b(l)?l.value=e:null),length:r(g)},null,8,["modelValue","length"])):$("",!0)]),_:1},8,["page","itemsPerPage","items"])]),_:1}))}});export{Q as _};
