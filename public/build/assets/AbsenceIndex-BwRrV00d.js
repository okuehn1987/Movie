import{d as P,n as U,r as x,D as p,C as H,w as j,o as i,c as b,a as s,b as a,V as D,u as r,e as m,f,g,h as C,i as z,t as V,j as I,k as E,l as v,m as G,p as k,q as Q,s as B,v as q,x as y,y as R,z as J,A as K,B as W,E as c,F as X,G as w,H as Y}from"./app-Bcnebe7g.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BnLqlW9w.js";import{u as ee,g as ae,t as te}from"./utils-C_pjOZmg.js";import{_ as se}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-DwocZVSF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"d-flex flex-wrap justify-center align-center"},ne={class:"d-flex flex-wrap align-center"},oe={class:"d-flex"},re={class:"mx-4 text-center",style:{"min-width":"170px"}},de={class:"d-flex"},ie={key:0},ue={key:0},me={key:1},_e=P({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{},holidays:{}},setup(O){const A=O,S=U(),F=route().params.date,n=x(F?p.fromFormat(F,"yyyy-MM"):p.now());function T(){const d=[];for(let e=1;e<=n.value.daysInMonth;e++)d.push(n.value.startOf("month").plus({day:e-1}));return d}const h=x(!1),o=H({user_id:S.props.auth.user.id,start:null,end:null,absence_type_id:null});function $(d,e){o.reset();const t=A.absences.filter(u=>u.user_id===d).find(u=>e&&p.fromSQL(u.start)<=e&&e<=p.fromSQL(u.end));o.user_id=d,o.start=(e??n.value.startOf("month")).toFormat("yyyy-MM-dd"),o.end=(e??n.value.startOf("month")).toFormat("yyyy-MM-dd"),o.absence_type_id=(t==null?void 0:t.absence_type_id)??null,h.value=!0}const _=x([n.value.toFormat("yyyy-MM")]),L=te(()=>{_.value.includes(n.value.toFormat("yyyy-MM"))||Y.reload({only:["absences","holidays"],data:{date:n.value.toFormat("yyyy-MM")},onStart:()=>_.value.push(n.value.toFormat("yyyy-MM")),onError:()=>_.value=_.value.filter(d=>d!=n.value.toFormat("yyyy-MM"))})},500);j(n,L);const N=ee();return(d,e)=>(i(),b(Z,{title:"Abwesenheiten"},{default:s(()=>[a(q,{"max-width":"1000",modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t)},{default:s(({isActive:t})=>{var u;return[a(D,{title:"Abwesenheit"+(r(o).user_id!=r(S).props.auth.user.id?" von "+((u=d.users.map(l=>({...l,name:l.first_name+" "+l.last_name})).find(l=>l.id===r(o).user_id))==null?void 0:u.name):"")+" beantragen"},{append:s(()=>[a(m,{icon:"",variant:"text",onClick:l=>t.value=!1},{default:s(()=>[a(f,null,{default:s(()=>e[8]||(e[8]=[g("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[r(o).errors.user_id?(i(),b(C,{key:0},{default:s(()=>[a(z,{color:"error",closable:""},{default:s(()=>[g(V(r(o).errors.user_id),1)]),_:1})]),_:1})):I("",!0),a(C,null,{default:s(()=>[a(E,{onSubmit:v(l=>{r(o).post(d.route("absence.store"),{onSuccess:()=>{r(o).reset(),t.value=!1}})},["prevent"])},{default:s(()=>[a(G,null,{default:s(()=>[a(k,{cols:"12"},{default:s(()=>[a(Q,{label:"Abwesenheitsgrund angeben",items:d.absence_types.map(l=>({title:l.name,value:l.id})),modelValue:r(o).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=l=>r(o).absence_type_id=l),"error-messages":r(o).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),a(k,{cols:"12",md:"6"},{default:s(()=>[a(B,{type:"date",label:"Von",modelValue:r(o).start,"onUpdate:modelValue":e[1]||(e[1]=l=>r(o).start=l),"error-messages":r(o).errors.start},null,8,["modelValue","error-messages"])]),_:1}),a(k,{cols:"12",md:"6"},{default:s(()=>[a(B,{type:"date",label:"Bis",modelValue:r(o).end,"onUpdate:modelValue":e[2]||(e[2]=l=>r(o).end=l),"error-messages":r(o).errors.end},null,8,["modelValue","error-messages"])]),_:1}),a(k,{cols:"12",class:"text-end"},{default:s(()=>[a(m,{loading:r(o).processing,type:"submit",color:"primary"},{default:s(()=>e[9]||(e[9]=[g("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),a(D,null,{default:s(()=>[a(C,null,{default:s(()=>[y("div",le,[y("div",ne,[y("div",oe,[a(m,{onClick:e[4]||(e[4]=v(t=>n.value=n.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(f,{icon:"mdi-chevron-double-left"})]),_:1}),a(m,{onClick:e[5]||(e[5]=v(t=>n.value=n.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(f,{icon:"mdi-chevron-left"})]),_:1})]),y("h2",re,[g(V(n.value.toFormat("MMMM yyyy"))+" ",1),r(N)?(i(),b(R,{key:0,indeterminate:""})):I("",!0)]),y("div",de,[a(m,{onClick:e[6]||(e[6]=v(t=>n.value=n.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(f,{icon:"mdi-chevron-right"})]),_:1}),a(m,{onClick:e[7]||(e[7]=v(t=>n.value=n.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(f,{icon:"mdi-chevron-double-right"})]),_:1})])])])]),_:1}),a(J),a(K,{"fixed-header":"",style:W([{"white-space":"pre"},{maxHeight:r(ae)(81)}]),id:"absence-table",items:d.users,headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...T().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":t.toISODate()===r(p).local().toISODate()}}}))]},{item:s(({item:t,columns:u})=>[y("tr",null,[(i(!0),c(w,null,X(u,l=>(i(),c(w,{key:l.key},[l.key==="name"?(i(),c("td",ie,V(t.first_name)+" "+V(t.last_name),1)):l.key==="action"?(i(),c(w,{key:1},[d.can("absence","create",t)?(i(),c("td",ue,[a(m,{icon:"mdi-plus",variant:"text",onClick:M=>d.can("absence","create",t)&&$(t.id)},null,8,["onClick"])])):(i(),c("td",me))],64)):(i(),b(se,{key:2,onClick:M=>d.can("absence","create",t)&&$(t.id,n.value.startOf("month").plus({day:+(l.key??0)-1})),holidays:d.holidays,absenceTypes:d.absence_types,user:t,date:n.value.startOf("month").plus({day:+(l.key??0)-1}),absences:d.absences.filter(M=>M.user_id===t.id)},null,8,["onClick","holidays","absenceTypes","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{_e as default};
