import{d as H,n as j,r as x,D as f,C as z,w as E,a as G,o as d,c as k,b as s,e as a,V as A,u as o,f as y,g as v,h as w,i as C,j as J,t as V,k as L,l as Q,m as _,p as q,q as h,s as R,v as K,x as u,y as W,z as X,A as Y,B as Z,E as p,F as ee,G as S,H as ae}from"./app-cAe7VMGE.js";import{_ as te}from"./AdminLayout.vue_vue_type_script_setup_true_lang-CdhovkqZ.js";import{u as se,g as le,t as ne}from"./utils-CCf13J20.js";import{_ as oe}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-Bnb3Sow1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"d-flex flex-wrap justify-space-between align-center"},ie={style:{width:"30px"}},de={class:"d-flex flex-wrap align-center"},ue={class:"d-flex"},me={class:"mx-4 text-center",style:{"min-width":"170px"}},ye={class:"d-flex"},ce={key:0},pe={key:0},fe={key:1},Ve=H({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{},holidays:{}},setup(N){const O=N,D=j(),F=route().params.date,r=x(F?f.fromFormat(F,"yyyy-MM"):f.now());function T(){const i=[];for(let e=1;e<=r.value.daysInMonth;e++)i.push(r.value.startOf("month").plus({day:e-1}));return i}const M=x(!1),n=z({user_id:D.props.auth.user.id,start:null,end:null,absence_type_id:null});function $(i,e){n.reset();const c=O.absences.filter(t=>t.user_id===i).find(t=>e&&f.fromSQL(t.start)<=e&&e<=f.fromSQL(t.end));n.user_id=i,n.end=(e==null?void 0:e.toJSDate())??null,n.start=(e==null?void 0:e.toJSDate())??null,n.absence_type_id=(c==null?void 0:c.absence_type_id)??null,M.value=!0}const b=x([r.value.toFormat("yyyy-MM")]),P=ne(()=>{b.value.includes(r.value.toFormat("yyyy-MM"))||ae.reload({only:["absences","holidays"],data:{date:r.value.toFormat("yyyy-MM")},onStart:()=>b.value.push(r.value.toFormat("yyyy-MM")),onError:()=>b.value=b.value.filter(i=>i!=r.value.toFormat("yyyy-MM"))})},500);E(r,P);const U=se();return(i,e)=>{const c=G("v-date-input");return d(),k(te,{title:"Abwesenheiten"},{default:s(()=>[a(K,{"max-width":"1000",modelValue:M.value,"onUpdate:modelValue":e[3]||(e[3]=t=>M.value=t)},{default:s(({isActive:t})=>{var g;return[a(A,{title:"Abwesenheit"+(o(n).user_id!=o(D).props.auth.user.id?" von "+((g=i.users.map(l=>({...l,name:l.first_name+" "+l.last_name})).find(l=>l.id===o(n).user_id))==null?void 0:g.name):"")+" beantragen"},{append:s(()=>[a(y,{icon:"",variant:"text",onClick:l=>t.value=!1},{default:s(()=>[a(v,null,{default:s(()=>e[8]||(e[8]=[w("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[o(n).errors.user_id?(d(),k(C,{key:0},{default:s(()=>[a(J,{color:"error",closable:""},{default:s(()=>[w(V(o(n).errors.user_id),1)]),_:1})]),_:1})):L("",!0),a(C,null,{default:s(()=>[a(Q,{onSubmit:_(l=>{o(n).transform(m=>{var I,B;return{...m,start:(I=m.start)==null?void 0:I.toLocaleDateString(),end:(B=m.end)==null?void 0:B.toLocaleDateString()}}).post(i.route("absence.store"),{onSuccess:()=>{o(n).reset(),t.value=!1}})},["prevent"])},{default:s(()=>[a(q,null,{default:s(()=>[a(h,{cols:"12"},{default:s(()=>[a(R,{label:"Abwesenheitsgrund angeben",items:i.absence_types.map(l=>({title:l.name,value:l.id})),modelValue:o(n).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=l=>o(n).absence_type_id=l),"error-messages":o(n).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),a(h,{cols:"12",md:"6"},{default:s(()=>[a(c,{label:"Von",modelValue:o(n).start,"onUpdate:modelValue":e[1]||(e[1]=l=>o(n).start=l),"error-messages":o(n).errors.start},null,8,["modelValue","error-messages"])]),_:1}),a(h,{cols:"12",md:"6"},{default:s(()=>[a(c,{label:"Bis",modelValue:o(n).end,"onUpdate:modelValue":e[2]||(e[2]=l=>o(n).end=l),"error-messages":o(n).errors.end},null,8,["modelValue","error-messages"])]),_:1}),a(h,{cols:"12",class:"text-end"},{default:s(()=>[a(y,{loading:o(n).processing,type:"submit",color:"primary"},{default:s(()=>e[9]||(e[9]=[w("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),a(A,null,{default:s(()=>[a(C,null,{default:s(()=>[u("div",re,[u("div",ie,[o(U)?(d(),k(W,{key:0,indeterminate:""})):L("",!0)]),u("div",de,[u("div",ue,[a(y,{onClick:e[4]||(e[4]=_(t=>r.value=r.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(v,{icon:"mdi-chevron-double-left"})]),_:1}),a(y,{onClick:e[5]||(e[5]=_(t=>r.value=r.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(v,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",me,V(r.value.toFormat("MMMM yyyy")),1),u("div",ye,[a(y,{onClick:e[6]||(e[6]=_(t=>r.value=r.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(v,{icon:"mdi-chevron-right"})]),_:1}),a(y,{onClick:e[7]||(e[7]=_(t=>r.value=r.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[a(v,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[10]||(e[10]=u("div",{style:{width:"30px"}},null,-1))])]),_:1}),a(X),a(Y,{"fixed-header":"",style:Z([{"white-space":"pre"},{maxHeight:o(le)(81)}]),id:"absence-table",items:i.users,headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...T().map(t=>({title:t.weekdayShort+`
`+t.day.toString(),key:t.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":t.toISODate()===o(f).local().toISODate()}}}))]},{item:s(({item:t,columns:g})=>[u("tr",null,[(d(!0),p(S,null,ee(g,l=>(d(),p(S,{key:l.key},[l.key==="name"?(d(),p("td",ce,V(t.first_name)+" "+V(t.last_name),1)):l.key==="action"?(d(),p(S,{key:1},[i.can("absence","create",t)?(d(),p("td",pe,[a(y,{icon:"mdi-plus",variant:"text",onClick:m=>i.can("absence","create",t)&&$(t.id)},null,8,["onClick"])])):(d(),p("td",fe))],64)):(d(),k(oe,{key:2,onClick:m=>i.can("absence","create",t)&&$(t.id,r.value.startOf("month").plus({day:+(l.key??0)-1})),holidays:i.holidays,absenceTypes:i.absence_types,user:t,date:r.value.startOf("month").plus({day:+(l.key??0)-1}),absences:i.absences.filter(m=>m.user_id===t.id)},null,8,["onClick","holidays","absenceTypes","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1})}}});export{Ve as default};
