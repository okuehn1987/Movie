import{d as O,Q,r as $,D as x,T as j,w as z,a as H,o as d,c as _,b as s,e as t,V as B,u as o,f as c,g as f,h,i as w,j as J,t as b,k as F,l as P,m as y,n as q,p as g,q as E,s as R,v as u,x as G,y as K,z as W,A as X,B as V,C as Y,F as A,E as Z}from"./app-DZ-hi0sD.js";import{_ as ee}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DWejfF7z.js";import{u as te,g as ae,t as se}from"./utils-Dp1CKuL8.js";import{_ as ne}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-Didr-mdQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"d-flex flex-wrap justify-space-between align-center"},oe={style:{width:"30px"}},re={class:"d-flex flex-wrap align-center"},ie={class:"d-flex"},de={class:"mx-4 text-center",style:{"min-width":"170px"}},ue={class:"d-flex"},me={key:0},ce={key:1},be=O({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{}},setup(I){const L=I,C=Q(),r=$(x.now());function N(){const i=[];for(let e=1;e<=r.value.daysInMonth;e++)i.push(r.value.startOf("month").plus({day:e-1}));return i}const k=$(!1),l=j({user_id:C.props.auth.user.id,start:null,end:null,absence_type_id:null});function S(i,e){l.reset();const p=L.absences.filter(a=>a.user_id===i).find(a=>e&&x.fromSQL(a.start)<=e&&e<=x.fromSQL(a.end));l.user_id=i,l.end=(e==null?void 0:e.toJSDate())??null,l.start=(e==null?void 0:e.toJSDate())??null,l.absence_type_id=(p==null?void 0:p.absence_type_id)??null,k.value=!0}const T=se(()=>Z.reload({only:["absences"],data:{date:r.value.toFormat("yyyy-MM")}}),500);z(r,T);const U=te();return(i,e)=>{const p=H("v-date-input");return d(),_(ee,{title:"Abwesenheiten"},{default:s(()=>[t(R,{"max-width":"1000",modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=a=>k.value=a)},{default:s(({isActive:a})=>{var v;return[t(B,{title:"Abwesenheit"+(o(l).user_id!=o(C).props.auth.user.id?" von "+((v=i.users.map(n=>({...n,name:n.first_name+" "+n.last_name})).find(n=>n.id===o(l).user_id))==null?void 0:v.name):"")+" beantragen"},{append:s(()=>[t(c,{icon:"",variant:"text",onClick:n=>a.value=!1},{default:s(()=>[t(f,null,{default:s(()=>e[8]||(e[8]=[h("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[o(l).errors.user_id?(d(),_(w,{key:0},{default:s(()=>[t(J,{color:"error",closable:""},{default:s(()=>[h(b(o(l).errors.user_id),1)]),_:1})]),_:1})):F("",!0),t(w,null,{default:s(()=>[t(P,{onSubmit:y(n=>{o(l).transform(m=>{var M,D;return{...m,start:(M=m.start)==null?void 0:M.toLocaleDateString(),end:(D=m.end)==null?void 0:D.toLocaleDateString()}}).post(i.route("absence.store"),{onSuccess:()=>{o(l).reset(),a.value=!1}})},["prevent"])},{default:s(()=>[t(q,null,{default:s(()=>[t(g,{cols:"12"},{default:s(()=>[t(E,{label:"Abwesenheitsgrund angeben",items:i.absence_types.map(n=>({title:n.name,value:n.id})),modelValue:o(l).absence_type_id,"onUpdate:modelValue":e[0]||(e[0]=n=>o(l).absence_type_id=n),"error-messages":o(l).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>[t(p,{label:"Von",modelValue:o(l).start,"onUpdate:modelValue":e[1]||(e[1]=n=>o(l).start=n),"error-messages":o(l).errors.start},null,8,["modelValue","error-messages"])]),_:1}),t(g,{cols:"12",md:"6"},{default:s(()=>[t(p,{label:"Bis",modelValue:o(l).end,"onUpdate:modelValue":e[2]||(e[2]=n=>o(l).end=n),"error-messages":o(l).errors.end},null,8,["modelValue","error-messages"])]),_:1}),t(g,{cols:"12",class:"text-end"},{default:s(()=>[t(c,{loading:o(l).processing,type:"submit",color:"primary"},{default:s(()=>e[9]||(e[9]=[h("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),t(B,null,{default:s(()=>[t(w,null,{default:s(()=>[u("div",le,[u("div",oe,[o(U)?(d(),_(G,{key:0,indeterminate:""})):F("",!0)]),u("div",re,[u("div",ie,[t(c,{onClick:e[4]||(e[4]=y(a=>r.value=r.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-left"})]),_:1}),t(c,{onClick:e[5]||(e[5]=y(a=>r.value=r.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-left"})]),_:1})]),u("h2",de,b(r.value.toFormat("MMMM yyyy")),1),u("div",ue,[t(c,{onClick:e[6]||(e[6]=y(a=>r.value=r.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-right"})]),_:1}),t(c,{onClick:e[7]||(e[7]=y(a=>r.value=r.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-right"})]),_:1})])]),e[10]||(e[10]=u("div",{style:{width:"30px"}},null,-1))])]),_:1}),t(K),t(W,{"fixed-header":"",style:X([{"white-space":"pre"},{maxHeight:o(ae)(80)}]),id:"absence-table",items:i.users,headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...N().map(a=>({title:a.weekdayShort+`
`+a.day.toString(),key:a.day.toString(),sortable:!1,align:"center"}))]},{item:s(({item:a,columns:v})=>[u("tr",null,[(d(!0),V(A,null,Y(v,n=>(d(),V(A,{key:n.key},[n.key==="name"?(d(),V("td",me,b(a.first_name)+" "+b(a.last_name),1)):n.key==="action"?(d(),V("td",ce,[t(c,{icon:"mdi-plus",variant:"text",onClick:m=>i.can("absence","create",a)&&S(a.id)},null,8,["onClick"])])):(d(),_(ne,{key:2,onClick:m=>i.can("absence","create",a)&&S(a.id,r.value.startOf("month").plus({day:+(n.key??0)-1})),user:a,date:r.value.startOf("month").plus({day:+(n.key??0)-1}),absences:i.absences.filter(m=>m.user_id===a.id)},null,8,["onClick","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1})}}});export{be as default};
