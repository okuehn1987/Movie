import{d as Z,C as G,E as H,c as C,T as x,D as v,a as f,b as o,e as r,g as d,V as ee,h as l,f as V,y as se,i as K,U as W,t as g,v as m,K as te,p as w,L as ae,M as k,N as le,P as h,W as re,j as i,k as b,F as A,A as D,m as M,q as ne,S as de}from"./app-75d7f0J7.js";const oe={class:"d-flex ga-2 justify-end"},be=Z({__name:"EditCreateAbsence",props:G({users:{},absenceTypes:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:G(["absenceReload"],["update:modelValue","update:selectedUser"]),setup(U,{emit:z}){var L,q,N,R,$,j,E;const B=z,n=U,_=H(U,"modelValue"),S=H(U,"selectedUser"),c=C(()=>n.users.find(t=>t.id===S.value)),s=useForm({user_id:((L=n.selectedAbsence)==null?void 0:L.user_id)??S.value,start:((q=n.selectedAbsence)==null?void 0:q.start)??((N=n.selectedDate)==null?void 0:N.toFormat("yyyy-MM-dd"))??null,end:((R=n.selectedAbsence)==null?void 0:R.end)??(($=n.selectedDate)==null?void 0:$.toFormat("yyyy-MM-dd"))??null,absence_type_id:((j=n.selectedAbsence)==null?void 0:j.absence_type_id)??null,absence_id:n.selectedAbsence&&"absence_id"in n.selectedAbsence?n.selectedAbsence.absence_id:((E=n.selectedAbsence)==null?void 0:E.id)??null});function J(){const t={onSuccess:()=>{s.reset(),_.value=!1,B("absenceReload")}};s.absence_type_id=="homeOffice"?s.post(route("homeOfficeDay.store"),t):s.absence_id?s.post(route("absence.absencePatch.store",{absence:s.absence_id}),t):s.post(route("absence.store"),t)}const T=useForm({});function O(){n.selectedAbsence&&T.delete(route("absence.destroy",{absence:"absence_id"in n.selectedAbsence?n.selectedAbsence.absence_id:n.selectedAbsence.id}),{onSuccess:()=>{_.value=!1,B("absenceReload")}})}const Y=C(()=>{const t=n.absenceTypes.find(a=>a.id===s.absence_type_id);return!n.selectedAbsence||(t==null?void 0:t.requires_approval)&&x().props.auth.user.supervisor_id}),p=C(()=>{const t=[];return s.start&&t.push(v.fromISO(s.start).year),s.end&&t.push(v.fromISO(s.end).year),t.length==0&&t.push(v.now().year),t.filter((a,y,F)=>F.indexOf(a)===y)});return(t,a)=>(o(),f(de,{"max-width":"1000",modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=y=>_.value=y)},{default:r(({isActive:y})=>{var F;return[d(ee,{title:"Abwesenheit"+(l(s).user_id!=t.$page.props.auth.user.id?" von "+((F=t.users.map(e=>({...e,name:e.first_name+" "+e.last_name})).find(e=>e.id===l(s).user_id))==null?void 0:F.name):"")+(t.can("absence","update",t.users.find(e=>e.id==l(s).user_id))||!Y.value?" bearbeiten":" beantragen")},{append:r(()=>[d(M,{icon:"",variant:"text",onClick:e=>{y.value=!1,l(s).reset()}},{default:r(()=>[d(ne,null,{default:r(()=>[...a[6]||(a[6]=[g("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:r(()=>[d(se),l(s).errors.user_id?(o(),f(K,{key:0},{default:r(()=>[d(W,{color:"error",closable:""},{default:r(()=>[g(m(l(s).errors.user_id),1)]),_:1})]),_:1})):V("",!0),d(K,null,{default:r(()=>[d(te,{onSubmit:w(J,["prevent"])},{default:r(()=>[d(ae,null,{default:r(()=>[d(k,{cols:"12"},{default:r(()=>{var e;return[d(le,{label:"Abwesenheitsgrund angeben",items:[...t.absenceTypes.map(u=>({title:u.name,value:u.id})),((e=c.value)==null?void 0:e.home_office)&&{title:"Homeoffice",value:"homeOffice"}].filter(Boolean),modelValue:l(s).absence_type_id,"onUpdate:modelValue":a[0]||(a[0]=u=>l(s).absence_type_id=u),"error-messages":l(s).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]}),_:1}),d(k,{cols:"12",md:"6"},{default:r(()=>[d(h,{type:"date",label:"Von",min:l(v).now().startOf("year").toFormat("yyyy-MM-dd"),modelValue:l(s).start,"onUpdate:modelValue":a[1]||(a[1]=e=>l(s).start=e),"error-messages":l(s).errors.start},null,8,["min","modelValue","error-messages"])]),_:1}),d(k,{cols:"12",md:"6"},{default:r(()=>[d(h,{type:"date",label:"Bis",min:l(v).now().startOf("year").toFormat("yyyy-MM-dd"),modelValue:l(s).end,"onUpdate:modelValue":a[2]||(a[2]=e=>l(s).end=e),"error-messages":l(s).errors.end},null,8,["min","modelValue","error-messages"])]),_:1}),!t.selectedAbsence&&c.value&&c.value.leaveDaysForYear&&p.value.length>0?(o(),f(W,{key:0,type:"info",class:"w-100"},{default:r(()=>[d(re,{class:"text-info"},{default:r(()=>[i("thead",null,[i("tr",null,[a[7]||(a[7]=i("td",null,null,-1)),(o(!0),b(A,null,D(p.value,e=>(o(),b("td",{key:e},m(e),1))),128))])]),i("tbody",null,[i("tr",null,[a[8]||(a[8]=i("td",null,"Genehmigte Urlaubstage",-1)),(o(!0),b(A,null,D(p.value,e=>{var u;return o(),b("td",{key:e},m(((u=c.value.usedLeaveDaysForYear[e])==null?void 0:u.accepted)??0),1)}),128))]),i("tr",null,[a[9]||(a[9]=i("td",null,"Beantragte Urlaubstage",-1)),(o(!0),b(A,null,D(p.value,e=>{var u;return o(),b("td",{key:e},m(((u=c.value.usedLeaveDaysForYear[e])==null?void 0:u.created)??0),1)}),128))]),i("tr",null,[a[10]||(a[10]=i("td",null,"Bereits verwendete Urlaubstage",-1)),(o(!0),b(A,null,D(p.value,e=>{var u,I,P;return o(),b("td",{key:e},m((((u=c.value.usedLeaveDaysForYear[e])==null?void 0:u.accepted)??0)+(((I=c.value.usedLeaveDaysForYear[e])==null?void 0:I.created)??0))+" von "+m(c.value.leaveDaysForYear[e]??((P=Object.entries(c.value.leaveDaysForYear).sort(([Q,ue],[X,ie])=>X.localeCompare(Q))[0])==null?void 0:P[1])??0),1)}),128))])])]),_:1})]),_:1})):V("",!0),d(k,{cols:"12"},{default:r(()=>[i("div",oe,[t.selectedAbsence?(o(),b(A,{key:0},[t.can("absence","update",t.users.find(e=>e.id==l(s).user_id))?(o(),f(M,{key:0,onClick:a[3]||(a[3]=w(e=>O(),["stop"])),color:"error",loading:l(T).processing},{default:r(()=>[...a[11]||(a[11]=[g(" löschen ",-1)])]),_:1},8,["loading"])):t.selectedAbsence.status!=="declined"?(o(),f(M,{key:1,onClick:a[4]||(a[4]=w(e=>O(),["stop"])),color:"error"},{default:r(()=>[...a[12]||(a[12]=[g(" Löschung beantragen ",-1)])]),_:1})):V("",!0)],64)):V("",!0),!t.selectedAbsence||t.selectedAbsence.status!=="declined"?(o(),f(M,{key:1,loading:l(s).processing,type:"submit",color:"primary",disabled:!l(s).isDirty},{default:r(()=>[g(m(t.can("absence","update",t.users.find(e=>e.id==l(s).user_id))||!Y.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])):V("",!0)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{be as _};
