import{d as O,U as T,r as w,G as P,aj as q,T as A,D as m,a as Q,o as k,c as v,b as l,e as i,P as B,u as s,f as h,m as y,k as C,O as E,X as W,s as z,V as x,g as R,h as L,i as $,l as K,n as j,p,I as D,Y as G,E as J}from"./app-DZ-hi0sD.js";import{_ as X}from"./AdminLayout.vue_vue_type_script_setup_true_lang-DWejfF7z.js";import{b as Y}from"./utils-Dp1CKuL8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=O({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(F){const V=F,{currentPage:b,lastPage:S,data:U}=Y(T(V),"workLogs"),g=w(!1),c=w(null),f=w(null),_=P(()=>f.value?"plain":"underlined"),I=P(()=>V.workLogs.data.filter((o,e)=>e<5));q(()=>{const o=route().params.workLog;if(o)return H(Number(o))});const t=A({id:-1,start:new Date,end:new Date,start_time:"",end_time:"",is_home_office:!1});function M(){t.transform(o=>{const e=m.fromFormat(o.start_time,"HH:mm"),n=m.fromFormat(o.end_time,"HH:mm");return{...o,start:m.fromISO(o.start.toISOString()).set({hour:e.hour,minute:e.minute}),end:m.fromISO(o.end.toISOString()).set({hour:n.hour,minute:n.minute}),workLog:t.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{t.reset(),g.value=!1}})}function H(o){const e=V.workLogs.data.find(u=>u.id===o);if(!e)return;const n=e.work_log_patches.at(-1);e.end?n?n&&n.status==="created"&&(f.value=n,c.value="show"):(f.value=null,c.value="edit"):(c.value="fix",f.value=e);let a=e.start,r=e.end,d=e.is_home_office;n&&n.status=="accepted"&&(a=n.start,r=n.end,d=n.is_home_office),t.id=o,t.start=new Date(a),t.end=r?new Date(r):new Date,t.start_time=m.fromSQL(a).toFormat("HH:mm"),t.end_time=m.fromSQL(r||m.now().toSQL()).toFormat("HH:mm"),t.is_home_office=d,g.value=!0}function N(){const o=V.workLogs.data.find(n=>n.id===t.id);if(!o)return;const e=o.work_log_patches.at(-1);e&&J.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{g.value=!1}})}return(o,e)=>{const n=Q("v-date-input");return k(),v(X,{title:o.user.first_name+" "+o.user.last_name,backurl:o.route().params.fromUserWorkLogs?o.route("workLog.index"):o.route("dashboard")},{default:l(()=>[i(x,null,{default:l(()=>[i(B,{headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"action",sortable:!1,align:"end"}],items:s(U).map(a=>({...a.work_log_patches.filter(d=>d.status==="accepted").toSorted((d,u)=>d.updated_at<u.updated_at?1:-1)[0]??a,id:a.id})).toSorted((a,r)=>a.start<r.start?1:-1).map(a=>{var r,d;return{start:s(m).fromSQL(a.start).toFormat("dd.MM.yyyy HH:mm"),end:a.end?s(m).fromSQL(a.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",is_home_office:a.is_home_office?"Ja":"Nein",id:a.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((d=(r=o.workLogs.data.find(u=>u.id===a.id))==null?void 0:r.work_log_patches.at(-1))==null?void 0:d.status)||"none"]}})},{"item.action":l(({item:a})=>{var r,d;return[I.value.find(u=>u.id===a.id)&&o.can("workLogPatch","update")?(k(),v(h,{key:0,color:"primary",onClick:y(u=>H(a.id),["stop"]),icon:((d=(r=o.workLogs.data.find(u=>u.id===a.id))==null?void 0:r.work_log_patches.at(-1))==null?void 0:d.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text"},null,8,["onClick","icon"])):C("",!0)]}),bottom:l(()=>[s(S)>1?(k(),v(E,{key:0,modelValue:s(b),"onUpdate:modelValue":e[0]||(e[0]=a=>W(b)?b.value=a:null),length:s(S)},null,8,["modelValue","length"])):C("",!0)]),_:1},8,["items"]),i(z,{"max-width":"1000",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a)},{default:l(({isActive:a})=>[i(x,{title:"Zeitkorrektur"},{append:l(()=>[i(h,{icon:"",variant:"text",onClick:r=>a.value=!1},{default:l(()=>[i(R,null,{default:l(()=>e[7]||(e[7]=[L("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:l(()=>[i($,null,{default:l(()=>[i(K,{onSubmit:y(M,["prevent"])},{default:l(()=>[i(j,null,{default:l(()=>[i(p,{cols:"12",md:"3"},{default:l(()=>[i(n,{disabled:c.value=="fix",label:"Start",required:"","error-messages":s(t).errors.start,modelValue:s(t).start,"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).start=r),variant:_.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(D,{disabled:c.value=="fix",type:"time",label:"Start",required:"","error-messages":s(t).errors.start_time,modelValue:s(t).start_time,"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).start_time=r),variant:_.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(n,{disabled:c.value=="fix",label:"Ende",required:"","error-messages":s(t).errors.end,modelValue:s(t).end,"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).end=r),variant:_.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(D,{disabled:!!f.value,type:"time",label:"Ende",required:"","error-messages":s(t).errors.end_time,modelValue:s(t).end_time,"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).end_time=r),variant:_.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(G,{disabled:!!f.value,label:"Homeoffice",required:"","error-messages":s(t).errors.is_home_office,modelValue:s(t).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).is_home_office=r),variant:_.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",class:"text-end"},{default:l(()=>[f.value?(k(),v(h,{key:0,loading:s(t).processing,onClick:y(N,["stop"]),color:"primary"},{default:l(()=>e[8]||(e[8]=[L("Antrag zurÃ¼ckziehen")])),_:1},8,["loading"])):(k(),v(h,{key:1,loading:s(t).processing,type:"submit",color:"primary"},{default:l(()=>e[9]||(e[9]=[L("Korrektur beantragen")])),_:1},8,["loading"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{oe as default};
