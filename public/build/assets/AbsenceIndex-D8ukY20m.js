import{d as U,Q as M,r as A,T as B,a as I,o as f,c as k,w as r,b as o,V as T,u as n,e as w,f as N,g as _,h as S,i as O,t as v,j as Q,k as E,l as F,m as $,n as c,p as z,q as j,s as H,v as C,x as J,y as D,z as q,F as R,A as G,D as u}from"./app-DpjimMum.js";import{_ as K}from"./AdminLayout.vue_vue_type_script_setup_true_lang-Yy4XWdBJ.js";import{g as P}from"./utils-rpcLl0iu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W=["role","onClick"],te=U({__name:"AbsenceIndex",props:{users:{},absence_types:{}},setup(h){const y=h,g=M();function V(){const l=[];for(let t=1;t<=u.now().daysInMonth;t++)l.push(u.now().startOf("month").plus({day:t-1}));return l}function L(l,t){var a;const i=l.absences.find(d=>u.fromSQL(d.start)<=t&&t<=u.fromSQL(d.end));return i&&i.status==="accepted"?((a=i.absence_type)==null?void 0:a.abbreviation)||"âŒ":l.user_working_weeks.find(d=>{var e;return d[(e=t.setLocale("en-US").weekdayLong)==null?void 0:e.toLowerCase()]})?" ":""}function p(l){return can("absence","create",y.users.find(t=>t.id===l.id))}const b=A(!1),s=B({absence_type_id:void 0,start:new Date,end:new Date,user_id:g.props.auth.user.id});function x(l,t){const i=y.users.find(e=>e.id===t);if(!i||!p(i))return;const a=u.now().startOf("month").plus({day:+l}),d=i.absences.find(e=>u.fromSQL(e.start)<=a&&a<=u.fromSQL(e.end));d&&(s.absence_type_id=d.absence_type_id),s.user_id=t,s.start=u.now().startOf("month").plus({day:+l-1}).toJSDate(),s.end=u.now().startOf("month").plus({day:+l}).toJSDate(),b.value=!0}return(l,t)=>{const i=I("v-date-input");return f(),k(K,{title:"Abwesenheiten"},{default:r(()=>[o(j,{"max-width":"1000",modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=a=>b.value=a)},{default:r(({isActive:a})=>{var d;return[o(T,{title:"Abwesenheit"+(n(s).user_id!=n(g).props.auth.user.id?" von "+((d=l.users.map(e=>({...e,name:e.first_name+" "+e.last_name})).find(e=>e.id===n(s).user_id))==null?void 0:d.name):"")+" beantragen"},{append:r(()=>[o(w,{icon:"",variant:"text",onClick:e=>a.value=!1},{default:r(()=>[o(N,null,{default:r(()=>t[4]||(t[4]=[_("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:r(()=>[n(s).errors.user_id?(f(),k(S,{key:0},{default:r(()=>[o(O,{color:"error",closable:""},{default:r(()=>[_(v(n(s).errors.user_id),1)]),_:1})]),_:1})):Q("",!0),o(S,null,{default:r(()=>[o(E,{onSubmit:F(e=>{n(s).transform(m=>({...m,start:m.start.toLocaleDateString(),end:m.end.toLocaleDateString()})).post(l.route("absence.store"),{onSuccess:()=>{n(s).reset(),a.value=!1}})},["prevent"])},{default:r(()=>[o($,null,{default:r(()=>[o(c,{cols:"12"},{default:r(()=>[o(z,{label:"Abwesenheitsgrund angeben",items:l.absence_types.map(e=>({title:e.name,value:e.id})),modelValue:n(s).absence_type_id,"onUpdate:modelValue":t[0]||(t[0]=e=>n(s).absence_type_id=e),"error-messages":n(s).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),o(c,{cols:"12",md:"6"},{default:r(()=>[o(i,{label:"Von",modelValue:n(s).start,"onUpdate:modelValue":t[1]||(t[1]=e=>n(s).start=e),"error-messages":n(s).errors.start},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12",md:"6"},{default:r(()=>[o(i,{label:"Bis",modelValue:n(s).end,"onUpdate:modelValue":t[2]||(t[2]=e=>n(s).end=e),"error-messages":n(s).errors.end},null,8,["modelValue","error-messages"])]),_:1}),o(c,{cols:"12",class:"text-end"},{default:r(()=>[o(w,{loading:n(s).processing,type:"submit",color:"primary"},{default:r(()=>t[5]||(t[5]=[_("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),o(G,{"fixed-header":"",style:D([{"white-space":"pre"},{maxHeight:n(P)(0)}]),id:"absence-table",items:l.users.map(a=>({...a,name:a.first_name+`
`+a.last_name,...Object.fromEntries(V().map(d=>[d.day,L(a,d)]))})),headers:[{title:"Name",key:"name"},...V().map(a=>({title:a.weekdayShort+`
`+a.day.toString(),key:a.day.toString(),sortable:!1,align:"center"}))]},{item:r(({item:a,columns:d})=>[H("tr",null,[(f(!0),C(R,null,J(d,e=>(f(),C("td",{key:e.key+"",style:D({backgroundColor:a[e.key]?"":"lightgray"}),class:q({"editable-cell":p(a)}),role:p(a)?"button":"cell",onClick:m=>x(e.key+"",a.id)},v(a[e.key]),15,W))),128))])]),_:1},8,["style","items","headers"])]),_:1})}}});export{te as default};
