import{d as E,at as k,as as U,r as $,a as d,b as u,e as t,f as b,g as e,V as C,aC as F,t as o,i as w,K as I,p as _,h as i,L as f,ap as h,M as r,x as M,P as D,m,q as c,aA as j,j as A,R as q,N as z,z as L,D as H,aB as J,s as O,B as W}from"./app-xlMWTkcp.js";import{A as G}from"./AdminLayout-CFkXnsL5.js";import{_ as Q}from"./PaymentTable.vue_vue_type_script_setup_true_lang-2Q6HJR_Z.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ChatDetails-BQxl31uk.js";import"./ChatMessage-B-iGIr9M.js";import"./utils-FiO2tbkp.js";const Y=E({__name:"IsaIndex",props:{chatAssistant:{},files:{},stats:{}},setup(S){const p=S,n=k({chatFile_ids:p.chatAssistant.chat_files.map(s=>s.id),monthly_cost_limit:p.chatAssistant.monthly_cost_limit}),{files:N}=U(p),g=k({files:[]}),T=p.chatAssistant.id,y=$(null);function B(){var s;(s=y.value)==null||s.click()}function K(s){g.files=s,g.post(route("file.store"),{onSuccess:()=>{g.reset()},onFinish:()=>{y.value&&(y.value.value="")}})}function P(s){W.delete(route("file.destroy",s.id),{})}function v(s,a){const l=s/a*100;return l>=90?"error":l>=70?"warning":"success"}return(s,a)=>(u(),d(G,{title:"Einstellungen für ISA",tooltip:"TooltipChatAssistantIndex"},{default:t(()=>[s.can("chatAssistant","showPaymentInfo")?(u(),d(C,{key:0,class:"mb-4"},{default:t(()=>[e(F,{class:"my-4"},{default:t(()=>[...a[7]||(a[7]=[o("Kostenverwaltung",-1)])]),_:1}),e(w,null,{default:t(()=>[s.can("chatAssistant","update")?(u(),d(I,{key:0,onSubmit:a[1]||(a[1]=_(l=>i(n).patch(s.route("isa.update",{isa:s.chatAssistant.id})),["prevent"]))},{default:t(()=>[e(f,null,{default:t(()=>[e(h,{class:"mt-4"},{default:t(()=>[...a[8]||(a[8]=[o("Aktuelle Verbrauchsanzeige",-1)])]),_:1}),e(r,{class:"pt-2 mb-4",cols:"12"},{default:t(()=>[e(M,{title:" "+Math.floor(s.chatAssistant.current_monthly_cost/s.chatAssistant.monthly_cost_limit*100)+"% des monatlichen Kostenlimits sind erreicht",rounded:"",max:s.chatAssistant.monthly_cost_limit,"model-value":s.chatAssistant.current_monthly_cost,color:v(s.chatAssistant.current_monthly_cost,s.chatAssistant.monthly_cost_limit),height:"15"},null,8,["title","max","model-value","color"])]),_:1}),e(r,{cols:"11"},{default:t(()=>[e(D,{modelValue:i(n).monthly_cost_limit,"onUpdate:modelValue":a[0]||(a[0]=l=>i(n).monthly_cost_limit=l),label:"Monatliches Kostenlimit in €",required:"",errorMessages:i(n).errors.monthly_cost_limit,variant:"outlined",density:"compact"},null,8,["modelValue","errorMessages"])]),_:1}),e(r,{cols:"1",class:"text-end"},{default:t(()=>[e(m,{color:"primary",type:"submit",disabled:i(n).processing,loading:i(n).processing},{default:t(()=>[e(c,{size:"large"},{default:t(()=>[...a[9]||(a[9]=[o("mdi-content-save",-1)])]),_:1})]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})):(u(),d(f,{key:1},{default:t(()=>[e(h,{class:"mt-4"},{default:t(()=>[...a[10]||(a[10]=[o("Aktuelle Verbrauchsanzeige",-1)])]),_:1}),e(r,{class:"pt-2 mb-4",cols:"12"},{default:t(()=>[e(M,{title:" "+Math.floor(s.chatAssistant.current_monthly_cost/s.chatAssistant.monthly_cost_limit*100)+"% des monatlichen Kostenlimits sind erreicht",rounded:"",max:s.chatAssistant.monthly_cost_limit,"model-value":s.chatAssistant.current_monthly_cost,color:v(s.chatAssistant.current_monthly_cost,s.chatAssistant.monthly_cost_limit),height:"15"},null,8,["title","max","model-value","color"])]),_:1}),e(r,{cols:"12"},{default:t(()=>[e(D,{modelValue:i(n).monthly_cost_limit,"onUpdate:modelValue":a[2]||(a[2]=l=>i(n).monthly_cost_limit=l),label:"Monatliches Kostenlimit in €",required:"",errorMessages:i(n).errors.monthly_cost_limit,"hide-details":"",variant:"outlined",density:"compact"},null,8,["modelValue","errorMessages"])]),_:1})]),_:1})),e(f,null,{default:t(()=>[e(h,{class:"mt-8"},{default:t(()=>[a[12]||(a[12]=o(" Verbrauchsübersicht ",-1)),e(j,{"open-on-hover":!1,"open-on-click":"",origin:"bottom start",class:""},{activator:t(({props:l})=>[e(m,q(l,{icon:"",variant:"text",size:"small",class:"ms-2"}),{default:t(()=>[e(c,{icon:"mdi-information",color:"primary"})]),_:1},16)]),default:t(()=>[a[11]||(a[11]=A("span",{class:"background__color"},[o(" Wird ein Chat über mehrere Monate oder sogar Jahre geführt, wird er zeitlich dem Erstellungsdatum zugeordnet. "),A("br"),o(" Die Chatkosten berechnen sich für jede Nachricht separat und werden gegebenenfalls den jeweiligen Monaten und Jahren in denen sie entstanden sind zugeordnet. ")],-1))]),_:1})]),_:1}),e(r,{cols:"12"},{default:t(()=>[e(Q,{stats:s.stats,chatAssistantId:i(T)},null,8,["stats","chatAssistantId"])]),_:1})]),_:1})]),_:1})]),_:1})):b("",!0),e(C,{class:"mb-4"},{default:t(()=>[e(F,{class:"my-4"},{default:t(()=>[...a[13]||(a[13]=[o("Dateiverwaltung",-1)])]),_:1}),e(h,{class:"mt-4"},{default:t(()=>[...a[14]||(a[14]=[o("Verwendete Dateien",-1)])]),_:1}),e(w,{class:"pt-0"},{default:t(()=>[s.can("chatAssistant","update")?(u(),d(I,{key:0,onSubmit:a[4]||(a[4]=_(l=>i(n).patch(s.route("isa.update",{isa:s.chatAssistant.id})),["prevent"]))},{default:t(()=>[e(f,null,{default:t(()=>[e(r,{cols:"11"},{default:t(()=>[e(z,{color:"primary",items:s.files.map(l=>({title:l.name,value:l.id})),modelValue:i(n).chatFile_ids,"onUpdate:modelValue":a[3]||(a[3]=l=>i(n).chatFile_ids=l),multiple:"",chips:"","no-data-text":"Es wurden keine Dateien hochgeladen",errorMessages:i(n).errors.chatFile_ids,"hide-details":"",density:"comfortable"},null,8,["items","modelValue","errorMessages"])]),_:1}),e(r,{cols:"1",class:"text-end"},{default:t(()=>[e(m,{color:"primary",type:"submit",disabled:i(n).processing,loading:i(n).processing},{default:t(()=>[e(c,{size:"large"},{default:t(()=>[...a[15]||(a[15]=[o("mdi-content-save",-1)])]),_:1})]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})):(u(),d(f,{key:1},{default:t(()=>[e(r,{cols:"12"},{default:t(()=>[e(z,{color:"primary",items:s.files.map(l=>({title:l.name,value:l.id})),modelValue:i(n).chatFile_ids,"onUpdate:modelValue":a[5]||(a[5]=l=>i(n).chatFile_ids=l),multiple:"",chips:"","hide-details":"",density:"comfortable"},null,8,["items","modelValue"])]),_:1})]),_:1}))]),_:1}),e(h,{class:"mt-6"},{default:t(()=>[...a[16]||(a[16]=[o("Dateiübersicht",-1)])]),_:1}),A("input",{hidden:"",ref_key:"fileInputRef",ref:y,type:"file",accept:"application/pdf",multiple:"",onChange:a[6]||(a[6]=l=>K(l.target.files))},null,544),e(L,{"fixed-header":"","no-data-text":"Es wurden noch keine Dateien Hochgeladen",class:"mx-auto",headers:[{title:"Dateiname",value:"name"},{title:"Hinzugefügt",value:"created_at"},{title:"Status",value:"is_used_text"},{title:"",value:"actions",align:"end"}],items:i(N).map(l=>{const V=!!s.chatAssistant.chat_files.find(R=>R.id==l.id);return{...l,created_at:i(H).fromISO(l.created_at).toFormat("dd.MM.yyyy hh:mm"),is_used:V,is_used_text:V?"In Benutzung":"Nicht verwendet"}})},J({"item.actions":t(({item:l})=>[s.can("chatAssistant","showChatFiles")?(u(),d(m,{key:0,href:s.route("file.show",{file:l.id.toString()})},{default:t(()=>[e(c,{icon:"mdi-eye",color:"primary"})]),_:1},8,["href"])):b("",!0),s.can("chatAssistant","editChatFiles")?(u(),d(m,{key:1,disabled:l.is_used,onClick:_(V=>P(l),["stop"]),class:"ms-2",color:"error",style:O([{"pointer-events":"auto"},{cursor:l.is_used?"default":"pointer"}]),title:l.is_used?"Verwendete Dateien können nicht gelöscht werden":"Datei entfernen"},{default:t(()=>[e(c,{icon:"mdi-delete"})]),_:1},8,["disabled","onClick","style","title"])):b("",!0)]),_:2},[s.can("chatAssistant","editChatFiles")?{name:"header.actions",fn:t(()=>[e(m,{title:"Neue Datei hochladen",color:"primary",onClick:_(B,["stop"])},{default:t(()=>[e(c,{icon:"mdi-plus"})]),_:1})]),key:"0"}:void 0]),1032,["items"])]),_:1})]),_:1}))}}),ie=X(Y,[["__scopeId","data-v-ba26bfc6"]]);export{ie as default};
