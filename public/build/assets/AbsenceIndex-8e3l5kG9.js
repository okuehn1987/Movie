import{d as U,n as P,r as b,D as p,w as j,o as i,c as g,a as s,b as t,V as B,u as r,e as m,f,g as V,h as w,i as z,t as h,j as I,k as E,l as v,m as G,p as k,q as H,s as O,v as Q,x as y,y as q,z as R,A as J,B as K,C as c,E as W,F,G as X}from"./app-BKGO2zzB.js";import{_ as Y}from"./AdminLayout.vue_vue_type_script_setup_true_lang-34hSNfTs.js";import{g as Z,t as ee}from"./utils-Ci62rx4T.js";import{_ as ae}from"./AbsenceTableCell.vue_vue_type_style_index_0_lang-BeNqpGRz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"d-flex flex-wrap justify-center align-center"},se={class:"d-flex flex-wrap align-center"},le={class:"d-flex"},ne={class:"mx-4 text-center",style:{"min-width":"170px"}},oe={class:"d-flex"},re={key:0},de={key:0},ie={key:1},fe=U({__name:"AbsenceIndex",props:{users:{},absences:{},absence_types:{},holidays:{}},setup(A){const T=A,S=P(),$=route().params.date,n=b($?p.fromFormat($,"yyyy-MM"):p.now());function N(){const d=[];for(let a=1;a<=n.value.daysInMonth;a++)d.push(n.value.startOf("month").plus({day:a-1}));return d}const M=b(!1),o=useForm({user_id:S.props.auth.user.id,start:null,end:null,absence_type_id:null});function D(d,a){o.reset();const e=T.absences.filter(u=>u.user_id===d).find(u=>a&&p.fromSQL(u.start)<=a&&a<=p.fromSQL(u.end));o.user_id=d,o.start=(a??n.value.startOf("month")).toFormat("yyyy-MM-dd"),o.end=(a??n.value.startOf("month")).toFormat("yyyy-MM-dd"),o.absence_type_id=(e==null?void 0:e.absence_type_id)??null,M.value=!0}const _=b([n.value.toFormat("yyyy-MM")]),L=ee(()=>{_.value.includes(n.value.toFormat("yyyy-MM"))||X.reload({only:["absences","holidays"],data:{date:n.value.toFormat("yyyy-MM")},onStart:()=>{_.value.push(n.value.toFormat("yyyy-MM")),x.value=!0},onError:()=>_.value=_.value.filter(d=>d!=n.value.toFormat("yyyy-MM")),onFinish:()=>x.value=!1})},500);j(n,L);const x=b(!1);return(d,a)=>(i(),g(Y,{title:"Abwesenheiten"},{default:s(()=>[t(Q,{"max-width":"1000",modelValue:M.value,"onUpdate:modelValue":a[3]||(a[3]=e=>M.value=e)},{default:s(({isActive:e})=>{var u;return[t(B,{title:"Abwesenheit"+(r(o).user_id!=r(S).props.auth.user.id?" von "+((u=d.users.map(l=>({...l,name:l.first_name+" "+l.last_name})).find(l=>l.id===r(o).user_id))==null?void 0:u.name):"")+" beantragen"},{append:s(()=>[t(m,{icon:"",variant:"text",onClick:l=>e.value=!1},{default:s(()=>[t(f,null,{default:s(()=>a[8]||(a[8]=[V("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:s(()=>[r(o).errors.user_id?(i(),g(w,{key:0},{default:s(()=>[t(z,{color:"error",closable:""},{default:s(()=>[V(h(r(o).errors.user_id),1)]),_:1})]),_:1})):I("",!0),t(w,null,{default:s(()=>[t(E,{onSubmit:v(l=>{r(o).post(d.route("absence.store"),{onSuccess:()=>{r(o).reset(),e.value=!1}})},["prevent"])},{default:s(()=>[t(G,null,{default:s(()=>[t(k,{cols:"12"},{default:s(()=>[t(H,{label:"Abwesenheitsgrund angeben",items:d.absence_types.map(l=>({title:l.name,value:l.id})),modelValue:r(o).absence_type_id,"onUpdate:modelValue":a[0]||(a[0]=l=>r(o).absence_type_id=l),"error-messages":r(o).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),t(k,{cols:"12",md:"6"},{default:s(()=>[t(O,{type:"date",label:"Von",modelValue:r(o).start,"onUpdate:modelValue":a[1]||(a[1]=l=>r(o).start=l),"error-messages":r(o).errors.start},null,8,["modelValue","error-messages"])]),_:1}),t(k,{cols:"12",md:"6"},{default:s(()=>[t(O,{type:"date",label:"Bis",modelValue:r(o).end,"onUpdate:modelValue":a[2]||(a[2]=l=>r(o).end=l),"error-messages":r(o).errors.end},null,8,["modelValue","error-messages"])]),_:1}),t(k,{cols:"12",class:"text-end"},{default:s(()=>[t(m,{loading:r(o).processing,type:"submit",color:"primary"},{default:s(()=>a[9]||(a[9]=[V("beantragen")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1032,["title"])]}),_:1},8,["modelValue"]),t(B,null,{default:s(()=>[t(w,null,{default:s(()=>[y("div",te,[y("div",se,[y("div",le,[t(m,{onClick:a[4]||(a[4]=v(e=>n.value=n.value.minus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-left"})]),_:1}),t(m,{onClick:a[5]||(a[5]=v(e=>n.value=n.value.minus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-left"})]),_:1})]),y("h2",ne,[V(h(n.value.toFormat("MMMM yyyy"))+" ",1),x.value?(i(),g(q,{key:0,indeterminate:""})):I("",!0)]),y("div",oe,[t(m,{onClick:a[6]||(a[6]=v(e=>n.value=n.value.plus({month:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-right"})]),_:1}),t(m,{onClick:a[7]||(a[7]=v(e=>n.value=n.value.plus({year:1}),["stop"])),variant:"text",icon:"",color:"primary"},{default:s(()=>[t(f,{icon:"mdi-chevron-double-right"})]),_:1})])])])]),_:1}),t(R),t(J,{"fixed-header":"",style:K([{"white-space":"pre"},{maxHeight:r(Z)(81)}]),id:"absence-table",items:d.users.map(e=>({...e,name:e.last_name+", "+e.first_name})),headers:[{title:"Name",key:"name"},{title:"",key:"action",width:"48px"},...N().map(e=>({title:e.weekdayShort+`
`+e.day.toString(),key:e.day.toString(),sortable:!1,align:"center",headerProps:{class:{"bg-blue-darken-2":e.toISODate()===r(p).local().toISODate()}}}))]},{item:s(({item:e,columns:u})=>[y("tr",null,[(i(!0),c(F,null,W(u,l=>(i(),c(F,{key:l.key},[l.key==="name"?(i(),c("td",re,h(e.first_name)+" "+h(e.last_name),1)):l.key==="action"?(i(),c(F,{key:1},[d.can("absence","create",e)?(i(),c("td",de,[t(m,{icon:"mdi-plus",variant:"text",onClick:C=>d.can("absence","create",e)&&D(e.id)},null,8,["onClick"])])):(i(),c("td",ie))],64)):(i(),g(ae,{key:2,onClick:C=>d.can("absence","create",e)&&D(e.id,n.value.startOf("month").plus({day:+(l.key??0)-1})),holidays:d.holidays,absenceTypes:d.absence_types,user:e,date:n.value.startOf("month").plus({day:+(l.key??0)-1}),absences:d.absences.filter(C=>C.user_id===e.id)},null,8,["onClick","holidays","absenceTypes","user","date","absences"]))],64))),128))])]),_:1},8,["style","items","headers"])]),_:1})]),_:1}))}});export{fe as default};
