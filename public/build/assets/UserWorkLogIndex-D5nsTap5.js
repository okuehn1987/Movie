import{d as M,T as N,r as y,I as H,ah as q,C as A,D as m,a as E,o as _,c as k,b as l,e as i,R as O,u as r,f as h,m as w,k as D,Q as W,W as B,v as R,V as P,g as $,h as S,i as z,l as K,p as G,q as p,K as T,X as J,H as X}from"./app-heOlEtwh.js";import{_ as Z}from"./AdminLayout.vue_vue_type_script_setup_true_lang-BoUYAtk-.js";import{b as j}from"./utils-9p5qREwL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=M({__name:"UserWorkLogIndex",props:{user:{},workLogs:{}},setup(F){const V=F,{currentPage:b,lastPage:L,data:x}=j(N(V),"workLogs"),g=y(!1),c=y(null),u=y(null),v=H(()=>u.value?"plain":"underlined"),U=H(()=>V.workLogs.data.filter((o,e)=>e<10**10));q(()=>{const o=route().params.workLog;if(o)return C(Number(o))});const a=A({id:-1,start:new Date,end:new Date,start_time:"",end_time:"",is_home_office:!1});function I(){a.transform(o=>{const e=m.fromFormat(o.start_time,"HH:mm"),d=m.fromFormat(o.end_time,"HH:mm");return{...o,start:m.fromISO(o.start.toISOString()).set({hour:e.hour,minute:e.minute}),end:m.fromISO(o.end.toISOString()).set({hour:d.hour,minute:d.minute}),workLog:a.id}}).post(route("workLogPatch.store"),{onSuccess:()=>{g.value=!1}})}function C(o){const e=V.workLogs.data.find(f=>f.id===o);if(!e)return;const d=e.work_log_patches.at(-1);e.end?d?d&&d.status==="created"&&(u.value=d,c.value="show"):(u.value=null,c.value="edit"):(c.value="fix",u.value=e);let t=e.start,s=e.end,n=e.is_home_office;u.value&&(t=u.value.start,s=u.value.end,n=u.value.is_home_office),a.id=o,a.start=new Date(t),a.end=s?new Date(s):new Date,a.start_time=m.fromSQL(t).toFormat("HH:mm"),a.end_time=m.fromSQL(s||m.now().toSQL()).toFormat("HH:mm"),a.is_home_office=n,g.value=!0}function Q(){const o=V.workLogs.data.find(d=>d.id===a.id);if(!o)return;const e=o.work_log_patches.at(-1);e&&X.delete(route("workLogPatch.destroy",{workLogPatch:e.id}),{onSuccess:()=>{g.value=!1}})}return(o,e)=>{const d=E("v-date-input");return _(),k(Z,{title:o.user.first_name+" "+o.user.last_name,backurl:o.route().params.fromUserWorkLogs?o.route("workLog.index"):o.route("dashboard")},{default:l(()=>[i(P,null,{default:l(()=>[i(O,{headers:[{title:"Start",key:"start"},{title:"Ende",key:"end"},{title:"Dauer",key:"duration"},{title:"Homeoffice",key:"is_home_office"},{title:"Korrektur",key:"status"},{title:"",key:"action",sortable:!1,align:"end"}],items:r(x).map(t=>({...t.work_log_patches.filter(n=>n.status==="accepted").toSorted((n,f)=>n.updated_at<f.updated_at?1:-1)[0]??t,id:t.id})).toSorted((t,s)=>t.start<s.start?1:-1).map(t=>{var s,n;return{start:r(m).fromSQL(t.start).toFormat("dd.MM.yyyy HH:mm"),end:t.end?r(m).fromSQL(t.end).toFormat("dd.MM.yyyy HH:mm"):"Noch nicht beendet",duration:t.end?r(m).fromSQL(t.end).diff(r(m).fromSQL(t.start)).toFormat("hh:mm"):"",is_home_office:t.is_home_office?"Ja":"Nein",id:t.id,status:{created:"Beantragt",declined:"Abgelehnt",accepted:"Akzeptiert",none:"Nicht vorhanden"}[((n=(s=o.workLogs.data.find(f=>f.id===t.id))==null?void 0:s.work_log_patches.at(-1))==null?void 0:n.status)||"none"]}})},{"item.action":l(({item:t})=>{var s,n;return[U.value.find(f=>f.id===t.id)&&o.can("workLogPatch","create")?(_(),k(h,{key:0,color:"primary",onClick:w(f=>C(t.id),["stop"]),icon:((n=(s=o.workLogs.data.find(f=>f.id===t.id))==null?void 0:s.work_log_patches.at(-1))==null?void 0:n.status)==="created"?"mdi-eye":"mdi-pencil",variant:"text"},null,8,["onClick","icon"])):D("",!0)]}),bottom:l(()=>[r(L)>1?(_(),k(W,{key:0,modelValue:r(b),"onUpdate:modelValue":e[0]||(e[0]=t=>B(b)?b.value=t:null),length:r(L)},null,8,["modelValue","length"])):D("",!0)]),_:1},8,["items"]),i(R,{"max-width":"1000",modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=t=>g.value=t)},{default:l(({isActive:t})=>[i(P,{title:"Zeitkorrektur"},{append:l(()=>[i(h,{icon:"",variant:"text",onClick:s=>t.value=!1},{default:l(()=>[i($,null,{default:l(()=>e[7]||(e[7]=[S("mdi-close")])),_:1})]),_:2},1032,["onClick"])]),default:l(()=>[i(z,null,{default:l(()=>[i(K,{onSubmit:w(I,["prevent"])},{default:l(()=>[i(G,null,{default:l(()=>[i(p,{cols:"12",md:"3"},{default:l(()=>[i(d,{disabled:c.value=="fix",label:"Start","data-testid":"userTimeCorrectionStartDay",required:"","error-messages":r(a).errors.start,modelValue:r(a).start,"onUpdate:modelValue":e[1]||(e[1]=s=>r(a).start=s),variant:v.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(T,{disabled:c.value=="fix",type:"time",label:"Start","data-testid":"userTimeCorrectionStartTime",required:"","error-messages":r(a).errors.start_time,modelValue:r(a).start_time,"onUpdate:modelValue":e[2]||(e[2]=s=>r(a).start_time=s),variant:v.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(d,{disabled:c.value=="fix",label:"Ende","data-testid":"userTimeCorrectionEndDay",required:"","error-messages":r(a).errors.end,modelValue:r(a).end,"onUpdate:modelValue":e[3]||(e[3]=s=>r(a).end=s),variant:v.value,style:{height:"73px"}},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(T,{disabled:!!u.value,type:"time",label:"Ende","data-testid":"userTimeCorrectionEndTime",required:"","error-messages":r(a).errors.end_time,modelValue:r(a).end_time,"onUpdate:modelValue":e[4]||(e[4]=s=>r(a).end_time=s),variant:v.value},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",md:"3"},{default:l(()=>[i(J,{disabled:!!u.value,label:"Homeoffice",required:"","error-messages":r(a).errors.is_home_office,modelValue:r(a).is_home_office,"onUpdate:modelValue":e[5]||(e[5]=s=>r(a).is_home_office=s),variant:v.value,"hide-details":""},null,8,["disabled","error-messages","modelValue","variant"])]),_:1}),i(p,{cols:"12",class:"text-end"},{default:l(()=>[u.value&&o.$page.props.auth.user.id==o.user.id?(_(),k(h,{key:0,loading:r(a).processing,onClick:w(Q,["stop"]),color:"primary"},{default:l(()=>e[8]||(e[8]=[S("Antrag zurÃ¼ckziehen")])),_:1},8,["loading"])):(_(),k(h,{key:1,loading:r(a).processing,type:"submit",color:"primary"},{default:l(()=>e[9]||(e[9]=[S("Korrektur beantragen")])),_:1},8,["loading"]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1024)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["title","backurl"])}}});export{oe as default};
