import{d as M,r as p,w as x,c as z,a as u,b as a,e as r,g as s,k as _,y as D,U as I,j as n,q as N,a1 as H,f as F,v as f,a2 as U,a0 as $,h as v,D as k,m as K,p as L,t as O,s as A,V as j,B as q}from"./app-Cjr2-T1g.js";import{t as R,u as G,a as J,m as P,b as Q}from"./utils-pxk3iB4K.js";import{_ as c}from"./CreateEditCustomerNoteFolder.vue_vue_type_script_setup_true_lang-DIh2Dif3.js";import{_ as g}from"./ConfirmDelete.vue_vue_type_script_setup_true_lang-HVFT5gkP.js";import{_ as b}from"./CreateEditCustomerNoteEntry.vue_vue_type_script_setup_true_lang-BySgtJAP.js";const W={class:"d-flex align-center"},X={key:1,class:"d-flex"},Y={class:"flex-shrink-1",style:{"max-width":"40%"}},Z={class:"ma-2"},ee={style:{"user-select":"none"}},te={class:"flex-grow-1"},oe={key:0},se={class:"d-flex"},ue=M({__name:"CustomerNotes",props:{customerNoteFolders:{},customerNoteEntries:{},customer:{}},setup(V){var y;const h=V,l=p(((y=h.customerNoteFolders[0])==null?void 0:y.id)??null),m=p(!1),w=R(()=>{l.value&&q.reload({data:{selectedFolder:l.value},only:["customerNoteEntries"],onStart:()=>{l.value&&(m.value=!0)},onFinish:()=>m.value=!1})},500);x(l,w);function E(t){const o=route("customerNoteEntry.getFile",{customerNoteEntry:t.id});window.open(o,"_blank")}const B=G(48),i=p([]),C=z(()=>J(P(h.customerNoteFolders,"sub_folders",(o,d)=>({name:o.name,id:o.id,level:d})),"sub_folders",()=>!0)),{clickHandler:S}=Q();function T(t){S(()=>{l.value=t??l.value},o=>{i.value.includes(t??o)?i.value=i.value.filter(d=>d!=(t??o)):i.value.push(t??o)},t)}return(t,o)=>(a(),u(j,{style:A({height:v(B)}),title:"Kundennotizen"},{append:r(()=>[...o[2]||(o[2]=[])]),default:r(()=>{var d;return[s(D),t.customerNoteFolders.length==0?(a(),u(I,{key:0,color:"warning"},{default:r(()=>[n("div",W,[s(N,{icon:"mdi-information",class:"me-2"}),o[3]||(o[3]=n("span",{class:"me-2"},"Es existiert noch kein Ordner, hier kannst du einen anlegen:",-1)),s(c,{customer:t.customer,hasFolders:!1},null,8,["customer"])])]),_:1})):(a(),_("div",X,[n("div",Y,[n("div",Z,[s(c,{customer:t.customer,hasFolders:!0},null,8,["customer"])]),s(H,{indentLines:!0,opened:i.value,"onUpdate:opened":o[0]||(o[0]=e=>i.value=e),"item-children":"sub_folders",items:C.value,"item-value":"id",activatable:"","onUpdate:activated":o[1]||(o[1]=e=>T(e[0]))},{prepend:r(()=>[s(N,{icon:"mdi-folder"})]),title:r(({item:e})=>[n("span",ee,f(e.name),1)]),append:r(({item:e})=>[e.level<2?(a(),u(c,{key:0,createSubFolder:e,customer:t.customer},null,8,["createSubFolder","customer"])):F("",!0),s(c,{editNoteFolder:e,customer:t.customer},null,8,["editNoteFolder","customer"]),s(g,{title:'Kategorie "'+e.name+'" löschen',content:'Bist du dir sicher, dass du die Kategorie "'+e.name+'" mit all ihren Inhalten löschen möchtest?',route:t.route("customerNoteFolder.destroy",{customerNoteFolder:e.id})},null,8,["title","content","route"])]),_:1},8,["opened","items"])]),n("div",te,[m.value?(a(),u(U,{key:0,type:"table"})):l.value?(a(),u($,{key:1,items:(d=t.customerNoteEntries)==null?void 0:d.map(e=>({...e,userName:e.user.first_name+" "+e.user.last_name+" am "+v(k).fromISO(e.updated_at).toFormat("dd.MM.yyyy")})),headers:[{title:"Titel",value:"title"},{title:"Inhalt",value:"value"},{title:"letzte Bearbeitung",value:"userName"},{title:"",value:"actions",width:"1px",align:"end"}]},{"header.actions":r(()=>[s(b,{selectedFolder:l.value,customer:t.customer},null,8,["selectedFolder","customer"])]),"item.updated_at":r(({item:e})=>[O(f(v(k).fromISO(e.updated_at).toFormat("dd.MM.yyyy")),1)]),"item.value":r(({item:e})=>[e.type=="text"?(a(),_("span",oe,f(e.value),1)):(a(),u(K,{key:1,onClick:L(re=>E(e),["stop"]),color:"primary",variant:"text",icon:"mdi-file-document-outline"},null,8,["onClick"]))]),"item.actions":r(({item:e})=>[n("div",se,[s(b,{selectedFolder:l.value,customer:t.customer,customerNoteEntry:e},null,8,["selectedFolder","customer","customerNoteEntry"]),s(g,{title:'Notiz "'+e.title+'" löschen',content:'Bist du dir sicher, dass du die Notiz "'+e.title+'" löschen möchtest?',route:t.route("customerNoteEntry.destroy",{customerNoteEntry:e.id})},null,8,["title","content","route"])])]),_:1},8,["items"])):F("",!0)])]))]}),_:1},8,["style"]))}});export{ue as _};
