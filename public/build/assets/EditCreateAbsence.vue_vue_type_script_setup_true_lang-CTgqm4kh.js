import{d as H,A as I,B as L,c as T,L as J,a as b,o,b as a,f as d,V as O,j as t,e as V,g as Y,M as $,q as m,t as p,C as R,m as _,N as P,O as u,H as z,P as j,h as g,D as G,i as K,F as Q,l as f,n as W,J as X}from"./app-11KYkfCY.js";const Z={class:"d-flex ga-2 justify-end"},h=H({__name:"EditCreateAbsence",props:I({users:{},absence_types:{},selectedAbsence:{},selectedDate:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{},selectedUser:{required:!0},selectedUserModifiers:{}}),emits:["update:modelValue","update:selectedUser"],setup(y){var D,M,U,w,B,S,q;const r=y,i=L(y,"modelValue"),A=L(y,"selectedUser"),c=T(()=>r.users.find(n=>n.id===A.value)),e=useForm({user_id:((D=r.selectedAbsence)==null?void 0:D.user_id)??A.value,start:((M=r.selectedAbsence)==null?void 0:M.start)??((U=r.selectedDate)==null?void 0:U.toFormat("yyyy-MM-dd"))??null,end:((w=r.selectedAbsence)==null?void 0:w.end)??((B=r.selectedDate)==null?void 0:B.toFormat("yyyy-MM-dd"))??null,absence_type_id:((S=r.selectedAbsence)==null?void 0:S.absence_type_id)??null,absence_id:r.selectedAbsence&&"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:((q=r.selectedAbsence)==null?void 0:q.id)??null});function E(){e.absence_id?e.post(route("absence.absencePatch.store",{absence:e.absence_id}),{onSuccess:()=>{e.reset(),i.value=!1}}):e.post(route("absence.store"),{onSuccess:()=>{e.reset(),i.value=!1}})}const F=useForm({});function k(){r.selectedAbsence&&F.delete(route("absence.destroy",{absence:"absence_id"in r.selectedAbsence?r.selectedAbsence.absence_id:r.selectedAbsence.id}),{onSuccess:()=>{i.value=!1}})}const C=T(()=>{const n=r.absence_types.find(l=>l.id===e.absence_type_id);return!r.selectedAbsence||(n==null?void 0:n.requires_approval)&&J().props.auth.user.supervisor_id});return(n,l)=>(o(),b(X,{"max-width":"1000",modelValue:i.value,"onUpdate:modelValue":l[5]||(l[5]=v=>i.value=v)},{default:a(({isActive:v})=>{var N;return[d(O,{title:"Abwesenheit"+(t(e).user_id!=n.$page.props.auth.user.id?" von "+((N=n.users.map(s=>({...s,name:s.first_name+" "+s.last_name})).find(s=>s.id===t(e).user_id))==null?void 0:N.name):"")+(n.can("absence","update",n.users.find(s=>s.id==t(e).user_id))||!C.value?" bearbeiten":" beantragen")},{append:a(()=>[d(f,{icon:"",variant:"text",onClick:s=>v.value=!1},{default:a(()=>[d(W,null,{default:a(()=>[...l[6]||(l[6]=[m("mdi-close",-1)])]),_:1})]),_:1},8,["onClick"])]),default:a(()=>[t(e).errors.user_id?(o(),b(Y,{key:0},{default:a(()=>[d($,{color:"error",closable:""},{default:a(()=>[m(p(t(e).errors.user_id),1)]),_:1})]),_:1})):V("",!0),d(Y,null,{default:a(()=>[d(R,{onSubmit:_(E,["prevent"])},{default:a(()=>[d(P,null,{default:a(()=>[d(u,{cols:"12"},{default:a(()=>[d(z,{label:"Abwesenheitsgrund angeben",items:n.absence_types.map(s=>({title:s.name,value:s.id})),modelValue:t(e).absence_type_id,"onUpdate:modelValue":l[0]||(l[0]=s=>t(e).absence_type_id=s),"error-messages":t(e).errors.absence_type_id},null,8,["items","modelValue","error-messages"])]),_:1}),d(u,{cols:"12",md:"6"},{default:a(()=>[d(j,{type:"date",label:"Von",modelValue:t(e).start,"onUpdate:modelValue":l[1]||(l[1]=s=>t(e).start=s),"error-messages":t(e).errors.start},null,8,["modelValue","error-messages"])]),_:1}),d(u,{cols:"12",md:"6"},{default:a(()=>[d(j,{type:"date",label:"Bis",modelValue:t(e).end,"onUpdate:modelValue":l[2]||(l[2]=s=>t(e).end=s),"error-messages":t(e).errors.end},null,8,["modelValue","error-messages"])]),_:1}),c.value&&c.value.usedLeaveDaysForYear&&c.value.leaveDaysForYear?(o(),b($,{key:0,type:"info",class:"w-100"},{default:a(()=>[d(P,null,{default:a(()=>[d(u,{cols:"12",md:"6"},{default:a(()=>[g("div",null,"Bereits verwendete Urlaubstage für "+p(t(G).now().year),1)]),_:1}),d(u,{cols:"12",md:"6"},{default:a(()=>[g("div",null,p(c.value.usedLeaveDaysForYear)+" von "+p(c.value.leaveDaysForYear),1)]),_:1})]),_:1})]),_:1})):V("",!0),d(u,{cols:"12"},{default:a(()=>[g("div",Z,[n.selectedAbsence?(o(),K(Q,{key:0},[n.can("absence","update",n.users.find(s=>s.id==t(e).user_id))?(o(),b(f,{key:0,onClick:l[3]||(l[3]=_(s=>k(),["stop"])),color:"error",loading:t(F).processing},{default:a(()=>[...l[7]||(l[7]=[m(" löschen ",-1)])]),_:1},8,["loading"])):(o(),b(f,{key:1,onClick:l[4]||(l[4]=_(s=>k(),["stop"])),color:"error"},{default:a(()=>[...l[8]||(l[8]=[m("Löschung beantragen",-1)])]),_:1}))],64)):V("",!0),d(f,{loading:t(e).processing,type:"submit",color:"primary",disabled:!t(e).isDirty},{default:a(()=>[m(p(n.can("absence","update",n.users.find(s=>s.id==t(e).user_id))||!C.value?"Speichern":"beantragen"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:2},1032,["title"])]}),_:1},8,["modelValue"]))}});export{h as _};
